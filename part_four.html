<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=0.8"><title>IV&nbsp;Intertwined Data</title><link rel="stylesheet" type="text/css" href="part_four_files/scribble.css" title="default"><link rel="stylesheet" type="text/css" href="part_four_files/shared.css" title="default"><link rel="stylesheet" type="text/css" href="part_four_files/figure.css" title="default"><link rel="stylesheet" type="text/css" href="part_four_files/racket.css" title="default"><link rel="stylesheet" type="text/css" href="part_four_files/manual-style.css" title="default"><link rel="stylesheet" type="text/css" href="part_four_files/manual-racket.css" title="default"><script type="text/javascript" src="part_four_files/scribble-common.js"></script><script type="text/javascript" src="part_four_files/figure.js"></script><script type="text/javascript" src="part_four_files/manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tbody><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick='TocviewToggle(this,"tocview_0");'>▼</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">How to Design Programs, Second Edition</a></td></tr></tbody></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tbody><tr><td align="right"></td><td><a href="part_preface.html" class="tocviewlink" data-pltdoc="x">Preface</a></td></tr><tr><td align="right"></td><td><a href="part_prologue.html" class="tocviewlink" data-pltdoc="x">Prologue:<span class="mywbr"> &nbsp;</span> How to Program</a></td></tr><tr><td align="right">I&nbsp;</td><td><a href="part_one.html" class="tocviewlink" data-pltdoc="x">Fixed Size Data</a></td></tr><tr><td align="right"></td><td><a href="i1-2.html" class="tocviewlink" data-pltdoc="x">Intermezzo 1: Beginning Student Language</a></td></tr><tr><td align="right">II&nbsp;</td><td><a href="part_two.html" class="tocviewlink" data-pltdoc="x">Arbitrarily Large Data</a></td></tr><tr><td align="right"></td><td><a href="i2-3.html" class="tocviewlink" data-pltdoc="x">Intermezzo 2: Quote, Unquote</a></td></tr><tr><td align="right">III&nbsp;</td><td><a href="part_three.html" class="tocviewlink" data-pltdoc="x">Abstraction</a></td></tr><tr><td align="right"></td><td><a href="i3-4.html" class="tocviewlink" data-pltdoc="x">Intermezzo 3: Scope and Abstraction</a></td></tr><tr><td align="right">IV&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Intertwined Data</a></td></tr><tr><td align="right"></td><td><a href="i4-5.html" class="tocviewlink" data-pltdoc="x">Intermezzo 4: The Nature of Numbers</a></td></tr><tr><td align="right">V&nbsp;</td><td><a href="part_five.html" class="tocviewlink" data-pltdoc="x">Generative Recursion</a></td></tr><tr><td align="right"></td><td><a href="i5-6.html" class="tocviewlink" data-pltdoc="x">Intermezzo 5: The Cost of Computation</a></td></tr><tr><td align="right">VI&nbsp;</td><td><a href="part_six.html" class="tocviewlink" data-pltdoc="x">Accumulators</a></td></tr><tr><td align="right"></td><td><a href="part_epilogue.html" class="tocviewlink" data-pltdoc="x">Epilogue:<span class="mywbr"> &nbsp;</span> Moving On</a></td></tr></tbody></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tbody><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick='TocviewToggle(this,"tocview_1");'>►</a></td><td>IV&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Intertwined Data</a></td></tr></tbody></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tbody><tr><td align="right">19&nbsp;</td><td><a href="#%28part._ch~3apoetry-sexp%29" class="tocviewlink" data-pltdoc="x">The Poetry of S expressions</a></td></tr><tr><td align="right">20&nbsp;</td><td><a href="#%28part._ch~3afiles%29" class="tocviewlink" data-pltdoc="x">Iterative Refinement</a></td></tr><tr><td align="right">21&nbsp;</td><td><a href="#%28part._ch~3aevaluator%29" class="tocviewlink" data-pltdoc="x">Refining Interpreters</a></td></tr><tr><td align="right">22&nbsp;</td><td><a href="#%28part._ch~3amoney-sexp%29" class="tocviewlink" data-pltdoc="x">Project:<span class="mywbr"> &nbsp;</span> The Commerce of XML</a></td></tr><tr><td align="right">23&nbsp;</td><td><a href="#%28part._ch~3asimu%29" class="tocviewlink" data-pltdoc="x">Simultaneous Processing</a></td></tr><tr><td align="right">24&nbsp;</td><td><a href="#%28part._ch~3asummary4%29" class="tocviewlink" data-pltdoc="x">Summary</a></td></tr></tbody></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.0.0.10</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="i3-4.html" title="backward to &quot;Intermezzo 3: Scope and Abstraction&quot;" data-pltdoc="x">← prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;How to Design Programs, Second Edition&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="i4-5.html" title="forward to &quot;Intermezzo 4: The Nature of Numbers&quot;" data-pltdoc="x">next →</a></span>&nbsp;</div><h3>IV<tt>&nbsp;</tt><a name="(part._part~3afour)"></a>Взаимосвязанные(Переплетенные) данные</h3><table cellspacing="0" cellpadding="0"><tbody><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3apoetry-sexp%29" class="toclink" data-pltdoc="x">19<span class="hspace">&nbsp;</span>Поэзия S-выражений</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3abtrees%29" class="toclink" data-pltdoc="x">19.1<span class="hspace">&nbsp;</span>Деревья</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3aforests%29" class="toclink" data-pltdoc="x">19.2<span class="hspace">&nbsp;</span>Леса</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3asexp%29" class="toclink" data-pltdoc="x">19.3<span class="hspace">&nbsp;</span>S-выражения</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3adesign-.N%29" class="toclink" data-pltdoc="x">19.4<span class="hspace">&nbsp;</span>Проектирование с использованием взаимосвязанных данных</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3aproj-bst%29" class="toclink" data-pltdoc="x">19.5<span class="hspace">&nbsp;</span>Проект: BSTs</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3asimplification%29" class="toclink" data-pltdoc="x">19.6<span class="hspace">&nbsp;</span> Упрощение функций</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3afiles%29" class="toclink" data-pltdoc="x">20<span class="hspace">&nbsp;</span>Итерационное уточнение</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3afiles-what%29" class="toclink" data-pltdoc="x">20.1<span class="hspace">&nbsp;</span>Анализ данных</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3afiles-models%29" class="toclink" data-pltdoc="x">20.2<span class="hspace">&nbsp;</span>Уточнение определений данных</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3arefine-funcs%29" class="toclink" data-pltdoc="x">20.3<span class="hspace">&nbsp;</span>Уточнение Функции. 
</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3aevaluator%29" class="toclink" data-pltdoc="x">21<span class="hspace">&nbsp;</span>Уточнение Интерпретаторов</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3ainterpreter%29" class="toclink" data-pltdoc="x">21.1<span class="hspace">&nbsp;</span>Интерпретация выражений</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3ainterpreter-variables%29" class="toclink" data-pltdoc="x">21.2<span class="hspace">&nbsp;</span>Интерпретация переменных</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3ainterpreter-functions%29" class="toclink" data-pltdoc="x">21.3<span class="hspace">&nbsp;</span>Интерпретация  Функций</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3ainterpreter-all%29" class="toclink" data-pltdoc="x">21.4<span class="hspace">&nbsp;</span>Интерпретация всего</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3amoney-sexp%29" class="toclink" data-pltdoc="x">22<span class="hspace">&nbsp;</span>Проект: Торговля XML
</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3axml%29" class="toclink" data-pltdoc="x">22.1<span class="hspace">&nbsp;</span>XML как S-выражения</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3aenum%29" class="toclink" data-pltdoc="x">22.2<span class="hspace">&nbsp;</span>Отображение XML-перечислений</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3aconfig%29" class="toclink" data-pltdoc="x">22.3<span class="hspace">&nbsp;</span>Доменные языки</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sub~3areading-xml%29" class="toclink" data-pltdoc="x">22.4<span class="hspace">&nbsp;</span>Чтение XML</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3asimu%29" class="toclink" data-pltdoc="x">23<span class="hspace">&nbsp;</span>Одновременные обработки</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3atwo-inputs~3acase1%29" class="toclink" data-pltdoc="x">23.1<span class="hspace">&nbsp;</span>Одновременная обработка двух списков: случай 1
</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3atwo-inputs~3acase2%29" class="toclink" data-pltdoc="x">23.2<span class="hspace">&nbsp;</span>Одновременная обработка двух списков: случай 2</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3atwo-inputs~3acase3%29" class="toclink" data-pltdoc="x">23.3<span class="hspace">&nbsp;</span>Одновременная обработка двух списков: случай 3</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3atwo-inputs~3asimplify%29" class="toclink" data-pltdoc="x">23.4<span class="hspace">&nbsp;</span>Функция Упрощения</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3atwo-inputs~3adesign%29" class="toclink" data-pltdoc="x">23.5<span class="hspace">&nbsp;</span>Разработка функций, использующих два сложных входа</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._sec~3atwo-inputs~3aex%29" class="toclink" data-pltdoc="x">23.6<span class="hspace">&nbsp;</span>Упражнения для пальцев: два входа</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._db._sec~3aproj-db%29" class="toclink" data-pltdoc="x">23.7<span class="hspace">&nbsp;</span>Проект: База данных</a></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._ch~3asummary4%29" class="toclink" data-pltdoc="x">24<span class="hspace">&nbsp;</span> Резюме</a></p>

</td></tr></tbody></table>

<p>Вы можете подумать, что определения данных для списков и натуральных чисел довольно необычны.
Эти определения данных ссылающихся сами на себя, и, по всей вероятности, они являются первыми
такими определениями, с которыми вы когда-либо сталкивались. Как оказалось, многие классы 
данных требуют еще более сложных определений данных, чем эти два. Общие обобщения включают в 
себя множество ссылающихся на себя в одном определении данных или группу(пучёк) определений 
данных, которые ссылаются друг на друга. Эти формы данных стали повсеместными, и поэтому 
для программиста критически важно научиться справляться с любым набором определений данных.
 И в этом весь рецепт разработки. </p>

<p>Эта часть начинается с обобщения рецепта проектирования, чтобы он работал 
для всех форм <a name="(idx._(gentag._494))"></a>определений структурных данных. Затем она
вводит концепцию <a name="(idx._(gentag._495))"></a>итеративного уточнения из раздела
<a href="part_two.html#%28part._ch~3aproj-lists%29" data-pltdoc="x">Проекты: списки</a> 
на строгой основе, потому что сложные определения данных разрабатываются не одним махом, 
а в несколько этапов. Действительно, использование итеративного уточнения - одна из причин,
почему все программисты - маленькие ученые, и почему наша дисциплина использует слово «наука» 
в своем американском названии. Две последние главы иллюстрируют эти идеи: в одной объясняется,
как разработать интерпретатор для BSL, а в другой - об обработке XML, языка обмена данными 
для Интернета. Последняя глава расширяет рецепт проектирования еще раз, переработав его 
для функций, которые одновременно обрабатывают два сложных аргумента. </p>

<h3>19<tt>&nbsp;</tt><a name="(part._ch~3apoetry-sexp)"></a>Поэзия S-выражений</h3>

<p>Программирование похоже на поэзию. Подобно поэтам, программисты отрабатывают 
свои навыки на, казалось бы, бессмысленных идеях. Они все время пересматривают 
и редактируют, как объясняется в предыдущей главе. В этой главе вводятся все более 
сложные формы данных - по-видимому, без реальной цели. Даже когда мы предоставляем 
мотивационный фон, выбранные типы данных являются до крайности чистыми, и маловероятно, 
что вы когда-либо столкнетесь с ними снова. </p>

<p>Тем не менее, эта глава демонстрирует всю мощь рецепта проектирования и 
знакомит вас с типами данных, с которыми справляются реальные программы. 
Чтобы связать этот материал с тем, что вы встретите в своей жизни  программиста, 
мы помечаем каждый раздел соответствующими именами: деревья, леса, XML. 
Последнее немного вводит в заблуждение, потому что на самом деле оно касается 
S-выражений; связь между S-выражениями и XML разъясняется в разделе
<a href="#%28part._ch~3amoney-sexp%29" data-pltdoc="x">Проект: Коммерция на XML</a>, 
который, в отличие от этой главы, намного ближе к реальному использованию 
сложных форм данных. </p>

<h4>19.1<tt>&nbsp;</tt><a name="(part._sec~3abtrees)"></a>Деревья</h4>

<p>У всех нас есть родословная. Один из способов нарисовать генеалогическое древо - 
добавлять элемент каждый раз, когда рождается ребенок, и соединять элементы отца и матери. 
Тем людям, чьи родители неизвестны, не надо рисовать никакого отношения. В результате 
получается <span style="font-style: italic">ancestor family tree</span>(генеалогическое 
древо предков), потому что для любого человека дерево указывает 
на всех известных предков человека.
</p>

<blockquote class="Figure"><a name="(counter._(figure._fig~3afamily-tree))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><blockquote class="SCentered">

<p><img style="vertical-align: -0.0px; margin: -3px -3px -3px -3px;" src="part_four_files/pict_140.png" alt="image" width="283.2" height="170.78"></p>

</blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;111: </span>Семейное дерево</span></p>

</blockquote>

<p>На  <a href="#%28counter._%28figure._fig~3afamily-tree%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">111</span></a> показано трехуровневое генеалогическое древо. 
Густав - ребенок Евы и Фреда, а Ева - ребенок Карла и Беттины. Помимо имен людей и семейных
отношений, на дереве также записаны годы рождения и цвет глаз. Основываясь на этом эскизе, 
вы можете легко представить семейное древо, насчитывающее многие поколения и записывающее 
другие виды информации.</p>

<p></p>

<div class="SIntrapara">Если генеалогическое древо станет большим, имеет смысл представить 
его в виде данных и разработать программы, обрабатывающие такие данные. Учитывая, что точка
в генеалогическом древе объединяет пять элементов информации - об отце, матери, имени, 
дате рождения и цвете глаз - мы должны определить структурный тип: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">child</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">father</span><span class="hspace">&nbsp;</span><span class="RktSym">mother</span><span class="hspace">&nbsp;</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">date</span><span class="hspace">&nbsp;</span><span class="RktSym">eyes</span><span class="RktPn">]</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">Определение типа структуры вызывает 
определение данных: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._child)"></a><span style="font-style: italic">Child</span><span class="RktCmt"> is a structure: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="stt"> </span><a href="#%28tech._child%29" class="techoutside" data-pltdoc="x"><span class="techinside">Child</span></a><span class="stt"> </span><a href="#%28tech._child%29" class="techoutside" data-pltdoc="x"><span class="techinside">Child</span></a><span class="stt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="stt"> </span><a href="part_two.html#%28tech._n%29" class="techoutside" data-pltdoc="x"><span class="techinside">N</span></a><span class="stt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Хотя это определение данных выглядит простым, оно также и бесполезно. Он ссылается на себя, 
но, поскольку в нем нет предложений, нет способа создать правильный экземпляр 
<a href="#%28tech._child%29" class="techoutside" data-pltdoc="x"><span class="techinside">Child</span></a>. Грубо говоря, нам пришлось бы написать 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">без конца. Чтобы избежать таких бессмысленных
определений данных, мы потребуем, чтобы определение данных, ссылающихся на себя, 
имело несколько предложений и чтобы хотя бы одно из них не ссылалось на 
это определение данных, т.е имело "базовый случай". 
</div>

<p></p>

<p></p>

<div class="SIntrapara">Давайте на время отложим определение данных и поэкспериментируем.
Предположим, мы собираемся добавить ребенка(child) к существующему генеалогическому древу и 
что у нас уже есть представления для родителей. В этом случае мы можем просто построить 
новую <span class="RktSym">child</span>(дочернюю) структуру. Например, чтобы представить 
Адама в программе, которая уже представляет Карла и Беттину, достаточно добавить следующую
<span class="RktSym">child</span>(дочернюю) структуру: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Adam</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktSym">Carl</span><span class="hspace">&nbsp;</span><span class="RktSym">Bettina</span><span class="hspace">&nbsp;</span><span class="RktVal">"Adam"</span><span class="hspace">&nbsp;</span><span class="RktVal">1950</span><span class="hspace">&nbsp;</span><span class="RktVal">"hazel"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">если предположить, что 
<span class="RktSym">Carl</span> и <span class="RktSym">Bettina</span> олицетворяют 
родителей Адама.
</div>

<p></p>

<p></p>

<div class="SIntrapara">С другой стороны, родители человека могут быть неизвестны, 
как у Беттины в генеалогическом древе на  <a href="#%28counter._%28figure._fig~3afamily-tree%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">111</span></a>. 
Но даже в этом случае мы должны заполнить соответствующие родительские поля в 
<span class="RktSym">child</span> представлении. Какие бы данные мы ни выбрали, 
они должны сигнализировать об отсутствии информации. С одной стороны, мы могли бы 
использовать <span class="RktVal">#false</span>, <span class="RktVal">"none"</span>
или <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span> 
из пула существующих значений. С другой стороны, мы действительно должны сказать, 
что информация отсутствует в генеалогическом древе. Лучше всего достичь этой цели можно, 
введя структурный тип с соответствующим именем: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">no-parent</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">Теперь, чтобы построить 
<span class="RktSym">child</span> структуру для Беттины, мы говорим 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-no-parent</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-no-parent</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"Bettina"</span><span class="hspace">&nbsp;</span><span class="RktVal">1926</span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">Конечно, если отсутствует только одна часть информации, мы заполняем 
только это поле этим специальным значением.</div>

<p></p>

<p></p>

<div class="SIntrapara">Наши эксперименты позволяют сделать два вывода. Во-первых, 
мы ищем <span style="font-weight: bold">не</span> определение данных, описывающее, 
как создавать экземпляры <span class="RktSym">child</span> структур, 
а определение данных, описывающее, как представлять родословные деревья(Family Treee - FT). 
Во-вторых, определение данных состоит из двух предложений, одно для варианта, описывающего 
неизвестные родословные, и другое для известных генеалогических деревьев: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">no-parent</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">child</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">father</span><span class="hspace">&nbsp;</span><span class="RktSym">mother</span><span class="hspace">&nbsp;</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">date</span><span class="hspace">&nbsp;</span><span class="RktSym">eyes</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._ft)"></a><span style="font-style: italic">FT</span><span class="RktCmt"> (short for </span><span style="font-style: italic">family tree</span><span class="RktCmt">) is one of: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym">make-no-parent</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="stt"> </span><a href="#%28tech._ft%29" class="techoutside" data-pltdoc="x"><span class="techinside">FT</span></a><span class="stt"> </span><a href="#%28tech._ft%29" class="techoutside" data-pltdoc="x"><span class="techinside">FT</span></a><span class="stt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="stt"> </span><a href="part_two.html#%28tech._n%29" class="techoutside" data-pltdoc="x"><span class="techinside">N</span></a><span class="stt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Поскольку дерево “no parent”(без родителей) будет часто появляться в наших программах, 
мы определяем <span class="RktSym">NP</span> как сокращение и немного изменяем определение 
данных: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-no-parent</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><span style="font-style: italic">FT</span><span class="RktCmt"> is one of: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktSym">NP</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="stt"> </span><a href="#%28tech._ft%29" class="techoutside" data-pltdoc="x"><span class="techinside">FT</span></a><span class="stt"> </span><a href="#%28tech._ft%29" class="techoutside" data-pltdoc="x"><span class="techinside">FT</span></a><span class="stt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="stt"> </span><a href="part_two.html#%28tech._n%29" class="techoutside" data-pltdoc="x"><span class="techinside">N</span></a><span class="stt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Следуя рецепту проектирования из раздела <a href="part_two.html#%28part._ch~3adesign-lists%29" data-pltdoc="x">Проектирование с определениями  данных ссылающихся на себя</a>», мы используем определение данных для создания примеров
генеалогических деревьев. В частности, мы переводим генеалогическое древо на  
<a href="#%28counter._%28figure._fig~3afamily-tree%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">111</span></a> в наше представление данных. Информацию для Карла легко 
перевести в данные: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktVal">"Carl"</span><span class="hspace">&nbsp;</span><span class="RktVal">1926</span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">Беттина и Фред представлены с похожими 
экземплярами <span class="RktSym">child</span>. Случай для Адама требует вложенных 
<span class="RktSym">child</span>(детей), одного для Карла и одного для Беттины: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktVal">"Carl"</span><span class="hspace">&nbsp;</span><span class="RktVal">1926</span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktVal">"Bettina"</span><span class="hspace">&nbsp;</span><span class="RktVal">1926</span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"Adam"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">1950</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"hazel"</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Поскольку записи для Карла и Беттины также необходимы для создания записей для Дейва и Евы, 
лучше ввести определения, которые именуют конкретные экземпляры <span class="RktSym">child</span>
элемента, и использовать имена переменных где-нибудь еще. 
 <a href="#%28counter._%28figure._fig~3afamily.S%29%29" data-pltdoc="x">Рисунок&nbsp;<span class="FigureRef">112</span></a> иллюстрирует этот подход для полного представления данных
семейного древа из  <a href="#%28counter._%28figure._fig~3afamily-tree%29%29" data-pltdoc="x">рисунка&nbsp;<span class="FigureRef">111</span></a>. Внимательно посмотрите; 
дерево служит нашим рабочим примером для следующего упражнения по проектированию. </div>

<p></p>

<blockquote class="Figure"><a name="(counter._(figure._fig~3afamily.S))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Oldest Generation:</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Carl</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktVal">"Carl"</span><span class="hspace">&nbsp;</span><span class="RktVal">1926</span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Bettina</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktVal">"Bettina"</span><span class="hspace">&nbsp;</span><span class="RktVal">1926</span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Middle Generation:</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Adam</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktSym">Carl</span><span class="hspace">&nbsp;</span><span class="RktSym">Bettina</span><span class="hspace">&nbsp;</span><span class="RktVal">"Adam"</span><span class="hspace">&nbsp;</span><span class="RktVal">1950</span><span class="hspace">&nbsp;</span><span class="RktVal">"hazel"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Dave</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktSym">Carl</span><span class="hspace">&nbsp;</span><span class="RktSym">Bettina</span><span class="hspace">&nbsp;</span><span class="RktVal">"Dave"</span><span class="hspace">&nbsp;</span><span class="RktVal">1955</span><span class="hspace">&nbsp;</span><span class="RktVal">"black"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Eva</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktSym">Carl</span><span class="hspace">&nbsp;</span><span class="RktSym">Bettina</span><span class="hspace">&nbsp;</span><span class="RktVal">"Eva"</span><span class="hspace">&nbsp;</span><span class="RktVal">1965</span><span class="hspace">&nbsp;</span><span class="RktVal">"blue"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Fred</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktVal">"Fred"</span><span class="hspace">&nbsp;</span><span class="RktVal">1966</span><span class="hspace">&nbsp;</span><span class="RktVal">"pink"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Youngest Generation: </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Gustav</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktSym">Fred</span><span class="hspace">&nbsp;</span><span class="RktSym">Eva</span><span class="hspace">&nbsp;</span><span class="RktVal">"Gustav"</span><span class="hspace">&nbsp;</span><span class="RktVal">1988</span><span class="hspace">&nbsp;</span><span class="RktVal">"brown"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;112: </span>Представление данных образца генеалогического древа </span></p>

</blockquote>

<p></p>

<div class="SIntrapara">Вместо того, чтобы проектировать конкретную функцию на 
генеалогическом древе, давайте сначала посмотрим на общую организацию такой функции. 
То есть давайте проработаем рецепт разработки в максимально возможной степени, 
не имея в виду конкретной задачи. Начинаем с заголовочного материала, то есть с шага 2 
рецепта: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._ft%29" class="techoutside" data-pltdoc="x"><span class="techinside">FT</span></a><span class="RktCmt"> -&gt; ???</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span>...</td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fun-FT</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">Несмотря на то, что мы не указываем цель 
функции, мы знаем, что она использует генеалогическое древо и что эта форма данных является
основным входом. Знак “???” в сигнутуре говорит нам, что мы не знаем, какие данные производит
функция; “...” напоминают нам, что мы не знаем её цели.
</div>

<p></p>

<p></p>

<div class="SIntrapara">Отсутствие цели означает, что мы не можем создавать функциональные
примеры. Тем не менее, мы можем использовать организацию определения данных для 
<span class="RktSym">FT</span> для разработки шаблона. Поскольку она состоит из двух 
предложений, шаблон должен состоять из выражения <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span>
с двумя предложениями: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fun-FT</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">no-parent?</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Если аргумент <span class="RktSym">fun-FT</span> удовлетворяет 
параметру <span class="RktSym">no-parent?</span>, структура не содержит дополнительных данных,
поэтому первое предложение завершено. Для второго предложения входные данные содержат 
пять частей данных, которые мы указываем с помощью пяти селекторов в шаблоне: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._ft%29" class="techoutside" data-pltdoc="x"><span class="techinside">FT</span></a><span class="RktCmt"> -&gt; ???</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fun-FT</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">no-parent?</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-father</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-mother</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-name</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-date</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-eyes</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Последнее дополнение к шаблонам касается ссылок на себя. Если 
определение данных ссылается само на себя, функция, вероятно, будет рекурсивной, и 
шаблоны указывают на это с предполагаемыми естественными рекурсиями. Определение 
<a href="#%28tech._ft%29" class="techoutside" data-pltdoc="x"><span class="techinside">FT</span></a> имеет две ссылки на себя, поэтому шаблону нужны две такие рекурсии: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._ft%29" class="techoutside" data-pltdoc="x"><span class="techinside">FT</span></a><span class="RktCmt"> -&gt; ???</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fun-FT</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">no-parent?</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fun-FT</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-father</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fun-FT</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-mother</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-name</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-date</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-eyes</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
В частности, <span class="RktSym">fun-FT</span> применяется к представлению данных для 
отцов и матерей во втором предложении <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span>, потому что 
второе предложение определения данных содержит соответствующие ссылки на себя.</div>

<p></p>

<p></p>

<div class="SIntrapara">А теперь обратимся к конкретному примеру, функция 
<span class="RktSym">blue-eyed-child?</span>. Её цель - определить, есть ли у какой-либо 
<span class="RktSym">child</span> структуры в данном генеалогическом древе 
голубые глаза. Вы можете скопировать, вставить и переименовать <span class="RktSym">fun-FT</span>,
чтобы получить её шаблон; мы заменяем “???” на <a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a>(логическое
значение и добавляем предназначение:  <a name="(idx._(gentag._496))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._ft%29" class="techoutside" data-pltdoc="x"><span class="techinside">FT</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">does </span><span class="RktSym">an-ftree</span><span class="RktCmt"> contain a </span><span class="RktSym">child</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">structure with </span><span class="RktVal">"blue"</span><span class="RktCmt"> in the </span><span class="RktSym">eyes</span><span class="RktCmt"> field</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">no-parent?</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-father</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-mother</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-name</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-date</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-eyes</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Когда вы работаете таким образом, вы должны заменить общее имя шаблона конкретным именем.</div>

<p></p>

<p></p>

<div class="SIntrapara">Сверяясь с нашим рецептом, мы понимаем, что нам нужно вернуться 
назад и разработать некоторые примеры, прежде чем мы перейдем к этапу определения. 
Если мы начнем с Карла, первого лица в генеалогическом древе, мы увидим, что в 
генеалогическом древе Карла нет <span class="RktSym">child</span>(ребенка) с 
<span class="RktVal">"blue"</span>(голубым) цветом глаз. В частности, 
<span class="RktSym">child</span>(ребенок), представляющий Карла, говорит, что его
цвет глаз <span class="RktVal">"green"</span>(зеленый); учитывая, что деревья предков 
Карла пусты, они не могут содержать <span class="RktSym">child</span>(ребенка) с 
<span class="RktVal">"blue"</span>(голубым) цветом глаз: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktSym">Carl</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">Напротив, <span class="RktSym">Gustav</span>
(Густав) содержит <span class="RktSym">child</span>(ребенка) для 
<span class="RktSym">Eva</span>(Евы), у которого действительно голубые(blue) глаза: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktSym">Gustav</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span></p>

</blockquote></div>

<p></p>

<p>Теперь мы готовы определить фактическую функцию. Функция различает два случая: 
<span class="RktSym">no-parent</span>(нет родителя) и <span class="RktSym">child</span>. 
В первом случае ответ должен быть очевиден, хотя мы не приводили никаких примеров. 
Поскольку данное генеалогическое древо вообще не содержит <span class="RktSym">child</span>, 
оно не может содержать детей с <span class="RktVal">"blue"</span>(голубым) цветом глаз.
Следовательно, результат в первом предложении <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> будет 
<span class="RktVal">#false</span>.</p>

<p></p>

<div class="SIntrapara">Для второго предложения <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> проектирование
требует намного больше работы. Снова следуя рецепту разработки, мы сначала напоминаем себе, 
что выполняют выражения в шаблоне: 
</div><div class="SIntrapara"><ol><li>

<p></p>

<div class="SIntrapara">в соответствии с предназначением функции,
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-father</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">определяет, есть ли 
<span class="RktVal">"blue"</span>(голубые) глаза у какого либо
<span class="RktSym">child</span>(ребенка) в отцовском 
<a href="#%28tech._ft%29" class="techoutside" data-pltdoc="x"><span class="techinside">FT</span></a>;
</div>

<p></p>

</li><li>

<p>   аналогичным образом <span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">child-mother</span><span class="stt"> </span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="RktPn">)</span> определяет, есть ли у кого-то в 
<a href="#%28tech._ft%29" class="techoutside" data-pltdoc="x"><span class="techinside">FT</span></a> матери голубые глаза; а также</p>

</li><li>

<p>выражения селектора <span class="RktPn">(</span><span class="RktSym">child-name</span><span class="stt"> </span><span class="RktSym">an-ftree</span><span class="RktPn">)</span>,
<span class="RktPn">(</span><span class="RktSym">child-date</span><span class="stt"> </span><span class="RktSym">an-ftree</span><span class="RktPn">)</span> и <span class="RktPn">(</span><span class="RktSym">child-eyes</span><span class="stt"> </span><span class="RktSym">an-ftree</span><span class="RktPn">)</span> извлекают имя, дату рождения и цвет глаз из заданной 
<span class="RktSym">child</span>(дочерней) структуры соответственно.
</p>

</li></ol></div><div class="SIntrapara">Теперь нам просто нужно выяснить, как объединить 
эти выражения. </div>

<p></p>

<p>Ясно, что если <span class="RktSym">child</span>(дочерняя) структура содержит 
<span class="RktVal">"blue"</span>(синий) в поле <span class="RktSym">eyes</span>, функция 
ответит <span class="RktVal">#true</span>. Далее, выражения, касающиеся имен и дат рождения,
бесполезны, остаются рекурсивные вызовы. Как уже говорилось, <span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">child-father</span><span class="stt"> </span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="RktPn">)</span> пересекает(проходит) дерево 
со стороны отца, в то время как со стороны матери семейное дерево обрабатывается с помощью
<span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">child-mother</span><span class="stt"> </span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="RktPn">)</span>.
Если любое из этих выражений возвращает <span class="RktVal">#true</span>, 
<span class="RktSym">an-ftree</span> содержит <span class="RktSym">child</span>(ребенка)
 с <span class="RktVal">"blue"</span>(голубыми) глазами.</p>

<p></p>

<div class="SIntrapara">Наш анализ показывает, что результат должен быть 
<span class="RktVal">#true</span>, если одно из следующих трех выражений -
<span class="RktVal">#true</span>:
</div><div class="SIntrapara"><ul><li>

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3d~3f%29%29" class="RktValLink" data-pltdoc="x">string=?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">child-eyes</span><span class="stt"> </span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktVal">"blue"</span><span class="RktPn">)</span></p>

</li><li>

<p><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">child-father</span><span class="stt"> </span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="RktPn">)</span></p>

</li><li>

<p><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">child-mother</span><span class="stt"> </span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="RktPn">)</span></p>

</li></ul></div><div class="SIntrapara">
что, в свою очередь, означает, что нам нужно объединить эти выражения с помощью
<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3d~3f%29%29" class="RktValLink" data-pltdoc="x">string=?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-eyes</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"blue"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-father</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-mother</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara"><a href="#%28counter._%28figure._fig~3ablue-eyes%29%29" data-pltdoc="x">Рисунок&nbsp;<span class="FigureRef">113</span></a> объединяет все в одном определении. .</div>

<p></p>

<p></p>

<div class="SIntrapara"><a name="(idx._(gentag._497))"></a>
</div><div class="SIntrapara"><blockquote class="Figure"><a name="(counter._(figure._fig~3ablue-eyes))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._ft%29" class="techoutside" data-pltdoc="x"><span class="techinside">FT</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">does </span><span class="RktSym">an-ftree</span><span class="RktCmt"> contain a </span><span class="RktSym">child</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">structure with </span><span class="RktVal">"blue"</span><span class="RktCmt"> in the </span><span class="RktSym">eyes</span><span class="RktCmt"> field</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktSym">Carl</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktSym">Gustav</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">no-parent?</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3d~3f%29%29" class="RktValLink" data-pltdoc="x">string=?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-eyes</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"blue"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-father</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-mother</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;113: </span>Поиск голубоглазого ребенка в дереве предков</span></p>

</blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Поскольку эта функция является самой первой, использующей двойную
рекурсию, мы имитируем действие пошагового исполнителя для <span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="stt"> </span><span class="RktSym">Carl</span><span class="RktPn">)</span>, 
чтобы дать вам представление о том, как все это работает: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktSym">Carl</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktSym">==</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktVal">"Carl"</span><span class="hspace">&nbsp;</span><span class="RktVal">1926</span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Давайте действовать так, как если бы  <span class="RktSym">NP</span> было значением, 
и давайте использовать <span class="RktSym">carl</span> как аббревиатуру для экземпляра 
<span class="RktSym">child</span>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktSym">==</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">no-parent?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktVal">"Carl"</span><span class="hspace">&nbsp;</span><span class="RktVal">1926</span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#false</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3d~3f%29%29" class="RktValLink" data-pltdoc="x">string=?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-eyes</span><span class="hspace">&nbsp;</span><span class="RktSym">carl</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"blue"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-father</span><span class="hspace">&nbsp;</span><span class="RktSym">carl</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-mother</span><span class="hspace">&nbsp;</span><span class="RktSym">carl</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
После отбрасывания первой строки <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> пора заменить 
<span class="RktSym">carl</span> на его значение и выполнить три вспомогательных вычисления,
показанных на <a href="#%28counter._%28figure._fig~3acalc-trees%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">114</span></a>. Используя их для замены 
equals на equals, остальная часть вычислений легко объясняется: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktSym">==</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3d~3f%29%29" class="RktValLink" data-pltdoc="x">string=?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="hspace">&nbsp;</span><span class="RktVal">"blue"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-father</span><span class="hspace">&nbsp;</span><span class="RktSym">carl</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-mother</span><span class="hspace">&nbsp;</span><span class="RktSym">carl</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Хотя мы уверены, что вы видели такие вспомогательные вычисления в своих курсах математики, 
вам также необходимо понимать, что пошаговый исполнитель 
<span style="font-weight: bold">не</span> будет выполнять такие вычисления; вместо этого он
выполняет только те вычисления, которые абсолютно необходимы. </div>

<p></p>

<blockquote class="Herefigure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">(1)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">child-eyes</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktVal">"Carl"</span><span class="hspace">&nbsp;</span><span class="RktVal">1926</span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktSym">==</span></td></tr><tr><td><span class="RktVal">"green"</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">(2)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-father</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktVal">"Carl"</span><span class="hspace">&nbsp;</span><span class="RktVal">1926</span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktSym">==</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktSym">==</span></td></tr><tr><td><span class="RktVal">#false</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">(3)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-mother</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-child</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="hspace">&nbsp;</span><span class="RktVal">"Carl"</span><span class="hspace">&nbsp;</span><span class="RktVal">1926</span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktSym">==</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktSym">NP</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktSym">==</span></td></tr><tr><td><span class="RktVal">#false</span></td></tr></tbody></table></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3acalc-trees))" x-target-lift="Figure"></a>Рисунок&nbsp;114: </span> Вычисления с деревьями </span></p>

</blockquote>

<p><a name="(counter._(exercise._ex~3acount-ft))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;310. Разработайте <span class="RktSym">count-persons</span>. Функция использует
генеалогическое древо и подсчитывает <span class="RktSym">child</span>(дочерние) структуры 
в дереве. 
<a href="#%28counter._%28exercise._ex~3acount-ft%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3aage-ft))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;311. Разработайте функцию <span class="RktSym">average-age</span>. Она 
потребляет генеалогическое древо и текущий год. Она дает средний возраст всех 
<span class="RktSym">child</span> структур в генеалогическом древе. 
<a href="#%28counter._%28exercise._ex~3aage-ft%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3aec-ft))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;312.   Разработайте функцию <span class="RktSym">eye-colors</span>, которая 
потребляет генеалогическое древо и создает список всех цветов глаз в дереве. Цвет глаз 
может встречаться в итоговом списке более одного раза. 
<span style="font-weight: bold">Совет</span>. Используйте <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._append%29%29" class="RktValLink" data-pltdoc="x">append</a></span> для объединения списков, полученных в результате 
рекурсивных вызовов. 
 <a href="#%28counter._%28exercise._ex~3aec-ft%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3aproper-bea))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;313. Предположим, нам нужна функция <span class="RktSym">blue-eyed-ancestor?</span> ?,
которая похожа на <span class="RktSym">blue-eyed-child?</span> но отвечает 
<span class="RktVal">#true</span> только тогда, когда у настоящего предка, а не у данного 
<span class="RktSym">child</span>(ребенка), были голубые глаза.</p>

<p></p>

<div class="SIntrapara">Хотя цели явно различаются, подписи те же: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._ft%29" class="techoutside" data-pltdoc="x"><span class="techinside">FT</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-ancestor?</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Стоп! Сформулируйте предназначение для функции.</div>

<p></p>

<p></p>

<div class="SIntrapara">Чтобы оценить разницу, посмотрим на Еву: :
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktSym">Eva</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">Ева голубоглазая, но не имеет голубоглазых предков.
Следовательно, 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-ancestor?</span><span class="hspace">&nbsp;</span><span class="RktSym">Eva</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">Напротив, Густав - сын Евы, и у него действительно 
есть голубоглазый предок: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-ancestor?</span><span class="hspace">&nbsp;</span><span class="RktSym">Gustav</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span></p>

</blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Теперь предположим, что друг придумал это решение:
<a name="(idx._(gentag._498))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-ancestor?</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">no-parent?</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-ancestor?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-father</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-ancestor?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">child-mother</span><span class="hspace">&nbsp;</span><span class="RktSym">an-ftree</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Объясните, почему эта функция не проходит один из тестов. Каков результат 
<span class="RktPn">(</span><span class="RktSym">blue-eyed-ancestor?</span><span class="stt"> </span><span class="RktSym">A</span><span class="RktPn">)</span> независимо от того, какой 
<span class="RktSym">A</span> вы выберете? Можете ли вы исправить решение вашего друга?  
<a href="#%28counter._%28exercise._ex~3aproper-bea%29%29" class="ex-end" data-pltdoc="x"></a></div>

<p></p>

<h4>19.2<tt>&nbsp;</tt><a name="(part._sec~3aforests)"></a>Леса(Forests)</h4>

<p></p>

<div class="SIntrapara">От генеалогического древа до семейного леса всего несколько шагов: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._ff)"></a><span style="font-style: italic">FF</span><span class="RktCmt"> (short for </span><span style="font-style: italic">family forest</span><span class="RktCmt">) is one of: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="#%28tech._ft%29" class="techoutside" data-pltdoc="x"><span class="techinside">FT</span></a><span class="stt"> </span><a href="#%28tech._ff%29" class="techoutside" data-pltdoc="x"><span class="techinside">FF</span></a><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span style="font-weight: bold">interpretation</span><span class="RktCmt"> a family forest represents several</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">families (say, a town) and their ancestor trees</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Вот некоторые фрагменты деревьев с  <a href="#%28counter._%28figure._fig~3afamily-tree%29%29" data-pltdoc="x">рисунка&nbsp;<span class="FigureRef">111</span></a>, расположенные в виде лесов: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ff1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Carl</span><span class="hspace">&nbsp;</span><span class="RktSym">Bettina</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ff2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Fred</span><span class="hspace">&nbsp;</span><span class="RktSym">Eva</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ff3</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Fred</span><span class="hspace">&nbsp;</span><span class="RktSym">Eva</span><span class="hspace">&nbsp;</span><span class="RktSym">Carl</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">Первые два леса содержат два несвязанных семейства, 
а третий показывает, что, в отличие от настоящих лесов, деревья в семейных лесах могут
перекрываться.</div>

<p></p>

<p></p>

<div class="SIntrapara">Теперь рассмотрим эту типичную проблему, касающуюся генеалогических
 деревьев:
</div><div class="SIntrapara"><blockquote>

<p><span style="font-weight: bold">Пример Задачи</span> Создайте функцию 
<span class="RktSym">blue-eyed-child-in-forest?</span>, которая определяет, есть ли в 
семейном лесу <span class="RktSym">child</span>(ребенок) с 
<span class="RktVal">"blue"</span>(голубое) в поле <span class="RktSym">eyes</span>(глаза).</p>

</blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara"><a name="(idx._(gentag._499))"></a>
</div><div class="SIntrapara"><blockquote class="Herefigure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._ff%29" class="techoutside" data-pltdoc="x"><span class="techinside">FF</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">does the forest contain any </span><span class="RktSym">child</span><span class="RktCmt"> with </span><span class="RktVal">"blue"</span><span class="RktCmt"> </span><span class="RktSym">eyes</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child-in-forest?</span><span class="hspace">&nbsp;</span><span class="RktSym">ff1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child-in-forest?</span><span class="hspace">&nbsp;</span><span class="RktSym">ff2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child-in-forest?</span><span class="hspace">&nbsp;</span><span class="RktSym">ff3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child-in-forest?</span><span class="hspace">&nbsp;</span><span class="RktSym">a-forest</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a-forest</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a-forest</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">blue-eyed-child-in-forest?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a-forest</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3ablue-eyed-child))" x-target-lift="Figure"></a>Рисунок&nbsp;115: </span>Как найти голубоглазого ребенка в семейном лесу </span></p>

</blockquote></div>

<p></p>

<p>Простое решение показано на  <a href="#%28counter._%28figure._fig~3ablue-eyed-child%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">115</span></a>. Изучите сигнатуру, 
предназначение и примеры самостоятельно. Мы ориентируемся на программную организацию. 
Что касается шаблона, проектирование может использовать шаблон списка, потому что функция
использует список. Если бы каждый элемент в списке был структурой с полем 
<span class="RktSym">eyes</span> и ничем другим, функция перебирала бы эти структуры, 
используя функцию селектора для поля <span class="RktSym">eyes</span> и сравнение строк. 
В данном случае каждый элемент является генеалогическим деревом, но, к счастью, мы уже знаем, 
как обрабатывать родословные деревья. </p>

<p>Давайте сделаем шаг назад и посмотрим, как мы объяснили 
 <a href="#%28counter._%28figure._fig~3ablue-eyed-child%29%29" data-pltdoc="x">рисунок&nbsp;<span class="FigureRef">115</span></a>. Отправной точкой является 
<span style="font-weight: bold">pair</span>(пара) определений данных, где второе 
ссылается на первое, а оба ссылаются на себя. В результате получается пара функций, 
в которой вторая ссылается к первой, а обе ссылаются к себе. Другими словами, определения 
функций относятся друг к другу так же, как определения данных относятся друг к другу. 
В первых главах такого рода отношения замалчиваются, но сейчас ситуация достаточно сложная 
и заслуживает внимания. </p>

<p><a name="(counter._(exercise._ex~3afamily-forest1))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;314. Переформулируйте определение данных для 
<a href="#%28tech._ff%29" class="techoutside" data-pltdoc="x"><span class="techinside">FF</span></a> с помощью абстракции <a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a>. А теперь сделать то же самое для
функции <span class="RktSym">blue-eyed-child-in-forest?</span>. Наконец, дайте определение
<span class="RktSym">blue-eyed-child-in-forest?</span> используя одну из абстракций списка 
из предыдущей главы.
<a href="#%28counter._%28exercise._ex~3afamily-forest1%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3afamily-forest2))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;315.  Разработайте функцию <span class="RktSym">average-age</span>.
Потребляет семейный лес и год(<a href="part_two.html#%28tech._n%29" class="techoutside" data-pltdoc="x"><span class="techinside">N</span></a>). На основе этих данных получается 
средний возраст всех <span class="RktSym">child</span>(дочерних) экземпляров в лесу. 
<span style="font-weight: bold">Примечание</span> Если деревья в этом лесу перекрывают друг 
друга, результат не является истинным средним значением, потому что одни люди вносят 
больший вклад, чем другие. В этом упражнении действуйте так, как будто деревья 
не пересекаются. 
 <a href="#%28counter._%28exercise._ex~3afamily-forest2%29%29" class="ex-end" data-pltdoc="x"></a></p>

<h4>19.3<tt>&nbsp;</tt><a name="(part._sec~3asexp)"></a>S-выражения</h4>

<p></p>

<div class="SIntrapara">Хотя <a href="i2-3.html" data-pltdoc="x">Intermezzo 2: Quote, Unquote</a>
представило S-выражения на неформальной основе, их можно описать с помощью комбинации 
трех определений данных: 
</div><div class="SIntrapara"><blockquote><table cellspacing="0" cellpadding="0"><tbody><tr><td valign="top" align="left"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._s._expr)"></a><span style="font-style: italic">S-expr</span><span class="RktCmt"> is one of: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><a href="#%28tech._sl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SL</span></a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._sl)"></a><span style="font-style: italic">SL</span><span class="RktCmt"> is one of: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a><span class="stt"> </span><a href="#%28tech._sl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SL</span></a><span class="RktPn">)</span></td></tr></tbody></table></td><td valign="top" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td valign="top" align="left"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._atom)"></a><span style="font-style: italic">Atom</span><span class="RktCmt"> is one of: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><a href="part_one.html#%28tech._number%29" class="techoutside" data-pltdoc="x"><span class="techinside">Number</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="RktCmt"> </span></td></tr></tbody></table></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Напомним, что <a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a>(символы) выглядят как строки с одинарными 
кавычками в начале и без кавычек в конце.
</div>

<p></p>

<p>Идея S-выражений принадлежит Джону Маккарти и его Лисперам, которые создали 
S-выражения в 1958 году, чтобы они могли обрабатывать программы на Лиспе с 
помощью других программам на Лиспе. Это, казалось бы, замкнутое рассуждение может показаться
эзотерическим, но, как упоминалось в <a href="i2-3.html" data-pltdoc="x">Intermezzo 2: Quote, Unquote</a>, S-expression - это универсальная форма данных, которая часто открывается заново, 
в последнее время с приложениями во всемирной паутине. Таким образом, работа с S-выражениями
подготавливает обсуждение того, как разрабатывать функции для сильно взаимосвязанных 
определений данных. </p>

<p><a name="(counter._(exercise._ex~3aatom))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;316. Определить функцию <span class="RktSym">atom?</span>. 
<a href="#%28counter._%28exercise._ex~3aatom%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p></p>

<div class="SIntrapara">До этого момента в этой книге никакие данные не требовали 
такого сложного определения данных, как определение S-выражений. И все же, с одним 
дополнительным советом, вы можете создавать функции, которые обрабатывают S-выражения, 
если вы будете следовать рецепту разработки. Чтобы продемонстрировать это, давайте 
рассмотрим конкретный пример:
</div><div class="SIntrapara"><blockquote>

<p><span style="font-weight: bold">Пример задачи</span>  Создайте функцию 
<span class="RktSym">count</span>, которая определяет, сколько раз какой-либо символ 
встречается в каком-либо S-выражении.
</p>

</blockquote></div><div class="SIntrapara">Хотя первый шаг требует определений данных и 
кажется завершенным, помните, что он также требует создания примеров данных, особенно 
когда определение является сложным. </div>

<p></p>

<p></p>

<div class="SIntrapara">Предполагается, что определение данных является рецептом того, 
как создавать данные, а его «тестом» является то, можно ли их использовать. Один момент, 
который делает определение данных для <a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a>, заключается в том, что каждый 
<a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a> является элементом <a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a>, и вы знаете, что 
<a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a> легко изготовить: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktVal">'</span><span class="RktVal">hello</span></td></tr><tr><td><span class="RktVal">20.12</span></td></tr><tr><td><span class="RktVal">"world"</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Точно так же каждый <a href="#%28tech._sl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SL</span></a> представляет собой список, а также <a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">hello</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktVal">20.12</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"world"</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">hello</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktVal">20.12</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"world"</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">Первые два очевидны; третье 
заслуживает повторного взгляда. Оно повторяет второе <a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a>, но вложено внутрь
<span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span>. 
Это означает, что это список, содержащий единственный элемент, а именно второй пример. 
Вы можете упростить пример с помощью  <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">hello</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktVal">20.12</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"world"</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">or </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">hello</span><span class="hspace">&nbsp;</span><span class="RktVal">20.12</span><span class="hspace">&nbsp;</span><span class="RktVal">"world"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Действительно, с механизмом цитирования  <a href="i2-3.html" data-pltdoc="x">Intermezzo 2: Quote, Unquote</a> писать S-выражения еще проще. 
Вот последние три: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="stt">&gt; </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span></td></tr><tr><td>

<p><span class="RktRes">'()</span></p>

</td></tr><tr><td><span class="stt">&gt; </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">hello</span><span class="hspace">&nbsp;</span><span class="RktVal">20.12</span><span class="hspace">&nbsp;</span><span class="RktVal">"world"</span><span class="RktVal">)</span></td></tr><tr><td>

<p><span class="RktRes">(list 'hello #i20.12 "world")</span></p>

</td></tr><tr><td><span class="stt">&gt; </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">hello</span><span class="hspace">&nbsp;</span><span class="RktVal">20.12</span><span class="hspace">&nbsp;</span><span class="RktVal">"world"</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td>

<p><span class="RktRes">(list (list 'hello #i20.12 "world"))</span></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Чтобы помочь вам, мы вычисляем эти примеры в области взаимодействия DrRacket, чтобы вы 
могли видеть результат, который ближе к приведенным выше конструкциям, 
чем обозначение цитирования(<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._quote%29%29" class="RktStxLink" data-pltdoc="x">quote</a></span>).</div>

<p></p>

<p></p>

<div class="SIntrapara">С помощью <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._quote%29%29" class="RktStxLink" data-pltdoc="x">quote</a></span> 
довольно легко составить сложные примеры: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="stt">&gt; </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">define</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">f</span><span class="hspace">&nbsp;</span><span class="RktVal">x</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktVal">x</span><span class="hspace">&nbsp;</span><span class="RktVal">55</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr></tbody></table></td></tr><tr><td>

<p><span class="RktRes">(list 'define (list 'f 'x) (list '+ 'x 55))</span></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">Этот пример может 
показаться вам странным, потому что он выглядит как определение в BSL, но, как показывает
взаимодействие с DrRacket, это всего лишь фрагмент данных. Вот еще один: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="stt">&gt; </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">f</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">e</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktVal">d</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr></tbody></table></td></tr><tr><td>

<p><span class="RktRes">(list (list 6 'f) (list 5 'e) (list 4 'd))</span></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">Этот фрагмент данных 
выглядит как таблица, в которой буквы ассоциированы с числами. Последний пример - 
произведение искусства: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="stt">&gt; </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">wing</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">wing</span><span class="hspace">&nbsp;</span><span class="RktVal">body</span><span class="hspace">&nbsp;</span><span class="RktVal">wing</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">wing</span><span class="RktVal">)</span></td></tr><tr><td>

<p><span class="RktRes">(list 'wing (list 'wing 'body 'wing) 'wing)</span></p>

</td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Пришло время записать довольно очевидный заголовок для 
 <span class="RktSym">count</span>:
<a name="(idx._(gentag._500))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a><span class="RktCmt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="RktCmt"> -&gt; </span><a href="part_two.html#%28tech._n%29" class="techoutside" data-pltdoc="x"><span class="techinside">N</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">counts all occurrences of </span><span class="RktSym">sy</span><span class="RktCmt"> in </span><span class="RktSym">sexp</span><span class="RktCmt"> </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Поскольку заголовок очевиден, переходим к функциональным примерам. Если заданное 
<a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a> -  <span class="RktVal">'</span><span class="RktVal">world</span>(мир), 
а символ для подсчета - <span class="RktVal">'</span><span class="RktVal">world</span>, 
ответ, очевидно, будет <span class="RktVal">1</span>. Вот еще несколько примеров, 
сразу же сформулированных как тесты: :
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">world</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">hello</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">world</span><span class="hspace">&nbsp;</span><span class="RktVal">hello</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">hello</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">world</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">hello</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">hello</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">hello</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Вы можете видеть, насколько удобны обозначения цитирования для тестовых случаев. 
Однако когда дело доходит до шаблонов, мыслить в терминах цитат(<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._quote%29%29" class="RktStxLink" data-pltdoc="x">quote</a></span>) это катастрофа.
</div>

<p></p>

<p></p>

<div class="SIntrapara">Прежде чем мы перейдем к шагу шаблона, нам нужно подготовить вас 
к следующему обобщению рецепта разработки: 
</div><div class="SIntrapara"><blockquote>

<p><span style="font-weight: bold">Совет</span> Для взаимосвязанных определений данных
создайте по одному шаблону для каждого определения данных. Создавайте их параллельно.
Убедитесь, что они ссылаются друг на друга так же, как и определения данных.  <span style="font-weight: bold">Конец</span></p>

</blockquote></div><div class="SIntrapara">Эта подсказка звучит сложнее, чем есть на самом деле.
Для нашей задачи это означает, что нам нужны три шаблона:
</div><div class="SIntrapara"><ol><li>

<p> один для <span class="RktSym">count</span>(счетчика), который считает появления 
символов в S-выражениях(<a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a>);</p>

</li><li>

<p>один для функции, которая считает вхождения символов в <a href="#%28tech._sl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SL</span></a>; а также</p>

</li><li>

<p> один для функции, которая считает вхождения символов в атомах
(<a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a>).</p>

</li></ol></div>

<p></p>

<p></p>

<div class="SIntrapara">А вот три частичных шаблона с условными выражениями, предложенными 
тремя определениями данных:
</div><div class="SIntrapara"><blockquote><table cellspacing="0" cellpadding="0"><tbody><tr><td valign="top" align="left"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">atom?</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-sl</span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></td><td valign="top" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td valign="top" align="left"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-atom</span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._number~3f%29%29" class="RktValLink" data-pltdoc="x">number?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29" class="RktValLink" data-pltdoc="x">symbol?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Шаблон для <span class="RktSym">count</span> содержит двойное условное выражение
<a name="(idx._(gentag._501))"></a>, потому что определение данных для 
<a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a> имеет два предложения. Использует функцию <span class="RktSym">atom?</span>,
чтобы отличать случай для атомов(<a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a>) от случая для <a href="#%28tech._sl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SL</span></a>. Шаблон с именем 
<span class="RktSym">count-sl</span> потребляет элемент <a href="#%28tech._sl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SL</span></a> и символ, 
а поскольку <a href="#%28tech._sl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SL</span></a> в основном является списком, <span class="RktSym">count-sl</span>
также содержит двустороннее условие <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span>. 
Наконец, предполагается, что <span class="RktSym">count-atom</span> работает как с атомами
(<a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a>), так и с символами(<a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a>). А это означает, что его шаблон проверяет
наличие трех различных форм данных, упомянутых в определении данных 
<a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a>.</div>

<p></p>

<p></p>

<div class="SIntrapara">Следующим шагом является разбиение составных данных на 
соответствующие предложения: 
</div><div class="SIntrapara"><blockquote><table cellspacing="0" cellpadding="0"><tbody><tr><td valign="top" align="left"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">atom?</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-sl</span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></td><td valign="top" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p>

</td><td valign="top" align="left"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-atom</span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._number~3f%29%29" class="RktValLink" data-pltdoc="x">number?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29" class="RktValLink" data-pltdoc="x">symbol?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Почему мы добавляем только два выражения селектора в 
<span class="RktSym">count-sl</span>?</div>

<p></p>

<p></p>

<div class="SIntrapara">Последний шаг в процессе создания шаблона требует проверки ссылок 
на себя в определениях данных. В нашем контексте это означает ссылки на себя 
<span style="font-weight: bold">и</span> ссылки из одного определения данных на другое 
и (возможно) обратно. Давайте проверим строки условий в трех шаблонах: 
</div><div class="SIntrapara"><ol><li>

<p><span class="RktSym">atom?</span> строка в <span class="RktSym">count</span> соответствует
первой строке в определении <a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a>. Чтобы указать перекрестную ссылку отсюда на 
<a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a>, мы добавляем <span class="RktPn">(</span><span class="RktSym">count-atom</span><span class="stt"> </span><span class="RktSym">sexp</span><span class="stt"> </span><span class="RktSym">sy</span><span class="RktPn">)</span>, что означает, что мы интерпретируем 
<span class="RktSym">sexp</span> как <a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a> и позволяем соответствующей функции
обрабатывать его.</p>

</li><li>

<p>Следуя той же мысли, вторая строка <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> в 
<span class="RktSym">count</span> требует добавления  <span class="RktPn">(</span><span class="RktSym">count-sl</span><span class="stt"> </span><span class="RktSym">sexp</span><span class="stt"> </span><span class="RktSym">sy</span><span class="RktPn">)</span>.</p>

</li><li>

<p><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span> строка в 
<span class="RktSym">count-sl</span> соответствует строке в определении данных, которая 
не ссылается на другое определение данных.</p>

</li><li>

<p>Напротив, строка <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span> содержит два выражения селектора, 
каждое из которых извлекает значения разного типа. В частности, <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="stt"> </span><span class="RktSym">sl</span><span class="RktPn">)</span> является элементом 
<a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a>, что означает, что мы заключаем его в <span class="RktPn">(</span><span class="RktSym">count</span><span class="stt"> </span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span>. В конце концов, <span class="RktSym">count</span>
 отвечает за подсчет внутри произвольных <a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a>. Затем <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="stt"> </span><span class="RktSym">sl</span><span class="RktPn">)</span> соответствует ссылке на себя, 
и мы знаем, что нам нужно иметь дело с ними с помощью рекурсивных вызовов функций.</p>

</li><li>

<p>Наконец, все три случая в <a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a> относятся к атомарным формам данных. Следовательно, функцию
<span class="RktSym">count-atom</span> изменять не нужно. </p>

</li></ol></div>

<p></p>

<p></p>

<div class="SIntrapara"><a name="(idx._(gentag._502))"></a>
<a name="(idx._(gentag._503))"></a>
</div><div class="SIntrapara"><blockquote class="Figure"><a name="(counter._(figure._fig~3asexp-template))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><table cellspacing="0" cellpadding="0"><tbody><tr><td valign="top" align="left"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">atom?</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-atom</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-sl</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-sl</span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-sl</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td><td valign="top" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td valign="top" align="left"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-atom</span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._number~3f%29%29" class="RktValLink" data-pltdoc="x">number?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29" class="RktValLink" data-pltdoc="x">symbol?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;116: </span>Шаблон для S-выражений </span></p>

</blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara"><a name="(idx._(gentag._504))"></a>
<a name="(idx._(gentag._505))"></a>
<a name="(idx._(gentag._506))"></a>
</div><div class="SIntrapara"><blockquote class="Figure"><a name="(counter._(figure._fig~3asexp-function))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a><span class="RktCmt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="RktCmt"> -&gt; </span><a href="part_two.html#%28tech._n%29" class="techoutside" data-pltdoc="x"><span class="techinside">N</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">counts all occurrences of </span><span class="RktSym">sy</span><span class="RktCmt"> in </span><span class="RktSym">sexp</span><span class="RktCmt"> </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">atom?</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-atom</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-sl</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._sl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SL</span></a><span class="RktCmt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="RktCmt"> -&gt; </span><a href="part_two.html#%28tech._n%29" class="techoutside" data-pltdoc="x"><span class="techinside">N</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">counts all occurrences of </span><span class="RktSym">sy</span><span class="RktCmt"> in </span><span class="RktSym">sl</span><span class="RktCmt"> </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-sl</span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-sl</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a><span class="RktCmt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="RktCmt"> -&gt; </span><a href="part_two.html#%28tech._n%29" class="techoutside" data-pltdoc="x"><span class="techinside">N</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">counts all occurrences of </span><span class="RktSym">sy</span><span class="RktCmt"> in </span><span class="RktSym">at</span><span class="RktCmt"> </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-atom</span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._number~3f%29%29" class="RktValLink" data-pltdoc="x">number?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29" class="RktValLink" data-pltdoc="x">symbol?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3d~3f%29%29" class="RktValLink" data-pltdoc="x">symbol=?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;117: </span>Программа для S-выражений </span></p>

</blockquote></div>

<p></p>

<p> На  <a href="#%28counter._%28figure._fig~3asexp-template%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">116</span></a> представлены три полных шаблона. 
Как показано на  <a href="#%28counter._%28figure._fig~3asexp-function%29%29" data-pltdoc="x">рис.&nbsp;<span class="FigureRef">117</span></a>, заполнить пробелы в 
этих шаблонах несложно. Вы должны уметь объяснить любую случайную строчку в 
трех определениях. Например: </p>

<blockquote class="SCodeFlow">

<p><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">atom?</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-atom</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span><span class="RktPn">]</span></p>

</blockquote>

<p> определяет, является ли <span class="RktSym">sexp</span> атомом(<a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a>), и, если да,
интерпретирует S-выражение(<a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a>) как атом(<a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a>) через  
 <span class="RktSym">count-atom</span>.</p>

<blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">count-sl</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr></tbody></table></blockquote>

<p>означает, что данный список состоит из двух частей: <a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a> и 
<a href="#%28tech._sl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SL</span></a>. Используя <span class="RktSym">count</span> и <span class="RktSym">count-sl</span>,
соответствующие функции используются для подсчета того, как часто <span class="RktSym">sy</span>
появляется в каждой части, и два числа складываются, давая общее количество 
<span class="RktSym">sy</span> во всем  <span class="RktSym">sexp</span>.</p>

<blockquote class="SCodeFlow">

<p><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29" class="RktValLink" data-pltdoc="x">symbol?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3d~3f%29%29" class="RktValLink" data-pltdoc="x">symbol=?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="hspace">&nbsp;</span><span class="RktSym">sy</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">]</span></p>

</blockquote>

<p> говорит нам, что если <a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a> является символом(<a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a>), 
<span class="RktSym">sy</span> встречается один раз, если он равен 
<span class="RktSym">sexp</span>, а в противном случае не встречается вообще. 
Поскольку две части данных являются атомарными, другой возможности нет. </p>

<p><a name="(counter._(exercise._ex~3acount-local))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;317. Программа, состоящая из трех связанных функций, должна 
выражать эту взаимосвязь с помощью выражения <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span>.</p>

<p>Скопируйте и реорганизуйте программу с  <a href="#%28counter._%28figure._fig~3asexp-function%29%29" data-pltdoc="x">рисунка&nbsp;<span class="FigureRef">117</span></a> 
в единую функцию, используя <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span>. Проверьте исправленный код с помощью 
<a name="(idx._(gentag._507))"></a>набора тестов для  <span class="RktSym">count</span>.</p>

<p>Второй аргумент локальных функций <span class="RktSym">sy</span> никогда не изменяется. 
Он всегда совпадает с исходным символом. Следовательно, вы можете исключить его из 
определений локальных функций, чтобы сообщить читателю, что <span class="RktSym">sy</span>
является константой во всем процессе обхода.  
<a href="#%28counter._%28exercise._ex~3acount-local%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3adepth))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;318. Разработайте <span class="RktSym">depth</span>. Функция использует S-выражение 
и определяет его глубину. <a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a> имеет глубину <span class="RktVal">1</span>. 
Глубина списка S-выражений равна максимальной глубине его элементов плюс 
<span class="RktVal">1</span>. 
<a href="#%28counter._%28exercise._ex~3adepth%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3asubstitute))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;319. Разработайте <span class="RktSym">substitute</span>. Он использует 
S-выражение <span class="RktSym">s</span> и два символа, <span class="RktSym">old</span> и 
<span class="RktSym">new</span>. Результат похож на <span class="RktSym">s</span>, где все
вхождения <span class="RktSym">old</span> заменены  <span class="RktSym">new</span>. 
<a href="#%28counter._%28exercise._ex~3asubstitute%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3asexpr-abstract1))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;320. Практикуйте шаг от определения данных к разработке функции
с двумя изменениями в определении <a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a>.</p>

<p>Для первого шага переформулируйте определение данных для <a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a> так, 
чтобы первое предложение первого определения данных было расширено до трех предложений 
<a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a>, а второе определение данных использовало абстракцию 
<a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a>. Измените функцию <span class="RktSym">count</span> 
для этого определения данных.</p>

<p>На втором этапе интегрируйте определение данных <a href="#%28tech._sl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SL</span></a> в определение данных для 
<a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a>. Еще раз упростите <span class="RktSym">count</span>. 
<span style="font-weight: bold">Подсказка</span> Используйте 
<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span>. 
<a href="#%28counter._%28exercise._ex~3asexpr-abstract1%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3asexpr-abstract2))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;321. Абстрагируйте определения данных для <a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a> и <a href="#%28tech._sl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SL</span></a>, чтобы они абстрагировались от типов атомов
(<a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a>), которые могут появиться. 
<a href="#%28counter._%28exercise._ex~3asexpr-abstract2%29%29" class="ex-end" data-pltdoc="x"></a></p>

<h4>19.4<tt>&nbsp;</tt><a name="(part._sec~3adesign-.N)"></a>Проектирование с использованием взаимосвязанных данных</h4>

<p></p>

<div class="SIntrapara">Переход от <a name="(idx._(gentag._508))"></a>определений данных, ссылающихся на себя, к <a name="(idx._(gentag._509))"></a>коллекциям определений данных 
с взаимными ссылками намного меньше, чем переход от определений данных для конечных данных 
к определениям данных ссылающихся сами на себя. В самом деле, рецепт проектирования для 
определений данных ссылающихся на себя - см. Раздел <a href="part_two.html#%28part._ch~3adesign-lists%29" data-pltdoc="x">Проектирование с определениями данных ссылающихся сами на себя</a> 
- требует лишь незначительных корректировок, чтобы применить его к этой, казалось бы, 
сложной ситуации: 
</div><div class="SIntrapara"><ol><li>

<p>Потребность во “nests”(вложенных) взаимосвязанных определений данных аналогична 
потребности в определениях данных ссылающихся сами на себя. Постановка проблемы касается 
многих различных видов информации, и одна форма информации относится к другим видам.</p>

<p>Прежде чем действовать в таких ситуациях, нарисуйте стрелки, чтобы связать 
ссылки с определениями. Рассмотрим левую часть  <a href="#%28counter._%28figure._fig~3adef-data-mutual-arrows%29%29" data-pltdoc="x">рисунка&nbsp;<span class="FigureRef">118</span></a>. 
Он отображает определение для <a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a>, которое содержит ссылки на 
<a href="#%28tech._sl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SL</span></a> и <a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a>, которые связаны с их соответствующими определениями с 
помощью стрелок. Точно так же определение <a href="#%28tech._sl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SL</span></a> содержит одну ссылку на себя и одну обратную
ссылку на <a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a>; опять же, оба соединены соответствующими стрелками. </p>

<p>Как и определения данных ссылающихся на себя, эти вложеные определения также 
требуют проверки. Как минимум, вы должны быть в состоянии построить несколько 
примеров для каждого отдельного определения. Начните с предложений, которые 
не ссылаются ни на одно из других определений данных во вложении. Имейте в виду, 
что определение может быть неверным, если из них невозможно сгенерировать примеры.</p>

</li><li>

<p>Ключевое изменение заключается в том, что вы должны проектировать столько функций, 
сколько существует определений данных. Каждая функция специализируется на одном из 
определений данных; все остальные аргументы остаются прежними. Исходя из этого, вы начинаете с подписи, предназначении и фиктивного определения <span style="font-weight: bold">для каждой функции.</span>.</p>

</li><li>

<p>Обязательно проработайте функциональные примеры, в которых используются все взаимные 
ссылки во вложенных определениях данных. </p>

</li><li>

<p>Для каждой функции создайте шаблон в соответствии с определением его 
первичных данных. Используйте <a href="part_two.html#%28counter._%28figure._fig~3atemplate-q%29%29" data-pltdoc="x">рисунок&nbsp;<span class="FigureRef">52</span></a>, чтобы провести 
создание шаблона до последнего шага. В обновленном последнем шаге требуется проверка 
всех ссылок на себя и перекрестных ссылок. Используйте определения данных, помеченные 
стрелками, чтобы направлять этот шаг. Для каждой стрелки в определениях данных добавьте 
стрелку в шаблоны. См. Правую часть  <a href="#%28counter._%28figure._fig~3adef-data-mutual-arrows%29%29" data-pltdoc="x">рисунка&nbsp;<span class="FigureRef">118</span></a> 
для версии шаблонов, помеченных стрелками. </p>

<blockquote class="Herefigure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0"><tbody><tr><td valign="top">

<p><img style="vertical-align: -0.0px; margin: -3px -3px -3px -3px;" src="part_four_files/pict_141.png" alt="image" width="156.888671875" height="304.328125"></p>

</td><td valign="top">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td valign="top">

<p><img style="vertical-align: -0.0px; margin: -3px -3px -3px -3px;" src="part_four_files/pict_142.png" alt="image" width="235.99609375" height="304.328125"></p>

</td></tr></tbody></table></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3adef-data-mutual-arrows))" x-target-lift="Figure"></a>Рисунок&nbsp;118: </span>Стрелки для вложенных определений данных и шаблонов </span></p>

</blockquote>

<p>Теперь замените стрелки фактическими вызовами функций. По мере накопления опыта вы,
естественно, пропустите этап рисования стрелки и напрямую будете использовать 
вызовы функций.</p>

<p><span style="font-weight: bold">Примечания</span> Обратите внимание на то, что 
оба вложения - одно для определений данных и одно для шаблонов функций - содержат 
четыре стрелки, и обратите внимание, как пары стрелок соответствуют друг другу. 
Исследователи называют это соответствие  <span style="font-style: italic">симметрией</span>. 
Это свидетельство того, что рецепт разработки обеспечивает естественный путь от 
проблем к решениям. </p>

</li><li>

<p>Для проектирования тела мы начинаем с тех строк <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span>, которые 
не содержат естественных рекурсий или вызовов других функций. Они называются 
<span style="font-style: italic">base cases(базовыми случаями)</span>. Соответствующие ответы
обычно легко сформулировать или уже даны в примерах. После этого вы имеете дело со случаями
ссылок на себя и случаями межфункциональных вызовов. Пусть вам подскажут вопросы и ответы на 
<a href="part_two.html#%28counter._%28figure._fig~3adefinition-q%29%29" data-pltdoc="x">рис.&nbsp;<span class="FigureRef">53</span></a>.</p>

</li><li>

<p>Запустите тесты, когда все определения будут завершены. Если вспомогательная 
функция не работает, вы можете получить два отчета об ошибках, один для основной функции, 
а другой - для ошибочного вспомогательного определения. 
<span style="font-weight: bold">Одно</span> исправление должно устранить обе. Убедитесь, 
что выполнение тестов охватывает все части функции.</p>

</li></ol></div><div class="SIntrapara">Наконец, если вы застряли на шаге 5, 
вспомните табличный подход к угадыванию функции комбинирования. В случае взаимосвязанных 
данных вам может потребоваться не только таблица для каждого случая, но также таблица 
для каждого случая и для каждой функции, чтобы выработать комбинацию. </div>

<p></p>

<h4>19.5<tt>&nbsp;</tt><a name="(part._sec~3aproj-bst)"></a>Проект: BSTs(Бинарное дерево поиска)</h4>

<p>Программисты часто работают с древовидными представлениями данных для 
повышения производительности своих функций. Особенно хорошо известной формой дерева 
является <span style="font-weight: bold">binary search tree</span>(двоичное дерево поиска),
потому что это хороший способ быстро сохранить и извлечь информацию.</p>

<p></p>

<div class="SIntrapara">Чтобы быть конкретным, давайте обсудим двоичные деревья, которые 
управляют информацией о людях. Вместо <span class="RktSym">child</span><span class="RktMeta"></span> структур в генеалогических деревьях двоичное дерево содержит 
<span class="RktSym">node</span><span class="RktMeta"></span>(узлы):
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">no-info</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">NONE</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-no-info</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">node</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">ssn</span><span class="hspace">&nbsp;</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._left%29%29" class="RktStxLink" data-pltdoc="x">left</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._right%29%29" class="RktStxLink" data-pltdoc="x">right</a></span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._bt)"></a><span style="font-style: italic">BT</span><span class="RktCmt"> (short for </span><a name="(tech._binarytree)"></a><span style="font-style: italic">BinaryTree</span><span class="RktCmt">) is one of:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktSym">NONE</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym">make-node</span><span class="stt"> </span><a href="part_one.html#%28tech._number%29" class="techoutside" data-pltdoc="x"><span class="techinside">Number</span></a><span class="stt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="stt"> </span><a href="#%28tech._bt%29" class="techoutside" data-pltdoc="x"><span class="techinside">BT</span></a><span class="stt"> </span><a href="#%28tech._bt%29" class="techoutside" data-pltdoc="x"><span class="techinside">BT</span></a><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Соответствующее определение данных похоже на определение для генеалогических деревьев, 
где <span class="RktSym">NONE</span><span class="RktMeta"></span> указывает на отсутствие
информации, и каждый узел записывает номер социального страхования, имя и два других двоичных
дерева. Последние подобны родителям в генеалогических деревьях, хотя отношения между 
узлом(<span class="RktSym">node</span><span class="RktMeta"></span>) и его левым
(<span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._left%29%29" class="RktStxLink" data-pltdoc="x">left</a></span><span class="RktMeta"></span>) и 
правым(<span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._right%29%29" class="RktStxLink" data-pltdoc="x">right</a></span><span class="RktMeta"></span>) 
деревьями не основаны на семейных отношениях.</div>

<p></p>

<p></p>

<div class="SIntrapara">Вот два бинарных дерева: 
</div><div class="SIntrapara"><blockquote><table cellspacing="0" cellpadding="0"><tbody><tr><td><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym">make-node</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">15</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">d</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">NONE</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-node</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">24</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">i</span><span class="hspace">&nbsp;</span><span class="RktSym">NONE</span><span class="hspace">&nbsp;</span><span class="RktSym">NONE</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym">make-node</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">15</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">d</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-node</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">87</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">h</span><span class="hspace">&nbsp;</span><span class="RktSym">NONE</span><span class="hspace">&nbsp;</span><span class="RktSym">NONE</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">NONE</span><span class="RktPn">)</span></td></tr></tbody></table></td></tr></tbody></table></blockquote></div>

<p></p>

<p>На  <a href="#%28counter._%28figure._fig~3abst%29%29" data-pltdoc="x">рис.&nbsp;<span class="FigureRef">119</span></a> показано, как мы должны относиться к таким деревьям 
как на рисовано. Деревья нарисованы вверх ногами, корень находится вверху, а крона - внизу. 
Каждый кружок соответствует узлу, помеченному полем <span class="RktSym">ssn</span><span class="RktMeta"></span> соответствующей структуры <span class="RktSym">node</span><span class="RktMeta"></span>(узла). На рисунках опущено <span class="RktSym">NONE</span><span class="RktMeta"></span>.</p>

<blockquote class="Herefigure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><blockquote class="SCentered"><table cellspacing="0" cellpadding="0"><tbody><tr><td>

<p>tree A</p>

</td><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td>

<p>tree B</p>

</td></tr><tr><td>

<p></p>

</td><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td>

<p></p>

</td></tr><tr><td>

<p><img style="vertical-align: 0px; margin: -3px -3px -3px -3px;" src="part_four_files/pict_143.png" alt="image" width="289.0" height="209.0"></p>

</td><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td>

<p><img style="vertical-align: 0px; margin: -3px -3px -3px -3px;" src="part_four_files/pict_144.png" alt="image" width="289.0" height="209.0"></p>

</td></tr></tbody></table></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3abst))" x-target-lift="Figure"></a>Рисунок&nbsp;119: </span>Бинарное дерево поиска и бинарное дерево</span></p>

</blockquote>

<p><a name="(counter._(exercise._ex~3abst1))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;322. Нарисуйте два вышеупомянутых дерева, как показано на  
<a href="#%28counter._%28figure._fig~3abst%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">119</span></a>. Затем разработайте <span class="RktSym">contains-bt?</span><span class="RktMeta"></span>, которая определяет, встречается ли данное число в некотором данном
  <span class="RktSym">BT</span>(бинарном дереве). 
<a href="#%28counter._%28exercise._ex~3abst1%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3abst1-search))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;323. Разработайте <span class="RktSym">search-bt</span><span class="RktMeta"></span>. Упражнение 323. Функция потребляет число 
<span class="RktSym">n</span><span class="RktMeta"></span> и 
<span class="RktSym">BT</span><span class="RktMeta"></span>. Если дерево содержит структуру 
<span class="RktSym">node</span><span class="RktMeta"></span>, поле 
<span class="RktSym">ssn</span><span class="RktMeta"></span> которой равно 
<span class="RktSym">n</span><span class="RktMeta"></span>, функция выдает значение поля 
<span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._name%29%29" class="RktStxLink" data-pltdoc="x">name</a></span><span class="RktMeta"></span> в этом узле. 
В противном случае функция выдаст  <span class="RktVal">#false</span><span class="RktMeta"></span>.</p>

<p><span style="font-weight: bold">Подсказка</span> Рассмотрите возможность использования 
<span class="RktSym">contains-bt?</span><span class="RktMeta"></span>, чтобы сначала 
проверить все дерево или <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span> для проверки результата естественной рекурсии на каждом этапе. 
<a href="#%28counter._%28exercise._ex~3abst1-search%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p></p>

<div class="SIntrapara">Если мы прочитаем числа на двух деревьях на  
<a href="#%28counter._%28figure._fig~3abst%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">119</span></a> слева направо, мы получим две разные последовательности: 
</div><div class="SIntrapara"><blockquote><table cellspacing="0" cellpadding="0"><tbody><tr><td align="left">

<p>tree A</p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center">

<p>10</p>

</td><td align="center">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center">

<p>15</p>

</td><td align="center">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center">

<p>24</p>

</td><td align="center">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center">

<p>29</p>

</td><td align="center">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center">

<p>63</p>

</td><td align="center">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center">

<p>77</p>

</td><td align="center">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center">

<p>89</p>

</td><td align="center">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center">

<p>95</p>

</td><td align="center">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center">

<p>99</p>

</td></tr><tr><td align="left">

<p>tree B</p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center">

<p>87</p>

</td><td align="center">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center">

<p>15</p>

</td><td align="center">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center">

<p>24</p>

</td><td align="center">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center">

<p>29</p>

</td><td align="center">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center">

<p>63</p>

</td><td align="center">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center">

<p>33</p>

</td><td align="center">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center">

<p>89</p>

</td><td align="center">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center">

<p>95</p>

</td><td align="center">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center">

<p>99</p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">Последовательность 
для дерева A отсортирована в порядке возрастания, а для B - нет. Бинарное дерево первого типа 
- это <span style="font-weight: bold">бинарное дерево поиска</span>. Каждое бинароное дерево 
поиска является бинарным деревом, но не каждое бинарное дерево является бинарным деревом поиска.
Более конкретно, мы формулируем условие - или инвариант данных - которое отличает 
бинарное дерево поиска от бинарного дерева:
</div>

<p></p>

<blockquote>

<p><span style="font-style: italic"> BST-инвариант</span></p>

</blockquote>

<p></p>

<div class="SIntrapara"><blockquote>

<p></p>

<div class="SIntrapara">  <a name="(tech._bst)"></a><span style="font-style: italic">BST</span>
(сокращение от <a name="(tech._binary._search._tree)"></a><span style="font-style: italic">binary search tree</span>(бинарное дерево поиска)) - это <a href="#%28tech._bt%29" class="techoutside" data-pltdoc="x"><span class="techinside">BT</span></a> согласно следующим условиям: 
</div><div class="SIntrapara"><ul><li>

<p><span class="RktSym">NONE</span> всегда является <a href="#%28tech._bst%29" class="techoutside" data-pltdoc="x"><span class="techinside">BST</span></a>.</p>

</li><li>

<p></p>

<div class="SIntrapara"><span class="RktPn">(</span><span class="RktSym">make-node</span><span class="stt"> </span><span class="RktSym">ssn0</span><span class="stt"> </span><span class="RktSym">name0</span><span class="stt"> </span><span class="RktSym">L</span><span class="stt"> </span><span class="RktSym">R</span><span class="RktPn">)</span> является
 <a href="#%28tech._bst%29" class="techoutside" data-pltdoc="x"><span class="techinside">BST</span></a>, если
</div><div class="SIntrapara"><ul><li>

<p><span class="RktSym">L</span> это <a href="#%28tech._bst%29" class="techoutside" data-pltdoc="x"><span class="techinside">BST</span></a>,</p>

</li><li>

<p><span class="RktSym">R</span> это <a href="#%28tech._bst%29" class="techoutside" data-pltdoc="x"><span class="techinside">BST</span></a>,</p>

</li><li>

<p>все поля <span class="RktSym">ssn</span> в <span class="RktSym">L</span> меньше 
<span class="RktSym">ssn0</span>,</p>

</li><li>

<p>все поля <span class="RktSym">ssn</span> в <span class="RktSym">R</span> больше, чем 
<span class="RktSym">ssn0</span>.</p>

</li></ul></div>

<p></p>

</li></ul></div>

<p></p>

</blockquote></div><div class="SIntrapara">Другими словами, чтобы проверить, 
принадлежит ли <a href="#%28tech._bt%29" class="techoutside" data-pltdoc="x"><span class="techinside">BT</span></a> также и <a href="#%28tech._bst%29" class="techoutside" data-pltdoc="x"><span class="techinside">BST</span></a>, мы должны проверить все числа 
во всех поддеревьях и убедиться, что они меньше или больше некоторого заданного числа. 
Это накладывает дополнительную нагрузку на построение данных, но, как показывают 
следующие упражнения, оно того стоит. </div>

<p></p>

<p><a name="(counter._(exercise._ex~3abst0))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;324. Разработайте функцию <span class="RktSym">inorder</span><span class="RktMeta"></span>. Она использует двоичное дерево и создает последовательность всех чисел(номеров)
<span class="RktSym">ssn</span><span class="RktMeta"></span> в дереве, отображаемых 
слева направо при просмотре рисунка дерева.</p>

<p></p>

<div class="SIntrapara"><span style="font-weight: bold">Подсказка</span> Используйте функцию
<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._append%29%29" class="RktValLink" data-pltdoc="x">append</a></span><span class="RktMeta"></span>, которая объединяет списки следующим образом:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._append%29%29" class="RktValLink" data-pltdoc="x">append</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktSym">==</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Что выдает <span class="RktSym">inorder</span><span class="RktMeta"></span> для бинарного 
дерева поиска?
<a href="#%28counter._%28exercise._ex~3abst0%29%29" class="ex-end" data-pltdoc="x"></a></div>

<p></p>

<p>Поиск узла(<span class="RktSym">node</span><span class="RktMeta"></span>) с заданным 
<span class="RktSym">ssn</span> в <span class="RktSym">BST</span><span class="RktMeta"></span>
может использовать инвариант <a href="#%28tech._bst%29" class="techoutside" data-pltdoc="x"><span class="techinside">BST</span></a>. Чтобы узнать, содержит ли 
<span class="RktSym">BT</span><span class="RktMeta"></span> узел с определенным 
<span class="RktSym">ssn</span><span class="RktMeta"></span>, функции может потребоваться
просмотреть каждый узел( <span class="RktSym">node</span><span class="RktMeta"></span>) дерева.
Напротив, чтобы выяснить, содержит ли двоичное дерево 
<span style="font-weight: bold">поиска</span> один и тот же <span class="RktSym">ssn</span>,
функция может исключить одно из двух поддеревьев для каждого проверяемого узла.</p>

<p></p>

<div class="SIntrapara">Проиллюстрируем идею на этом примере  <span class="RktSym">BST</span><span class="RktMeta"></span>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym">make-node</span><span class="hspace">&nbsp;</span><span class="RktVal">66</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktSym">R</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">Если мы ищем <span class="RktVal">66</span><span class="RktMeta"></span>, значит, мы нашли искомый узел. Теперь, если мы ищем меньшее число, 
скажем <span class="RktVal">63</span><span class="RktMeta"></span>, мы можем сфокусировать 
поиск на <span class="RktSym">L</span><span class="RktMeta"></span>, потому что 
<span style="font-weight: bold">все</span> узлы(<span class="RktSym">node</span><span class="RktMeta"></span>) с полями <span class="RktSym">ssn</span><span class="RktMeta"></span>
меньше <span class="RktVal">66</span><span class="RktMeta"></span> находятся в 
<span class="RktSym">L</span><span class="RktMeta"></span>. Точно так же, если бы мы искали 
<span class="RktVal">99</span><span class="RktMeta"></span>, мы бы проигнорировали 
<span class="RktSym">L</span><span class="RktMeta"></span> и сфокусировались бы. на 
<span class="RktSym">R</span><span class="RktMeta"></span>, потому что 
<span style="font-weight: bold">все</span> узлы(<span class="RktSym">node</span><span class="RktMeta"></span>) с <span class="RktSym">ssn</span><span class="RktMeta"></span>s 
больше <span class="RktVal">66</span><span class="RktMeta"></span> находятся в 
<span class="RktSym">R</span><span class="RktMeta"></span>.
</div>

<p></p>

<p><a name="(counter._(exercise._ex~3abst2))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;325. Спроектируйте <span class="RktSym">search-bst</span><span class="RktMeta"></span>.
Функция потребляет число <span class="RktSym">n</span><span class="RktMeta"></span> и 
<span class="RktSym">BST</span><span class="RktMeta"></span>. Если дерево содержит узел
(<span class="RktSym">node</span><span class="RktMeta"></span>), поле 
<span class="RktSym">ssn</span><span class="RktMeta"></span> которого равно 
<span class="RktSym">n</span><span class="RktMeta"></span>, функция выдает значение поля 
<span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._name%29%29" class="RktStxLink" data-pltdoc="x">name</a></span><span class="RktMeta"></span> в этом узле. 
В противном случае функция выдаст <span class="RktSym">NONE</span><span class="RktMeta"></span>.
Организация функции должна использовать инвариант BST, чтобы функция выполняла как можно 
меньше сравнений.
</p>

<p>См.  <a href="part_two.html#%28counter._%28exercise._ex~3asort2%29%29" data-pltdoc="x">Упражнение&nbsp;189</a> для поиска в отсортированных списках. Сравните! 
 <a href="#%28counter._%28exercise._ex~3abst2%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p>Строить двоичное дерево легко; построение двоичного дерева поиска сложно. 
Для любых двух <a href="#%28tech._bt%29" class="techoutside" data-pltdoc="x"><span class="techinside">BT</span></a>, числа и имени мы просто применяем 
<span class="RktSym">make-node</span> к этим значениям в правильном порядке, и вуаля, 
мы получаем новое <a href="#%28tech._bt%29" class="techoutside" data-pltdoc="x"><span class="techinside">BT</span></a>. Эта же процедура не работает для <span class="RktSym">BST</span><span class="RktMeta"></span>, потому что результат обычно не будет 
<span class="RktSym">BST</span><span class="RktMeta"></span>. Например, если одно
<span class="RktSym">BST</span><span class="RktMeta"></span> содержит узлы с полями 
<span class="RktSym">ssn</span> <span class="RktVal">3</span><span class="RktMeta"></span> и 
<span class="RktVal">5</span><span class="RktMeta"></span> в правильном порядке, а другое 
содержит поля <span class="RktSym">ssn</span> <span class="RktVal">2</span><span class="RktMeta"></span> и <span class="RktVal">6</span><span class="RktMeta"></span>, простое объединение 
двух деревьев с другим номером социального страхования(ssn) и именем не дает 
<a href="#%28tech._bst%29" class="techoutside" data-pltdoc="x"><span class="techinside">BST</span></a>.</p>

<p>Остальные два упражнения объясняют, как построить <a href="#%28tech._bst%29" class="techoutside" data-pltdoc="x"><span class="techinside">BST</span></a> из списка чисел и имен. В частности, 
первое упражнение вызывает функцию, которая вставляет заданные <span class="RktSym">ssn0</span> 
и <span class="RktSym">name0</span> в <a href="#%28tech._bst%29" class="techoutside" data-pltdoc="x"><span class="techinside">BST</span></a>; то есть он создает <a href="#%28tech._bst%29" class="techoutside" data-pltdoc="x"><span class="techinside">BST</span></a>, подобный тому, 
который ему дан, с добавлением еще одного узла, содержащего поддеревья 
<span class="RktSym">ssn0</span>, <span class="RktSym">name0</span> и
 <span class="RktSym">NONE</span>. Затем во втором упражнении запрашивается функция, 
которая может работать с полным списком чисел и имен. </p>

<p></p>

<div class="SIntrapara"><a name="(counter._(exercise._ex~3abst3))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;326. Разработайте функцию <span class="RktSym">create-bst</span><span class="RktMeta"></span>. Она потребляет <span class="RktSym">BST</span><span class="RktMeta"></span> <span class="RktSym">B</span><span class="RktMeta"></span>, число 
<span class="RktSym">N</span><span class="RktMeta"></span> и символ 
<span class="RktSym">S</span><span class="RktMeta"></span>. Она создает <span class="RktSym">BST</span><span class="RktMeta"></span>, которое точно такое же, как <span class="RktSym">B</span><span class="RktMeta"></span>, и которое вместо одного поддерева <span class="RktSym">NONE</span><span class="RktMeta"></span> содержит структуру <span class="RktSym">node</span><span class="RktMeta"></span>(узла).
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym">make-node</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">S</span><span class="hspace">&nbsp;</span><span class="RktSym">NONE</span><span class="hspace">&nbsp;</span><span class="RktSym">NONE</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">После завершения проектирования используйте функцию
дерева A на <a href="#%28counter._%28figure._fig~3abst%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">119</span></a>. 
<a href="#%28counter._%28exercise._ex~3abst3%29%29" class="ex-end" data-pltdoc="x"></a></div>

<p></p>

<p></p>

<div class="SIntrapara"><a name="(counter._(exercise._ex~3abst4))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;327. Создайте функцию  <span class="RktSym">create-bst-from-list</span><span class="RktMeta"></span>. Она использует список чисел и имен и создает 
<a href="#%28tech._bst%29" class="techoutside" data-pltdoc="x"><span class="techinside">BST</span></a>, многократно применяя <span class="RktSym">create-bst</span>. Вот сигнатура: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> [</span><a href="part_three.html#%28tech._sim-dd._list%29" class="techoutside" data-pltdoc="x"><span class="techinside">List</span></a><span class="RktCmt"> Number Symbol]] -&gt; </span><a href="#%28tech._bst%29" class="techoutside" data-pltdoc="x"><span class="techinside">BST</span></a></p>

</blockquote></div><div class="SIntrapara">Используйте полную функцию, чтобы создать 
<a href="#%28tech._bst%29" class="techoutside" data-pltdoc="x"><span class="techinside">BST</span></a> из этого примера ввода: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">99</span><span class="hspace">&nbsp;</span><span class="RktVal">o</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">77</span><span class="hspace">&nbsp;</span><span class="RktVal">l</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">24</span><span class="hspace">&nbsp;</span><span class="RktVal">i</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktVal">h</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">95</span><span class="hspace">&nbsp;</span><span class="RktVal">g</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">15</span><span class="hspace">&nbsp;</span><span class="RktVal">d</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">89</span><span class="hspace">&nbsp;</span><span class="RktVal">c</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">29</span><span class="hspace">&nbsp;</span><span class="RktVal">b</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">63</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">Результатом является дерево A на 
 <a href="#%28counter._%28figure._fig~3abst%29%29" data-pltdoc="x">рис.&nbsp;<span class="FigureRef">119</span></a>, если вы следуете рецепту структурного проектирования. 
Если вы используете существующую абстракцию, вы все равно можете получить это дерево, 
но вы также можете получить «инвертированное» дерево. Почему? 
 <a href="#%28counter._%28exercise._ex~3abst4%29%29" class="ex-end" data-pltdoc="x"></a></div>

<p></p>

<h4>19.6<tt>&nbsp;</tt><a name="(part._sec~3asimplification)"></a>Упрощение функций</h4>

<p>В <a href="#%28counter._%28exercise._ex~3acount-local%29%29" data-pltdoc="x">упражнении&nbsp;317</a> показано, как использовать <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span> для 
организации функции, которая имеет дело с взаимосвязанной формой данных. Эта организация 
также помогает упростить функции, если мы знаем, что определение данных является окончательным.
Чтобы продемонстрировать этот момент, мы объясним, как упростить решение 
<a href="#%28counter._%28exercise._ex~3asubstitute%29%29" data-pltdoc="x">упражнения&nbsp;319</a>.</p>

<p></p>

<div class="SIntrapara"><a name="(idx._(gentag._511))"></a>
</div><div class="SIntrapara"><blockquote class="Figure"><a name="(counter._(figure._fig~3asimplifying1))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a><span class="RktCmt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="RktCmt"> </span><a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">replaces all occurrences of </span><span class="RktSym">old</span><span class="RktCmt"> in </span><span class="RktSym">sexp</span><span class="RktCmt"> with </span><span class="RktSym">new</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">substitute</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">world</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">bye</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">bye</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">bye</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">42</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">world</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">substitute</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">old</span><span class="hspace">&nbsp;</span><span class="RktSym">new</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">atom?</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-atom</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-sl</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._sl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SL</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-sl</span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-sexp</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-sl</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-atom</span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._number~3f%29%29" class="RktValLink" data-pltdoc="x">number?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29" class="RktValLink" data-pltdoc="x">symbol?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="hspace">&nbsp;</span><span class="RktSym">old</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">new</span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;120: </span>Программа, которую нужно упростить </span></p>

</blockquote></div>

<p></p>

<p>На  <a href="#%28counter._%28figure._fig~3asimplifying1%29%29" data-pltdoc="x">рис.&nbsp;<span class="FigureRef">120</span></a> показано полное определение функции 
<span class="RktSym">substitute</span>. В определении используются <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span> 
и три вспомогательные функции, как указано в определении данных. На рисунке представлен 
тестовый пример, чтобы вы могли повторно протестировать функцию после каждого изменения,
предложенного ниже. Стоп! Разработайте дополнительные тестовые случаи; одного почти 
никогда не достаточно.</p>

<p><a name="(counter._(exercise._ex~3asimplify1))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;328. Скопируйте и вставьте <a href="#%28counter._%28figure._fig~3asimplifying1%29%29" data-pltdoc="x">рисунок&nbsp;<span class="FigureRef">120</span></a> в DrRacket; включите свой 
набор тестов. Подтвердите набор тестов. Читая оставшуюся часть этого раздела, внесите изменения 
и повторно запустите наборы тестов, чтобы подтвердить обоснованность наших аргументов.  
<a href="#%28counter._%28exercise._ex~3asimplify1%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p></p>

<div class="SIntrapara"><a name="(idx._(gentag._512))"></a>
</div><div class="SIntrapara"><blockquote class="Figure"><a name="(counter._(figure._fig~3asimplifying2))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">substitute</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">old</span><span class="hspace">&nbsp;</span><span class="RktSym">new</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">atom?</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-atom</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-sl</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._sl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SL</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-sl</span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktSym">for-sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-atom</span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._number~3f%29%29" class="RktValLink" data-pltdoc="x">number?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29" class="RktValLink" data-pltdoc="x">symbol?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="hspace">&nbsp;</span><span class="RktSym">old</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">new</span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;121: </span>Упрощение программы, шаг 1</span></p>

</blockquote></div>

<p></p>

<p>Поскольку мы знаем, что <a href="#%28tech._sl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SL</span></a> описывает списки <a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a>, мы можем использовать 
<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span> для упрощения 
<span class="RktSym">for-sl</span>. См.  <a href="#%28counter._%28figure._fig~3asimplifying2%29%29" data-pltdoc="x">Рисунок&nbsp;<span class="FigureRef">121</span></a> для получения результата. 
В то время как исходная программа говорит, что <span class="RktSym">for-sexp</span> 
применяется к каждому элементу на <span class="RktSym">sl</span>, ее пересмотренное 
определение более лаконично выражает ту же идею с помощью 
 <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span>.</p>

<p>Для второго шага упрощения нам нужно напомнить вам, что <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span> сравнивает два произвольных значения. С учетом этого третья 
функция из <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span> становится однострочной. На  
<a href="#%28counter._%28figure._fig~3asimplifying3%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">122</span></a> показано это второе упрощение. </p>

<p></p>

<div class="SIntrapara"><a name="(idx._(gentag._513))"></a>
<a name="(idx._(gentag._514))"></a>
</div><div class="SIntrapara"><blockquote class="Figure"><a name="(counter._(figure._fig~3asimplifying3))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">substitute</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">old</span><span class="hspace">&nbsp;</span><span class="RktSym">new</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">atom?</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-atom</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-sl</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._sl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SL</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-sl</span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktSym">for-sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sl</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-atom</span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="hspace">&nbsp;</span><span class="RktSym">old</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">new</span><span class="hspace">&nbsp;</span><span class="RktSym">at</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">substitute.v3</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">old</span><span class="hspace">&nbsp;</span><span class="RktSym">new</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">atom?</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">old</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">new</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktSym">for-sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">for-sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;122: </span>Упрощение программы, шаги 2 и 3</span></p>

</blockquote></div>

<p></p>

<p>На этом этапе два последних определения в <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span> состоят 
из одной строки. Более того, ни одно определение не является рекурсивным. 
Следовательно, мы можем <span style="font-style: italic">in-line</span>(встроить) функции в 
<span class="RktSym">for-sexp</span>. Встраивание означает замену 
<span class="RktPn">(</span><span class="RktSym">for-atom</span><span class="stt"> </span><span class="RktSym">sexp</span><span class="RktPn">)</span> на 
<span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span><span class="stt"> </span><span class="RktSym">sexp</span><span class="stt"> </span><span class="RktSym">old</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">new</span><span class="stt"> </span><span class="RktSym">sexp</span><span class="RktPn">)</span>, то есть мы заменяем
<span class="refelem"><span class="refcolumn"><span class="refcontent">
Хотя <span class="RktSym">sexp</span> также является параметром, эта замена действительно
приемлема, потому что она также заменяет фактическое значение.</span></span></span>
параметр <span class="RktSym">at</span> фактическим аргументом <span class="RktSym">sexp</span>.
Точно так же для <span class="RktPn">(</span><span class="RktSym">for-sl</span><span class="stt"> </span><span class="RktSym">sexp</span><span class="RktPn">)</span> мы вставляем 
 <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="stt"> </span><span class="RktSym">for-sexp</span><span class="stt"> </span><span class="RktSym">sexp</span><span class="RktPn">)</span>; см. нижнюю половину 
<a href="#%28counter._%28figure._fig~3asimplifying2%29%29" data-pltdoc="x">рисунка&nbsp;<span class="FigureRef">121</span></a>. Все, что у нас осталось, это функция, определение которой 
вводит одну локальную(<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span>) функцию, которая вызывается с тем же 
основным аргументом. Если бы мы систематически предоставляли два других аргумента, мы бы 
сразу увидели, что локально определенная функция может использоваться вместо внешней.</p>

<p></p>

<div class="SIntrapara">Вот результат воплощения этой последней мысли в код: 
  <a name="(idx._(gentag._515))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">substitute</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">old</span><span class="hspace">&nbsp;</span><span class="RktSym">new</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">atom?</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="hspace">&nbsp;</span><span class="RktSym">old</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">new</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">substitute</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym">old</span><span class="hspace">&nbsp;</span><span class="RktSym">new</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">sexp</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Стоп! Объясните, почему нам пришлось использовать <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span> 
для этого последнего упрощения. </div>

<p></p>

<h3>20<tt>&nbsp;</tt><a name="(part._ch~3afiles)"></a>Итеративное уточнение</h3>

<p>При разработке реальных программ вы можете столкнуться со сложными формами информации 
и проблемой их представления в виде данных. Лучшая стратегия для решения этой задачи - 
использовать <a name="(idx._(gentag._516))"></a><span style="font-style: italic">итеративное уточнение</span>, хорошо известный научный процесс. Задача ученого состоит в том, 
чтобы представить часть реального мира, используя какую-либо форму математики. 
Результат усилий называется моделью. Затем ученый тестирует модель разными способами, 
в частности, предсказывая результаты экспериментов. Если расхождения между прогнозами и 
измерениями слишком велики, модель уточняется с целью улучшения прогнозов. Этот итеративный 
процесс продолжается до тех пор, пока прогнозы не станут достаточно точными. </p>

<p>Рассмотрим физика, который хочет предсказать траекторию полета ракеты. 
Хотя представление «ракета как точка» является простым, оно также довольно неточно,
например, не учитывает трение в воздухе. В ответ физик может добавить грубый контур 
ракеты и ввести необходимую математику для представления трения. Эта вторая модель 
является <span style="font-style: italic">уточнением(refinement)</span> первой модели. 
В общем, ученый повторяет - или, как говорят программисты, 
 <span style="font-style: italic">итерирует(iterates)</span> - этот процесс до тех пор, 
пока модель не будет предсказывать траекторию полета ракеты с достаточной точностью. </p>

<p>Программист, получивший образование на факультете информатики, должен поступать 
так же, как этот физик. Ключ в том, чтобы найти точное представление данных о 
реальной информации и функциях, которые обрабатывают ее должным образом. 
Сложные ситуации требуют процесса уточнения, чтобы получить удовлетворяющее 
представление данных в сочетании с надлежащими функциями. Процесс начинается с 
основных частей информации и при необходимости добавляет другие. Иногда программист 
должен уточнить модель <span style="font-weight: bold">после</span> развертывания 
программы, потому что пользователи запрашивают дополнительные функции. </p>

<p>До сих пор мы использовали для вас итеративное уточнение, когда дело касалось сложных 
форм данных. Эта глава иллюстрирует итеративное уточнение как принцип разработки программы 
на расширенном примере, представляющем и обрабатывающем (части) файловой системы компьютера. 
Мы начинаем с краткого обсуждения файловой системы, а затем последовательно разрабатываем 
три представления данных. Попутно мы предлагаем несколько упражнений по программированию, 
чтобы вы увидели, как рецепт разработки также помогает изменять существующие программы. </p>

<h4>20.1<tt>&nbsp;</tt><a name="(part._sec~3afiles-what)"></a>Анализ данных
</h4>

<p>Прежде чем выключить DrRacket, убедитесь, что вся ваша работа где-то надежно спрятана. 
В противном случае вам придется вводить все заново, 
<span class="refelem"><span class="refcolumn"><span class="refcontent">Файл на самом деле
представляет собой последовательность <span style="font-style: italic">bytes</span>(байтов), 
один за другим. Попробуйте определить класс файлов.
</span></span></span>
когда вы запустите DrRacket в следующий раз. Итак, вы просите свой компьютер сохранять 
программы и данные в файлы(<span style="font-style: italic">files</span>). Файл - это 
грубо говоря строка(string). </p>

<blockquote class="Figure"><a name="(counter._(figure._fig~3aaccountant))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside">

<p><img style="vertical-align: -0.0px; margin: -3px -3px -3px -3px;" src="part_four_files/pict_145.png" alt="image" width="376.759765625" height="308.6875"></p>

</blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;123: </span>Пример дерева директорий</span></p>

</blockquote>

<p>В большинстве компьютерных систем файлы организованы в 
<span style="font-style: italic">директории</span>(каталоги) или 
<span style="font-style: italic">папки</span>. Грубо говоря, каталог содержит несколько 
файлов и еще несколько каталогов. Последние называются подкаталогами и могут содержать 
еще больше подкаталогов и файлов. Из-за иерархии мы говорим о  
<span style="font-style: italic">деревьях каталогов(директорий)</span>.</p>

<p> <a href="#%28counter._%28figure._fig~3aaccountant%29%29" data-pltdoc="x">Рисунок&nbsp;<span class="FigureRef">123</span></a> содержит графический эскиз небольшого дерева каталогов, 
и рисунок объясняет, почему компьютерные ученые называют их деревьями. Вопреки общепринятым
правилам информатики, на рисунке показано дерево, растущее вверх, с корневым каталогом с 
именем <span class="stt">TS</span>. Корневой каталог содержит один файл с именем 
<span class="stt">read!</span>, и два подкаталога с именами <span class="stt">Text</span> и
<span class="stt">Libs</span> соответственно. Первый подкаталог, <span class="stt">Text</span>,
содержит только три файла; последний, <span class="stt">Libs</span>, содержит только два
подкаталога, каждый из которых содержит хотя бы один файл. Наконец, каждый
прямоугольник имеет одну из двух аннотаций: каталог помечен 
<span class="stt">DIR</span>, а файл помечен числом, его размером.</p>

<p><a name="(counter._(exercise._ex~3adir0))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;329.  Сколько раз читается имя <span class="stt">read!</span> в дереве каталогов 
<span class="stt">TS</span>? Можете ли вы описать путь от корневого каталога до экземпляров? 
Каков общий размер всех файлов в дереве? Каков общий размер каталога, если размер каждого 
узла каталога равен <span class="RktVal">1</span>? Сколько уровней каталогов в нем? 
<a href="#%28counter._%28exercise._ex~3adir0%29%29" class="ex-end" data-pltdoc="x"></a></p>

<h4>20.2<tt>&nbsp;</tt><a name="(part._sec~3afiles-models)"></a>Уточнение определений данных</h4>

<p>В <a href="#%28counter._%28exercise._ex~3adir0%29%29" data-pltdoc="x">упражнении&nbsp;329</a>
перечислены некоторые вопросы, которые пользователи обычно задают о каталогах. Чтобы ответить 
на такие вопросы, операционная система компьютера предоставляет программы, которые могут 
на них ответить. Если вы хотите разработать такие программы, вам необходимо разработать
представление данных для деревьев каталогов.</p>

<p>В этом разделе мы используем итеративное уточнение для разработки трех таких 
представлений данных. Для каждого этапа нам нужно решить, какие атрибуты включать, 
а какие игнорировать. Рассмотрим дерево каталогов на 
<a href="#%28counter._%28figure._fig~3aaccountant%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">123</span></a> и представим, как оно создано. Когда пользователь 
впервые создает каталог, он пуст. Со временем пользователь добавляет файлы и каталоги. 
Обычно пользователь обращается к файлам по именам, но в основном считает каталоги 
контейнерами. </p>

<p></p>

<div class="SIntrapara"><span style="font-weight: bold">Модель 1</span> Наш мысленныйй 
эксперимент предполагает, что наша первая модель должна фокусироваться на файлах как
атомарных объектах с именем и каталогах как контейнерах. Вот определение данных, которое
рассматривает каталоги как списки и файлы как строки, то есть их имена:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._dir..v1)"></a><span style="font-style: italic">Dir.v1</span><span class="RktCmt"> (short for </span><span style="font-style: italic">directory</span><span class="RktCmt">) is one of: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="#%28tech._file..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">File.v1</span></a><span class="stt"> </span><a href="#%28tech._dir..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">Dir.v1</span></a><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="#%28tech._dir..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">Dir.v1</span></a><span class="stt"> </span><a href="#%28tech._dir..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">Dir.v1</span></a><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._file..v1)"></a><span style="font-style: italic">File.v1</span><span class="RktCmt"> is a </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt">. </span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
имена имеют суффикс <span style="font-style: italic">.v1</span>, чтобы отличать их от будущих
уточнений.</div>

<p></p>

<p><a name="(counter._(exercise._ex~3afile-example1))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;330. Преобразуйте дерево каталогов на 
<a href="#%28counter._%28figure._fig~3aaccountant%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">123</span></a> в представление данных в соответствии с моделью 1. 
<a href="#%28counter._%28exercise._ex~3afile-example1%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3adir-how-many1))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;331. Разработайте функцию <span class="RktSym">how-many</span>, 
которая определяет сколько файлов содержит данный каталог <a href="#%28tech._dir..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">Dir.v1</span></a>. 
Не забывайте следовать рецепту разработки; В <a href="#%28counter._%28exercise._ex~3afile-example1%29%29" data-pltdoc="x">упражнении&nbsp;330</a> представлены примеры данных. 
<a href="#%28counter._%28exercise._ex~3adir-how-many1%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p></p>

<div class="SIntrapara"><span style="font-weight: bold">Модель 2</span> Если вы решили
<a href="#%28counter._%28exercise._ex~3adir-how-many1%29%29" data-pltdoc="x">упражнение&nbsp;331</a>, то знаете, что это первое определение данных все еще не достаточно простое. Но оно
также скрывает природу каталогов. С этим первым представлением мы не сможем перечислить
все имена подкаталогов некоторого заданного каталога. Чтобы моделировать каталоги
более точным образом, чем контейнеры, мы должны ввести структурный тип, который соединяет
имя с контейнером:
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">dir</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="RktPn">]</span><span class="RktPn">)</span></p>

</blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Этот новый тип структуры, в свою очередь, предполагает следующую
редакцию определения данных:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._dir..v2)"></a><span style="font-style: italic">Dir.v2</span><span class="RktCmt"> is a structure: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-dir</span><span class="stt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="stt"> </span><a href="#%28tech._lofd%29" class="techoutside" data-pltdoc="x"><span class="techinside">LOFD</span></a><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._lofd)"></a><span style="font-style: italic">LOFD</span><span class="RktCmt"> (short for </span><span style="font-style: italic">list of files and directories</span><span class="RktCmt">) is one of:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="#%28tech._file..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">File.v2</span></a><span class="stt"> </span><span class="RktSym">LOFD</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="#%28tech._dir..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">Dir.v2</span></a><span class="stt"> </span><a href="#%28tech._lofd%29" class="techoutside" data-pltdoc="x"><span class="techinside">LOFD</span></a><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._file..v2)"></a><span style="font-style: italic">File.v2</span><span class="RktCmt"> is a </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt">. </span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Обратите внимание, как определение данных для <a href="#%28tech._dir..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">Dir.v2</span></a> относится к определению
 <a href="#%28tech._lofd%29" class="techoutside" data-pltdoc="x"><span class="techinside">LOFD</span></a>s, a определение для <a href="#%28tech._lofd%29" class="techoutside" data-pltdoc="x"><span class="techinside">LOFD</span></a>s относится к определению <a href="#%28tech._dir..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">Dir.v2</span></a>.
Эти два определения взаимно рекурсивны.</div>

<p></p>

<p><a name="(counter._(exercise._ex~3afile-example2))"></a><span style="font-weight: bold">Упражение</span>&nbsp;332. Преобразуйте дерево каталогов на
<a href="#%28counter._%28figure._fig~3aaccountant%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">123</span></a> в представление данных в соответсвии с моделью 2. 
<a href="#%28counter._%28exercise._ex~3afile-example2%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3adir-how-many2))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;333. Разработайте функцию <span class="RktSym">how-many</span>, 
которая определеяет сколько файлов содержит данный <a href="#%28tech._dir..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">Dir.v2</span></a>.
В <a href="#%28counter._%28exercise._ex~3afile-example2%29%29" data-pltdoc="x">упражнении&nbsp;332</a> преведены примеры данных. Сравните свой результат с результатом 
<a href="#%28counter._%28exercise._ex~3adir-how-many1%29%29" data-pltdoc="x">упражнения&nbsp;331</a>. 
<a href="#%28counter._%28exercise._ex~3adir-how-many2%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3aalt-dir1))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;334. Покажите, как снабдить каталог еще двумя атрибутами: размером и 
readability(доступностью чтения). Первый измеряет, сколько места занимает сам каталог(в отличии
от его содержимого); последний указывает, может ли кто-либо еще, кроме пользователя,
просматривать содержимое каталога. 
<a href="#%28counter._%28exercise._ex~3aalt-dir1%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p></p>

<div class="SIntrapara"><span style="font-weight: bold">Модель 3</span> Как и каталоги,
файлы имеют атрибуты. Чтобы представить их, мы действуем так же, как указано выше.
Сначала мы определяем структуру для файлов:
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">file</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">size</span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="RktPn">]</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">Затем, мы даем определение данных:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._file..v3)"></a><span style="font-style: italic">File.v3</span><span class="RktCmt"> is a structure: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-file</span><span class="stt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="stt"> </span><a href="part_two.html#%28tech._n%29" class="techoutside" data-pltdoc="x"><span class="techinside">N</span></a><span class="stt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Как указано в именах полей, строка представляет имя файла, натуральное число - его размер,
а еще одна строка - его содержимое.</div>

<p></p>

<p></p>

<div class="SIntrapara">Наконец, давайте разделим поле <span class="RktSym">content</span> 
в каталогах на две части: список файлов и список подкаталогов. Это изменение требует
пересмотра определения типа структуры:
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">dir.v3</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">dirs</span><span class="hspace">&nbsp;</span><span class="RktSym">files</span><span class="RktPn">]</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">Вот уточненное определение данных:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._dir..v3)"></a><span style="font-style: italic">Dir.v3</span><span class="RktCmt"> is a structure: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-dir.v3</span><span class="stt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="stt"> </span><a href="#%28tech._dir%2A%29" class="techoutside" data-pltdoc="x"><span class="techinside">Dir*</span></a><span class="stt"> </span><a href="#%28tech._file%2A%29" class="techoutside" data-pltdoc="x"><span class="techinside">File*</span></a><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._dir*)"></a><span style="font-style: italic">Dir*</span><span class="RktCmt"> is one of: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="#%28tech._dir..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Dir.v3</span></a><span class="stt"> </span><a href="#%28tech._dir%2A%29" class="techoutside" data-pltdoc="x"><span class="techinside">Dir*</span></a><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._file*)"></a><span style="font-style: italic">File*</span><span class="RktCmt"> is one of: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="#%28tech._file..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">File.v3</span></a><span class="stt"> </span><a href="#%28tech._file%2A%29" class="techoutside" data-pltdoc="x"><span class="techinside">File*</span></a><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Согласно соглашению в области компьютерных наук, использование <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span> в качестве окончания имени предполагает “многие/many” и является
маркером, позволяющим отличить имя от похожих имен: <a href="#%28tech._file..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">File.v3</span></a> и 
<a href="#%28tech._dir..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Dir.v3</span></a>.</div>

<p></p>

<p><a name="(counter._(exercise._ex~3afile-example3))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;335. Преобразуйте дерево каталогов на
<a href="#%28counter._%28figure._fig~3aaccountant%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">123</span></a> в представление данных в соответствии с моделью 3.  
Используйте <span class="RktVal">""</span> для содержимого файлов. 
<a href="#%28counter._%28exercise._ex~3afile-example3%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3adir-how-many3))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;336. Разработайте функцию <span class="RktSym">how-many</span>, 
которая определяет, сколько файлов содержит данный <a href="#%28tech._dir..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Dir.v3</span></a>.
В <a href="#%28counter._%28exercise._ex~3afile-example3%29%29" data-pltdoc="x">упражнении&nbsp;335</a> приведены примеры данных. Сравните свой результат с результатом 
<a href="#%28counter._%28exercise._ex~3adir-how-many2%29%29" data-pltdoc="x">упражнения&nbsp;333</a>.</p>

<p>Учитывая сложность определения данных, подумайте как каждый может разработать правильные
функции.  Почему вы уверены, что <span class="RktSym">how-many</span>
 выдает правильные результаты? <a href="#%28counter._%28exercise._ex~3adir-how-many3%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3adir-how-many-map))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;337. Используйте <a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a>
для упрощения определения данных <a href="#%28tech._dir..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Dir.v3</span></a>. Затем используйте функции обработки
списков ISL+ из <a href="part_three.html#%28counter._%28figure._fig~3aisl-ho-list%29%29" data-pltdoc="x">рисунков&nbsp;<span class="FigureRef">95</span></a> и 
<a href="part_three.html#%28counter._%28figure._fig~3aisl-ho-list2%29%29" data-pltdoc="x"><span class="FigureRef">96</span></a>, чтобы упростить определение(я) функции для решения 
<a href="#%28counter._%28exercise._ex~3adir-how-many3%29%29" data-pltdoc="x">упражнения&nbsp;336</a>. <a href="#%28counter._%28exercise._ex~3adir-how-many-map%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p>Начав с простого представления первой модели и шаг за шагом её уточняя, мы разработали
достаточно точное представление данных для деревьев каталогов. Действительно,
это третье представление данных отражает природу дерева каталогов гораздо точнее, чем
первые два. На основе этой модели мы можем создать ряд других функций, которые пользователи
ожидают от операционной системы компьютера.
</p>

<h4>20.3<tt>&nbsp;</tt><a name="(part._sec~3arefine-funcs)"></a>Уточнение Функций</h4>

<p></p>

<div class="SIntrapara">Чтобы сделать следующие упражнения более реалистичными, 
DrRacket поставляется с 
<span class="refelem"><span class="refcolumn"><span class="refcontent">
Добавьте <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><span class="RktSym">htdp/dir</span><span class="RktPn">)</span>
в область определений.</span></span></span> 
<span class="sroman"> библиотекой <span class="Smaller"><span style="font-style: italic">dir.rkt</span></span></span> из первого издания этой книги. В этом обучающем пакете представлены
два типа структуры из модели 3, но без суффикса <span style="font-style: italic">.v3</span>.
Кроме того, обучающий пакет предоставляет функцию, которая создаёт представления деревьев
каталогов на вашем компьютере:
<a name="(idx._(gentag._518))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._dir..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Dir.v3</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">creates a representation of the </span><span class="stt">a-path</span><span class="RktCmt"> directory </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">create-dir</span><span class="hspace">&nbsp;</span><span class="RktSym">a-path</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Например, если вы открываете DrRacket и вводите следующие три строки в область определений:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">create-dir</span><span class="hspace">&nbsp;</span><span class="RktVal">"/Users/..."</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">on OS X </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">create-dir</span><span class="hspace">&nbsp;</span><span class="RktVal">"/var/log/"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">on Linux</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">W</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">create-dir</span><span class="hspace">&nbsp;</span><span class="RktVal">"C:\\Users\\..."</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">on Windows </span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
вы получаете представления данных каталогов на вашем компьютере после 
<span style="font-weight: bold">save</span>(сохранения) и последующего запуска программы.
На самом деле, вы можете использовать <span class="RktSym">create-dir</span> для сопоставления
всей файловой системы на вашем компьютере с экземпляром <a href="#%28tech._dir..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Dir.v3</span></a>.</div>

<p></p>

<p><span style="font-weight: bold">Предупреждение</span> (1) Для больших деревьев каталогов,
DrRacket может потребоваться много времени для построения представления. 
Используйте <span class="RktSym">create-dir</span> для небольших деревьев каталогов. 
(2) <span style="font-weight: bold">Не</span> определяйте свой собственный структурный тип 
<span style="font-style: italic">dir</span>. Пакет обучения уже определяет его, и вы не должны
определять дважды этот структурный тип.</p>

<p>Хотя <span class="RktSym">create-dir</span> предоставляет только представление
дерева каталогов, он достаточно реалистичен, чтобы дать вам представление о том, как
разрабатывать программы на этом уровне. Следующие упражнения илюстрируют этот момент. Они
используют <span style="font-style: italic">Dir</span> для обозначения общей идеи
представления данных для деревьев каталогов. Используйте простейшее определение данных 
<span style="font-style: italic">Dir</span>, которое позволяет выполнить соответствующее
упражнение.  Не стесняйтесь использовать определение данных из
 <a href="#%28counter._%28exercise._ex~3adir-how-many-map%29%29" data-pltdoc="x">упражнения&nbsp;337</a> и функции из
 <a href="part_three.html#%28counter._%28figure._fig~3aisl-ho-list%29%29" data-pltdoc="x">рисунков&nbsp;<span class="FigureRef">95</span></a> и 
<a href="part_three.html#%28counter._%28figure._fig~3aisl-ho-list2%29%29" data-pltdoc="x"><span class="FigureRef">96</span></a>.</p>

<p><a name="(counter._(exercise._ex~3adir-how-many4))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;338. Используйте <span class="RktSym">create-dir</span> чтобы 
превратить некоторые из ваших каталогов в представление данных ISL+. Затем используйте
<span class="RktSym">how-many</span> из <a href="#%28counter._%28exercise._ex~3adir-how-many3%29%29" data-pltdoc="x">упражнения&nbsp;336</a>, чтобы подсчитать, сколько файлов они содержат. Почему
вы уверены, что <span class="RktSym">how-many</span> даст правильные результаты для этих
каталогов? 
<a href="#%28counter._%28exercise._ex~3adir-how-many4%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3afile-find))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;339. Разработайте <span class="RktSym">find?</span>. Функция использует
<span style="font-style: italic">Dir</span> и имя файла и определяет, встречается ли файл
с этим именем в дереве каталогов. 
<a href="#%28counter._%28exercise._ex~3afile-find%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3afile-ls))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;340. Разработайте функцию <span class="RktSym">ls</span>, которая перечисляет
имена всех файлов и всех каталогов в  заданном  <span style="font-style: italic">Dir</span>. 
<a href="#%28counter._%28exercise._ex~3afile-ls%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3afile-du))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;341. Разработайте <span class="RktSym">du</span>, - функцию, которая использует 
<span style="font-style: italic">Dir</span> и вычисляет общий размер всех файлов во всем 
дереве каталогов. Предположим, что хранение каталога в структуре <span style="font-style: italic">Dir</span> стоит <span class="RktVal">1</span> единицу хранения файлов. 
В реальном мире каталог - это, по сути, специальный файл, и его размер зависит 
от размера связанного с ним каталога.
<a href="#%28counter._%28exercise._ex~3afile-du%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p></p>

<div class="SIntrapara">Остальные упражнения основаны на понятии пути, который для наших 
целей представляет собой список имен: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._path)"></a><span style="font-style: italic">Path</span><span class="RktCmt"> is [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt">].</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span style="font-weight: bold">interpretation</span><span class="RktCmt"> directions into a directory tree</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Еще раз взгляните на  <a href="#%28counter._%28figure._fig~3aaccountant%29%29" data-pltdoc="x">рисунок&nbsp;<span class="FigureRef">123</span></a>. На этой диаграмме путь от 
<span class="stt">TS</span> к <span class="stt">part1</span> равен 
<span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><span class="RktVal">"TS"</span><span class="stt"> </span><span class="RktVal">"Text"</span><span class="stt"> </span><span class="RktVal">"part1"</span><span class="RktPn">)</span>.
Точно так же путь от <span class="stt">TS</span> к <span class="stt">Code</span> это
<span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><span class="RktVal">"TS"</span><span class="stt"> </span><span class="RktVal">"Libs"</span><span class="stt"> </span><span class="RktVal">"Code"</span><span class="RktPn">)</span>.</div>

<p></p>

<p><a name="(counter._(exercise._ex~3afile-find-path))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;342. Разработайте <span class="RktSym">find</span>. Функция 
использует каталог <span class="RktSym">d</span> и имя файла <span class="RktSym">f</span>. 
Если <span class="RktPn">(</span><span class="RktSym">find?</span><span class="stt"> </span><span class="RktSym">d</span><span class="stt"> </span><span class="RktSym">f</span><span class="RktPn">)</span> равно <span class="RktVal">#true</span>, 
<span class="RktSym">find</span> выдает путь к файлу с именем <span class="RktSym">f</span>; 
в противном случае будет получено  <span class="RktVal">#false</span>.</p>

<p><span style="font-weight: bold">Подсказка</span>  Хотя заманчиво сначала проверить, 
встречается ли имя файла в дереве каталогов, вы должны сделать это для каждого отдельного
подкаталога. Значит лучше совместить функционал  <span class="RktSym">find?</span> и
<span class="RktSym">find</span>.</p>

<p><span style="font-weight: bold">Вызов(трудная задача)</span> 
Функция <span class="RktSym">find</span>
обнаруживает только один из двух файлов с именем <span class="stt">read!</span> на  
<a href="#%28counter._%28figure._fig~3aaccountant%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">123</span></a>. Разработайте <span class="RktSym">find-all</span>, 
которая обобщает <span class="RktSym">find</span> и создает список всех путей, ведущих к 
<span class="RktSym">f</span> в <span class="RktSym">d</span>. Что должно выдавать команда 
<span class="RktSym">find-all</span>, когда <span class="RktPn">(</span><span class="RktSym">find?</span><span class="stt"> </span><span class="RktSym">d</span><span class="stt"> </span><span class="RktSym">f</span><span class="RktPn">)</span> имеет значение 
 <span class="RktVal">#false</span>? Действительно ли эта часть проблемы представляет собой 
вызов(трудную задачу) по сравнению с основной проблемой? 
<a href="#%28counter._%28exercise._ex~3afile-find-path%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3afile-ls-.R))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;343. Разработайте функцию <span class="RktSym">ls-R</span>, которая перечисляет 
пути ко <span style="font-weight: bold">всем</span> файлам, содержащимся в данном каталоге 
<span style="font-style: italic">Dir</span>. 
<a href="#%28counter._%28exercise._ex~3afile-ls-.R%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3afile-find-path-compose))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;344. Перепроектируйте функцию <span class="RktSym">find-all</span> 
из  <a href="#%28counter._%28exercise._ex~3afile-find-path%29%29" data-pltdoc="x">упражнения&nbsp;342</a>, используя <span class="RktSym">ls-R</span> из 
 <a href="#%28counter._%28exercise._ex~3afile-ls-.R%29%29" data-pltdoc="x">упражнения&nbsp;343</a>.
Это разработка с помощью композиции, и если вы решили сложную часть 
<a href="#%28counter._%28exercise._ex~3afile-find-path%29%29" data-pltdoc="x">упражнения&nbsp;342</a>, ваша новая функция также сможет находить каталоги. 
<a href="#%28counter._%28exercise._ex~3afile-find-path-compose%29%29" class="ex-end" data-pltdoc="x"></a></p>

<h3>21<tt>&nbsp;</tt><a name="(part._ch~3aevaluator)"></a>Уточнение Интерпретаторов</h3>

<p>DrRacket - это программа. Она сложна, связанна с множеством различных типов данных. 
Как и большинство сложных программ, DrRacket также состоит из множества функций: 
одна позволяет программистам редактировать текст, другая действует как область 
взаимодействия, третья проверяет, являются ли определения и выражения «grammatical/грамматическими», 
и так далее. </p>

<p>В этой главе мы покажем вам, как разработать функцию, которая реализует 
основу области взаимодействия. Естественно, в этом разрабатываемом проекте мы используем
<a name="(idx._(gentag._519))"></a> итеративное уточнение. По сути, сама идея сосредоточить
внимание на этом аспекте DrRacket - это еще один пример уточнения/усовершенствования, 
а именно, очевидный вариант реализации только одной части функциональности. </p>

<p>Проще говоря, область взаимодействий выполняет задачу определения значений 
вводимых вами выражений. После того, как вы нажмете <span class="emph">RUN</span>, область
взаимодействия знает обо всех определениях. Затем она готова принять выражение, которое 
может относиться к этим определениям, определить значение этого выражения и повторить 
этот цикл так часто, как вы хотите. По этой причине многие люди также называют область
взаимодействия циклом (REPL)чтение-вычисление-печать, где eval - это сокращение от 
<span style="font-style: italic">evaluator</span>(вычислитель/оценщик), функции, которая 
также называется <span style="font-style: italic">interpreter</span>(интерпретатором).</p>

<p>Как и в этой книге, наш процесс уточнения начинается с числовых выражений BSL. 
Они простые; они не предполагают понимания определений; и даже твоя сестра 
в пятом классе может определить их значение. Как только вы поймете этот первый шаг, 
вы поймете разницу между выражением BSL и его представлением. Далее мы переходим к 
выражениям с переменными. Последний шаг - добавить определения. </p>

<h4>21.1<tt>&nbsp;</tt><a name="(part._sec~3ainterpreter)"></a>Интерпретация выражений</h4>

<p>Наша первая задача - согласовать представление данных для программ BSL. 
То есть мы должны выяснить, как представить выражение BSL как часть данных BSL. 
Сначала это звучит странно и непривычно, но это несложно. Предположим, мы просто 
хотим для начала представить числа, сложения и умножения. Ясно, что числа могут 
заменять числа. Однако выражение сложения требует составных данных, потому что 
оно содержит два выражения и потому, что оно отличается от выражения умножения, 
которое также требует представления данных.</p>

<p></p>

<div class="SIntrapara">После <a href="part_one.html#%28part._ch~3astructure%29" data-pltdoc="x">Добавляем структуры</a> простой способ представления сложения и умножения 
состоит в том, чтобы определить два типа структуры, каждая с двумя полями: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">add</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._left%29%29" class="RktStxLink" data-pltdoc="x">left</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._right%29%29" class="RktStxLink" data-pltdoc="x">right</a></span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">mul</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._left%29%29" class="RktStxLink" data-pltdoc="x">left</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._right%29%29" class="RktStxLink" data-pltdoc="x">right</a></span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Предполагается, что поле <span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._left%29%29" class="RktStxLink" data-pltdoc="x">left</a></span> содержит один операнд - тот, 
который «слева» от оператора, а поле <span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._right%29%29" class="RktStxLink" data-pltdoc="x">right</a></span> содержит другой операнд. 
В следующей таблице показаны три примера:
</div>

<p></p>

<blockquote><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td style="border-bottom: 1px solid black;" align="left">

<p><span style="font-weight: bold">Выражение BSL</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span style="font-weight: bold"> представление выражения BSL</span></p>

</td></tr><tr><td align="left"><span class="RktVal">3</span></td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="left"><span class="RktVal">3</span></td></tr><tr><td align="left"><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="left"><span class="RktPn">(</span><span class="RktSym">make-add</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td align="left"><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">300001</span><span class="hspace">&nbsp;</span><span class="RktVal">100000</span><span class="RktPn">)</span></td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="left"><span class="RktPn">(</span><span class="RktSym">make-mul</span><span class="hspace">&nbsp;</span><span class="RktVal">300001</span><span class="hspace">&nbsp;</span><span class="RktVal">100000</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote>

<p></p>

<div class="SIntrapara">Следующий вопрос касается выражения с подвыражениями: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">На удивление простой ответ заключается в том, 
что поля могут содержать любое значение. В этом конкретном случае <span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._left%29%29" class="RktStxLink" data-pltdoc="x">left</a></span> и <span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._right%29%29" class="RktStxLink" data-pltdoc="x">right</a></span> могут содержать представления выражений, 
и вы можете вложить их так глубоко, как захотите. См.  
<a href="#%28counter._%28figure._fig~3arepresenting-bsl%29%29" data-pltdoc="x">Рисунок&nbsp;<span class="FigureRef">124</span></a> для дополнительных примеров. </div>

<p></p>

<blockquote class="Herefigure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td style="border-bottom: 1px solid black;" align="left">

<p><span style="font-weight: bold">Выражение BSL</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span style="font-weight: bold">представление выражения BSL</span></p>

</td></tr><tr><td valign="top" align="left"><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span></td><td valign="top" align="left">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td valign="top" align="left"><span class="RktPn">(</span><span class="RktSym">make-add</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-mul</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span></td></tr><tr><td valign="top" align="left"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td><td valign="top" align="left">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td valign="top" align="left"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym">make-add</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-mul</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-mul</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td></tr><tr><td valign="top" align="left"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td><td valign="top" align="left">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td valign="top" align="left"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym">make-add</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-mul</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-add</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-mul</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-mul</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-add</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3arepresenting-bsl))" x-target-lift="Figure"></a>Рисунок&nbsp;124: </span>Представление выражений BSL в BSL </span></p>

</blockquote>

<p><a name="(counter._(exercise._ex~3absl-dd))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;345. Сформулируйте определение данных для представления выражений BSL на основе
определений структурных типов <span class="RktSym">add</span> и <span class="RktSym">mul</span>.
Давайте использовать <a name="(tech._bsl._expr)"></a><span style="font-style: italic">BSL-expr</span> по аналогии с <a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a> для нового класса данных.</p>

<p></p>

<div class="SIntrapara">Преобразуйте следующие выражения в данные: 
</div><div class="SIntrapara"><ol><li>

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="stt"> </span><span class="RktVal">10</span><span class="stt"> </span><span class="RktVal"><span class="nobreak">-1</span>0</span><span class="RktPn">)</span></p>

</li><li>

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="stt"> </span><span class="RktVal">20</span><span class="stt"> </span><span class="RktVal">3</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktVal">33</span><span class="RktPn">)</span></p>

</li><li>

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="stt"> </span><span class="RktVal">3.14</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="stt"> </span><span class="RktVal">3.14</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="stt"> </span><span class="RktVal"><span class="nobreak">-1</span></span><span class="stt"> </span><span class="RktVal"><span class="nobreak">-9</span></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></p>

</li></ol></div>

<p></p>

<p></p>

<div class="SIntrapara">Интерпретируйте следующие данные как выражения: 
</div><div class="SIntrapara"><ol><li>

<p><span class="RktPn">(</span><span class="RktSym">make-add</span><span class="stt"> </span><span class="RktVal"><span class="nobreak">-1</span></span><span class="stt"> </span><span class="RktVal">2</span><span class="RktPn">)</span></p>

</li><li>

<p><span class="RktPn">(</span><span class="RktSym">make-add</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">make-mul</span><span class="stt"> </span><span class="RktVal"><span class="nobreak">-2</span></span><span class="stt"> </span><span class="RktVal"><span class="nobreak">-3</span></span><span class="RktPn">)</span><span class="stt"> </span><span class="RktVal">33</span><span class="RktPn">)</span>
<span class="refelem"><span class="refcolumn"><span class="refcontent">Здесь 
“interpret”(интерпретировать) означает “(translate)преобразовывать данные в информацию”. 
Напротив, “interpreter”(интерпретатор) в названии этой главы относится к программе, 
которая использует представление программы и выдает ее значение. Хотя эти две идеи связаны, 
они не совпадают. </span></span></span></p>

</li><li>

<p><span class="RktPn">(</span><span class="RktSym">make-mul</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">make-add</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">make-mul</span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktVal">3.14</span><span class="RktPn">)</span> <a href="#%28counter._%28exercise._ex~3absl-dd%29%29" class="ex-end" data-pltdoc="x"></a></p>

</li></ol></div>

<p></p>

<p>Теперь, когда у вас есть представление данных для программ BSL, 
пора разработать evaluator(вычислитель/оценщик). Эта функция использует представление
выражения BSL и выдает его значение. Опять же, эта функция не похожа на все, что вы 
когда-либо создавали, поэтому стоит поэкспериментировать с некоторыми примерами. 
С этой целью вы можете либо использовать правила арифметики для определения значения выражения, 
либо «поиграть» в области взаимодействий DrRacket. Взгляните на следующую таблицу 
для наших примеров: </p>

<blockquote><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td style="border-bottom: 1px solid black;" align="left">

<p><span style="font-weight: bold">Выражение BSL</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span style="font-weight: bold">его представление</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="right">

<p><span style="font-weight: bold">его значение</span></p>

</td></tr><tr><td align="left"><span class="RktVal">3</span></td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left"><span class="RktVal">3</span></td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="right"><span class="RktVal">3</span></td></tr><tr><td align="left"><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left"><span class="RktPn">(</span><span class="RktSym">make-add</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="right"><span class="RktVal">2</span></td></tr><tr><td align="left"><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span></td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left"><span class="RktPn">(</span><span class="RktSym">make-mul</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span></td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="right"><span class="RktVal">30</span></td></tr><tr><td align="left"><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span></td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left"><span class="RktPn">(</span><span class="RktSym">make-add</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-mul</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span></td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="right"><span class="RktVal">11</span></td></tr></tbody></table></blockquote>

<p><a name="(counter._(exercise._ex~3absl-value))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;346. Сформулируйте определение данных для класса значений, которые может 
вычислять представление выражения BSL.
 <a href="#%28counter._%28exercise._ex~3absl-value%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3absl-eval))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;347. Разработайте <span class="RktSym">eval-expression</span>. Функция использует
представление выражения BSL и вычисляет его значение. 
<a href="#%28counter._%28exercise._ex~3absl-eval%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3absl-eval-bool))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;348. Разработайте представление данных для 
<a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a>(логических) выражений BSL, построенных из <span class="RktVal">#true</span>, <span class="RktVal">#false</span>,
<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span>, <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span> и <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._not%29%29" class="RktValLink" data-pltdoc="x">not</a></span>. Затем создайте <span class="RktSym">eval-bool-expression</span>,
который использует (представления) <a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a>(логических) выражений BSL и 
вычисляет их значения. Какие значения выдают эти <a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a>(логические)
выражения? 
<a href="#%28counter._%28exercise._ex~3absl-eval-bool%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p></p>

<div class="SIntrapara"><span style="font-weight: bold">Удобство и синтаксический анализ</span>
 S-выражений предлагают удобный способ представления выражений BSL на нашем языке
программирования: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td>

<p><span class="RktRes">2</span></p>

</td></tr><tr><td><span class="stt">&gt; </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span></td></tr><tr><td>

<p><span class="RktRes">(list '+ 1 1)</span></p>

</td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td>

<p><span class="RktRes">25</span></p>

</td></tr><tr><td><span class="stt">&gt; </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td>

<p><span class="RktRes">(list '+ (list '* 3 3) (list '* 4 4))</span></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">Просто поставив кавычки 
перед выражением, мы получим данные ISL+.</div>

<p></p>

<p>Интерпретация представления S-выражения неуклюжа, в основном потому, что не все 
S-выражения представляют <a href="#%28tech._bsl._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-expr</span></a>(BSL-выражения). Например, <span class="RktVal">#true</span>,
 <span class="RktVal">"hello"</span> и <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="stt"> </span><span class="RktVal">x</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktVal">)</span> 
не являются представителями выражений BSL. В результате S-выражения довольно неудобны 
для разработчиков интерпретаторов. </p>

<p>Программисты изобрели <span style="font-style: italic">parser</span>(парсеры/
анализаторы выражений), чтобы преодолеть разрыв между удобством использования и 
реализацией. Синтаксический анализатор одновременно проверяет, соответствует ли 
часть данных определению данных, и, если это так, создает соответствующий элемент 
из выбранного класса данных. Последнее называется <span style="font-style: italic">parse tree</span>(деревом синтаксического анализа). Если данные не соответствуют, синтаксический 
анализатор сигнализирует об ошибке, как и проверяющие функции из 
 <a href="part_one.html#%28part._sec~3ainput-errors%29" data-pltdoc="x">Input Errors</a>.</p>

<p>На  <a href="#%28counter._%28figure._fig~3aparse-bsl-expr%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">125</span></a> представлен синтаксический
анализатор BSL для S-выражений. В частности, <span class="RktSym">parse</span>(синтаксический
 анализ) использует <a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a> и выдает/производит <span class="RktSym">BSL-expr</span>
 - тогда и только тогда, когда данное S-выражение является результатом цитирования 
выражения BSL, которое имеет представителя <span class="RktSym">BSL-expr</span>. </p>

<p><a name="(counter._(exercise._ex~3absl-parse))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;349. Создавайте тесты для <span class="RktSym">parse</span>, пока DrRacket 
не сообщит вам, что каждый элемент в области определений покрывается во время выполнения теста. 
<a href="#%28counter._%28exercise._ex~3absl-parse%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3absl-parse2))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;350. Что необычного в определении этой программы по отношению к 
рецепту разработки? </p>

<p><span style="font-weight: bold">Примечание</span> Один необычный аспект заключается в том, 
что <span class="RktSym">parse</span> использует <span class="RktSym">length</span>(длину)
аргумента списка. Настоящие парсеры избегают <span class="RktSym">length</span>, потому что 
это замедляет работу функций.
 <a href="#%28counter._%28exercise._ex~3absl-parse2%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3absl-parse1))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;351. Разработайте <span class="RktSym">interpreter-expr</span>. Функция принимает S-выражения. Если <span class="RktSym">parse</span> распознает их как <a href="#%28tech._bsl._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-expr</span></a>, она выдает 
их значение. В противном случае она сигнализирует о той же ошибке, что и 
<span class="RktSym">parse</span>. 
<a href="#%28counter._%28exercise._ex~3absl-parse1%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(idx._(gentag._520))"></a>
<a name="(idx._(gentag._521))"></a>
<a name="(idx._(gentag._522))"></a></p>

<blockquote class="Figure"><a name="(counter._(figure._fig~3aparse-bsl-expr))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._bsl._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-expr</span></a></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">parse</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">atom?</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">parse-atom</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">parse-sl</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._sl%29" class="techoutside" data-pltdoc="x"><span class="techinside">SL</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._bsl._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-expr</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">parse-sl</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">length</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3c%29%29" class="RktValLink" data-pltdoc="x">&lt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktSym">WRONG</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29" class="RktValLink" data-pltdoc="x">symbol?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3d~3f%29%29" class="RktValLink" data-pltdoc="x">symbol=?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">+</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-add</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">parse</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._second%29%29" class="RktValLink" data-pltdoc="x">second</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">parse</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._third%29%29" class="RktValLink" data-pltdoc="x">third</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3d~3f%29%29" class="RktValLink" data-pltdoc="x">symbol=?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">*</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-mul</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">parse</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._second%29%29" class="RktValLink" data-pltdoc="x">second</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">parse</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._third%29%29" class="RktValLink" data-pltdoc="x">third</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktSym">WRONG</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktSym">WRONG</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._bsl._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-expr</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">parse-atom</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._number~3f%29%29" class="RktValLink" data-pltdoc="x">number?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktSym">WRONG</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29" class="RktValLink" data-pltdoc="x">symbol?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktSym">WRONG</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;125: </span>От S-expr к BSL-expr </span></p>

</blockquote><h4>21.2<tt>&nbsp;</tt><a name="(part._sec~3ainterpreter-variables)"></a>Интерпретация переменных </h4>

<p></p>

<div class="SIntrapara">Поскольку в первом разделе игнорируются определения констант, 
выражение не имеет значения, если оно содержит переменную. В самом деле, если мы не знаем, 
что означает <span class="RktSym">x</span>, нет смысла вычислять <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="stt"> </span><span class="RktVal">3</span><span class="stt"> </span><span class="RktSym">x</span><span class="RktPn">)</span>.
Следовательно, одним из первых усовершенствований вычислителя является добавление переменных 
к выражениям, которые мы хотим вычислить. Предполагается, что область определений содержит 
такие определения, как 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">и что программисты вычисляют выражения, содержащие 
<span class="RktSym">x</span>, в области взаимодействия: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="stt">&gt; </span><span class="RktSym">x</span></td></tr><tr><td>

<p><span class="RktRes">5</span></p>

</td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></td></tr><tr><td>

<p><span class="RktRes">8</span></p>

</td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1/2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td>

<p><span class="RktRes">7.5</span></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">В самом деле, вы можете
представить себе второе определение, скажем  <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="stt"> </span><span class="RktSym">y</span><span class="stt"> </span><span class="RktVal">3</span><span class="RktPn">)</span>, и взаимодействия, включающие две переменные: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td></tr><tr><td>

<p><span class="RktRes">34</span></p>

</td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">В предыдущем разделе неявно предлагаются символы в качестве 
представления переменных. В конце концов, если бы вы выбрали S-выражения в кавычках 
для представления выражений с переменными, символы появились бы естественно: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="stt">&gt; </span><span class="RktVal">'</span><span class="RktVal">x</span></td></tr><tr><td>

<p><span class="RktRes">'x</span></p>

</td></tr><tr><td><span class="stt">&gt; </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">1/2</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">x</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td>

<p><span class="RktRes">(list '* 0.5 (list '* 'x 3))</span></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">Одна очевидная 
альтернатива - строка, так что <span class="RktVal">"x"</span> будет представлять 
<span class="RktSym">x</span>, но эта книга не о разработке интерпретаторов, поэтому мы
придерживаемся символов. Из этого решения следует, как изменить определение данных из 
<a href="#%28counter._%28exercise._ex~3absl-dd%29%29" data-pltdoc="x">упражнения&nbsp;345</a>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._bsl._var._expr)"></a><span style="font-style: italic">BSL-var-expr</span><span class="RktCmt"> is one of: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><a href="part_one.html#%28tech._number%29" class="techoutside" data-pltdoc="x"><span class="techinside">Number</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym">make-add</span><span class="stt"> </span><a href="#%28tech._bsl._var._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-var-expr</span></a><span class="stt"> </span><a href="#%28tech._bsl._var._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-var-expr</span></a><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym">make-mul</span><span class="stt"> </span><a href="#%28tech._bsl._var._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-var-expr</span></a><span class="stt"> </span><a href="#%28tech._bsl._var._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-var-expr</span></a><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">Мы просто добавляем одно предложение к 
определению данных</div>

<p></p>

<p></p>

<div class="SIntrapara">Что касается примеров данных, в следующей таблице показаны 
некоторые выражения BSL с переменными и их представление<a href="#%28tech._bsl._var._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-var-expr</span></a>: 
</div><div class="SIntrapara"><blockquote><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td style="border-bottom: 1px solid black;" align="left">

<p><span style="font-weight: bold">Выражение BSL</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span style="font-weight: bold">представление выражения BSL </span></p>

</td></tr><tr><td align="left"><span class="RktSym">x</span></td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="left"><span class="RktVal">'</span><span class="RktVal">x</span></td></tr><tr><td align="left"><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="left"><span class="RktPn">(</span><span class="RktSym">make-add</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">x</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></td></tr><tr><td align="left"><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1/2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span></td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="left"><span class="RktPn">(</span><span class="RktSym">make-mul</span><span class="hspace">&nbsp;</span><span class="RktVal">1/2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-mul</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">x</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td align="left"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="left"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym">make-add</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-mul</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">x</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-mul</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">y</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">y</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Все они взяты из приведенных выше взаимодействий, что означает, что вы знаете результаты, 
когда <span class="RktSym">x</span>  равно <span class="RktVal">5</span>, а
<span class="RktSym">y</span> - <span class="RktVal">3</span>.</div>

<p></p>

<p>Один из способов определить значение выражений переменных - заменить все 
переменные значениями, которые они представляют. Это способ, который вы знаете 
из школьных уроков математики, и это прекрасный способ. </p>

<p><a name="(counter._(exercise._ex~3absl-var-subst))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;352. Разработайте <span class="RktSym">subst</span>. 
Функция использует <a href="#%28tech._bsl._var._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-var-expr</span></a> <span class="RktSym">ex</span>, 
<a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a> <span class="RktSym">x</span> и 
<a href="part_one.html#%28tech._number%29" class="techoutside" data-pltdoc="x"><span class="techinside">Number</span></a> <span class="RktSym">v</span>. Она производит 
<a href="#%28tech._bsl._var._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-var-expr</span></a>, подобное <span class="RktSym">ex</span>, 
со всеми вхождениями <span class="RktSym">x</span>, замененными на <span class="RktSym">v</span>.
<a href="#%28counter._%28exercise._ex~3absl-var-subst%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3absl-var-numeric))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;353. Создайте функцию <span class="RktSym">numeric?</span>. 
Она определяет, является ли <a href="#%28tech._bsl._var._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-var-expr</span></a> также <a href="#%28tech._bsl._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-expr</span></a>. 
Здесь мы предполагаем, что ваше решение  <a href="#%28counter._%28exercise._ex~3absl-dd%29%29" data-pltdoc="x">упражнения&nbsp;345</a> - это определение <a href="#%28tech._bsl._var._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-var-expr</span></a> без
<a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a>s. 
<a href="#%28counter._%28exercise._ex~3absl-var-numeric%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3absl-var-eval))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;354. Разработайте <span class="RktSym">eval-variable</span>. 
Проверяющая функция потребляет <span class="RktSym">BSL-var-expr</span> и определяет его 
значение, если <span class="RktSym">numeric?</span> дает true для ввода. В противном случае
сигнализирует об ошибке.</p>

<p></p>

<div class="SIntrapara">Как правило, программа определяет множество констант в области
определений, а выражения содержат более одной переменной. Чтобы вычислить такие выражения, 
нам нужно представление области определений, когда она содержит серию определений
констант. Для этого упражнения мы используем ассоциативные списки: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._al)"></a><span style="font-style: italic">AL</span><span class="RktCmt"> (short for </span><span style="font-style: italic">association list</span><span class="RktCmt">) is [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="#%28tech._association%29" class="techoutside" data-pltdoc="x"><span class="techinside">Association</span></a><span class="RktCmt">].</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._association)"></a><span style="font-style: italic">Association</span><span class="RktCmt"> is a list of two items:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="part_one.html#%28tech._number%29" class="techoutside" data-pltdoc="x"><span class="techinside">Number</span></a><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktCmt">.</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Составляют элементы  <a href="#%28tech._al%29" class="techoutside" data-pltdoc="x"><span class="techinside">AL</span></a>.</div>

<p></p>

<p>Разработайте <span class="RktSym">eval-variable*</span>. Функция использует 
<a href="#%28tech._bsl._var._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-var-expr</span></a>  <span class="RktSym">ex</span> и 
ассоциативный список <span class="RktSym">da</span>. Начиная с <span class="RktSym">ex</span>, 
она итеративно применяет <span class="RktSym">subst</span> ко всем ассоциациям из
<span class="RktSym">da</span>. Если <span class="RktSym">numeric?</span> истинен 
для результата, определяет его значение; в противном случае она сигнализирует о той же ошибке, 
как и <span class="RktSym">eval-variable</span>. <span style="font-weight: bold">Подсказка</span>
Думайте о заданном <a href="#%28tech._bsl._var._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-var-expr</span></a> как об атомарном значении и вместо этого 
просмотрите данный список ассоциаций. Мы даем эту подсказку, потому что для создания этой 
функции требуются небольшие знания разработки из  
 <a href="#%28part._ch~3asimu%29" data-pltdoc="x">Одновременная Обработка.</a>. <a href="#%28counter._%28exercise._ex~3absl-var-eval%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><span style="font-weight: bold"><span style="font-weight: bold">Модель среды</span>
<a href="#%28counter._%28exercise._ex~3absl-var-eval%29%29" data-pltdoc="x">Упражнение&nbsp;354</a>
основано на математическом понимании определений констант. Если имя определено для обозначения
некоторого значения, все вхождения имени могут быть заменены значением. Подстановка выполняет 
эту замену раз и навсегда до того, как начнется процесс вычисления.
</p>

<p>Альтернативный подход, получивший название 
<span style="font-style: italic">модели среды(environment model)</span>, 
заключается в поиске значения переменной при необходимости. Вычислитель 
немедленно начинает обработку выражения, но также 
продолжает представление области определений. Каждый раз, когда вычислитель встречает 
переменную, он ищет ее значение в области определений и использует её.</p>

<p></p>

<div class="SIntrapara"><a name="(counter._(exercise._ex~3absl-var-eval2))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;355. Разработайте <span class="RktSym">eval-var-lookup</span>.  та функция имеет ту же сигнатуру, что и <span class="RktSym">eval-variable*</span>:
<a name="(idx._(gentag._523))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._bsl._var._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-var-expr</span></a><span class="RktCmt"> </span><a href="#%28tech._al%29" class="techoutside" data-pltdoc="x"><span class="techinside">AL</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._number%29" class="techoutside" data-pltdoc="x"><span class="techinside">Number</span></a></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">eval-var-lookup</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._e%29%29" class="RktValLink" data-pltdoc="x">e</a></span><span class="hspace">&nbsp;</span><span class="RktSym">da</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Вместо использования подстановки функция обходит выражение способом, который предлагает 
рецепт разработки для <a href="#%28tech._bsl._var._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-var-expr</span></a>. В нисходящем выражении оно 
«увлекает» <span class="RktSym">da</span>. Когда она встречает символ 
<span class="RktSym">x</span>, она использует <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._assq%29%29" class="RktValLink" data-pltdoc="x">assq</a></span> 
для поиска значения <span class="RktSym">x</span> в списке ассоциаций. Если значение отсутствует,
<span class="RktSym">eval-var-lookup</span> сигнализирует об ошибке.  
<a href="#%28counter._%28exercise._ex~3absl-var-eval2%29%29" class="ex-end" data-pltdoc="x"></a></div>

<p></p>

<h4>21.3<tt>&nbsp;</tt><a name="(part._sec~3ainterpreter-functions)"></a>Интерпретация Функций</h4>

<p>На этом этапе вы понимаете, как вычислять программы BSL, состоящие из определений 
констант и выражений переменных. Естественно, вы хотите добавить определения функций, 
чтобы знать - по крайней мере в принципе - как работать со всем BSL. </p>

<p>Цель этого раздела - усовершенствовать вычислитель из <a href="#%28part._sec~3ainterpreter-variables%29" data-pltdoc="x">Интерпретации Переменных</a>, чтобы он мог справляться 
с функциями. Поскольку определения функций отображаются в области определений, 
другой способ описать усовершенствованный вычислитель - сказать, что он имитирует 
DrRacket, когда область определений содержит несколько определений функций, а 
программист вводит выражение в области взаимодействий, которое содержит использование 
этих функций.</p>

<p>Для простоты предположим, что все функции в области определений используют 
один аргумент и что существует только одно такое определение. Необходимые знания 
предметной области восходят к школе, где вы узнали, что <span style="font-style: italic">f</span>(<span style="font-style: italic">x</span>)<span style="font-style: italic"> = e</span>
 представляет собой определение функции <span style="font-style: italic">f</span>, что 
<span style="font-style: italic">f</span>(<span style="font-style: italic">a</span>)<span style="font-style: italic"></span>) представляет применение <span style="font-style: italic">f</span> к <span style="font-style: italic">a</span>, и что для вычисления последнего вы 
подставляете <span style="font-style: italic">a</span> вместо <span style="font-style: italic">x</span> в <span style="font-style: italic">e</span>. Оказывается, вычисление функциональных
приложений на таком языке, как BSL, в основном работает так же. </p>

<p>Перед тем как приступить к выполнению следующих упражнений, вы можете 
освежить свои знания терминологии, касающейся функций, представленной в 
интермеццо 1. В большинстве случаев на курсах алгебры этот аспект математики 
игнорируется, но когда вам понадобится точное использование и понимание 
терминологии. желаю вам решить эти проблемы. </p>

<p><a name="(counter._(exercise._ex~3absl-one-def))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;356. Расширьте представление данных из
<a href="#%28part._sec~3ainterpreter-variables%29" data-pltdoc="x">интерпретации переменных</a>,
включив в него применение функции, определяемой программистом. Напомним, что 
применение-функция состоит из двух частей: имени и выражения. Первая - это имя 
применяемой функции; последняя аргумент.</p>

<p>Представьте эти выражения:  <span class="RktPn">(</span><span class="RktSym">k</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span>, <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="stt"> </span><span class="RktVal">5</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">k</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span>, <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">i</span><span class="stt"> </span><span class="RktVal">5</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">k</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span>.  Мы называем 
этот недавно определенный класс данных  <a name="(tech._bsl._fun._expr)"></a><span style="font-style: italic">BSL-fun-expr</span>. 
<a href="#%28counter._%28exercise._ex~3absl-one-def%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p></p>

<div class="SIntrapara"><a name="(counter._(exercise._ex~3absl-eval-def1))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;357. Разработайте <span class="RktSym">eval-definition1</span>.
 Функция использует четыре аргумента:
</div><div class="SIntrapara"><ol><li>

<p><a href="#%28tech._bsl._fun._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-fun-expr</span></a> <span class="RktSym">ex</span>;</p>

</li><li>

<p>символ <span class="RktSym">f</span>, который представляет имя функции;;</p>

</li><li>

<p>символ <span class="RktSym">x</span>, который представляет параметр функции; а также</p>

</li><li>

<p><a href="#%28tech._bsl._fun._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-fun-expr</span></a> <span class="RktSym">b</span>, представляющий 
тело функции. </p>

</li></ol></div><div class="SIntrapara">Он определяет значение <span class="RktSym">ex</span>.
Когда <span class="RktSym">eval-definition1</span> встречает применение 
<span class="RktSym">f</span> к некоторому аргументу, он
</div><div class="SIntrapara"><ol><li>

<p>вычисляет аргумент,</p>

</li><li>

<p>подставляет значение аргумента в <span class="RktSym">x</span> , заменяя его
на <span class="RktSym">b</span>; а также</p>

</li><li>

<p>наконец, вычисляет результирующее выражение с помощью 
<span class="RktSym">eval-definition1</span>.</p>

</li></ol></div><div class="SIntrapara">Вот как выразить эти шаги в виде кода, предполагая, 
что <span class="RktSym">arg</span> является аргументом применения функции: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">value</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">eval-definition1</span><span class="hspace">&nbsp;</span><span class="RktSym">arg</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">plugd</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subst</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">value</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">eval-definition1</span><span class="hspace">&nbsp;</span><span class="RktSym">plugd</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Обратите внимание, что в этой строке используется форма рекурсии, которая не рассматривалась.
Правильная разработка таких функций обсуждается в разделе 
<a href="part_five.html" data-pltdoc="x">Генеративная рекурсия</a>.</div>

<p></p>

<p>Если <span class="RktSym">eval-definition1</span> встречает переменную, она сигнализирует 
о той же ошибке, что и <span class="RktSym">eval-variable</span> из  
<a href="#%28counter._%28exercise._ex~3absl-var-eval%29%29" data-pltdoc="x">упражнения&nbsp;354</a>. Она также сигнализирует об ошибке для применения функций, которые ссылаются на имя функции,
отличное от  <span class="RktSym">f</span>.</p>

<p><span style="font-weight: bold">Предупреждение</span> Использование этой открытой 
формы рекурсии вводит новый элемент в ваши вычисления: незавершение(non-termination). 
То есть программа может работать вечно, вместо того, чтобы выдавать результат или 
сигнализировать об ошибке. Если вы следовали рецептам разработки первых четырех частей, 
вы не сможете записать такие программы. Ради интереса создайте вход для 
<span class="RktSym">eval-definition1</span>, который заставит его работать вечно. 
Используйте <span class="emph">STOP</span>, чтобы завершить программу. 
<a href="#%28counter._%28exercise._ex~3absl-eval-def1%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p>Для вычислителя, который имитирует область взаимодействия, нам нужно представление 
области определений. Мы предполагаем, что это список определений. </p>

<p></p>

<div class="SIntrapara"><a name="(counter._(exercise._ex~3absl-prog-dd))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;358. Предоставьте тип структуры и определение данных 
для определений функций. Напомним, что у такого определения есть три основных атрибута:
</div><div class="SIntrapara"><ol><li>

<p> имя функции, представленное символом;</p>

</li><li>

<p> параметр функции, который также является именем; а также</p>

</li><li>

<p>тело функции, которое является выражением переменной.</p>

</li></ol></div><div class="SIntrapara">Мы используем 
<a name="(tech._bsl._fun._def)"></a><span style="font-style: italic">BSL-fun-def</span>
для обозначения этого класса данных.</div>

<p></p>

<p></p>

<div class="SIntrapara">Используйте свое определение данных для представления этих 
определений функций BSL: 
</div><div class="SIntrapara"><ol><li>

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">f</span><span class="stt"> </span><span class="RktSym">x</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="stt"> </span><span class="RktVal">3</span><span class="stt"> </span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span></p>

</li><li>

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">g</span><span class="stt"> </span><span class="RktSym">y</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">f</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></p>

</li><li>

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">h</span><span class="stt"> </span><span class="RktSym">v</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">f</span><span class="stt"> </span><span class="RktSym">v</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">g</span><span class="stt"> </span><span class="RktSym">v</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></p>

</li></ol></div>

<p></p>

<p>Затем определите класс <a name="(tech._bsl._fun._def*)"></a><span style="font-style: italic">BSL-fun-def*</span> для представления области определений, состоящей из ряда определений функций 
с одним аргументом. Преобразуйте область определений, которая определяет 
<span class="RktSym">f</span>, <span class="RktSym">g</span> и <span class="RktSym">h</span>, 
в ваше представление данных и назовите его <span class="RktSym">da-fgh</span>.</p>

<p></p>

<div class="SIntrapara">Наконец, поработайте над следующим пожеланием: 
<a name="(idx._(gentag._524))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._bsl._fun._def%2A%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-fun-def*</span></a><span class="RktCmt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._bsl._fun._def%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-fun-def</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">retrieves the definition of </span><span class="RktSym">f</span><span class="RktCmt"> in </span><span class="RktSym">da</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">signals an error if there is none</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup-def</span><span class="hspace">&nbsp;</span><span class="RktSym">da-fgh</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">g</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">g</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup-def</span><span class="hspace">&nbsp;</span><span class="RktSym">da</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Поиск определения необходим для вычисления приложений.
<a href="#%28counter._%28exercise._ex~3absl-prog-dd%29%29" class="ex-end" data-pltdoc="x"></a></div>

<p></p>

<p><a name="(counter._(exercise._ex~3absl-eval-def))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;359.  Разработайте <span class="RktSym">eval-function*</span>. 
Функция использует <span class="RktSym">ex</span>, <a href="#%28tech._bsl._fun._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-fun-expr</span></a>, и 
<span class="RktSym">da</span> представление <a href="#%28tech._bsl._fun._def%2A%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-fun-def*</span></a> 
области определений. Она дает результат, который DrRacket показывает, если вы 
вычисляете <span class="RktSym">ex</span> в области взаимодействий, предполагая, что 
область определений содержит  <span class="RktSym">da</span>.</p>

<p></p>

<div class="SIntrapara">Функция работает так же, как <span class="RktSym">eval-definition1</span>
из  <a href="#%28counter._%28exercise._ex~3absl-eval-def1%29%29" data-pltdoc="x">упражнения&nbsp;357</a>. Для применения некоторой функции <span class="RktSym">f</span> она
</div><div class="SIntrapara"><ol><li>

<p> вычисляет аргумент;</p>

</li><li>

<p>ищет определение <span class="RktSym">f</span> в представлении <span class="RktSym">da</span>
в <a href="#%28tech._bsl._fun._def%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-fun-def</span></a>, которое имеет параметр и тело;</p>

</li><li>

<p>заменяет значение аргумента на параметр функции в теле функции; а также</p>

</li><li>

<p>вычисляет новое выражение через рекурсию. </p>

</li></ol></div><div class="SIntrapara">Как и DrRacket, 
<span class="RktSym">eval-function*</span> сигнализирует об ошибке, когда встречает имя 
переменной или функции без определения в области определений.
 <a href="#%28counter._%28exercise._ex~3absl-eval-def%29%29" class="ex-end" data-pltdoc="x"></a></div>

<p></p>

<h4>21.4<tt>&nbsp;</tt><a name="(part._sec~3ainterpreter-all)"></a>Интерпретация Всего</h4>

<p></p>

<div class="SIntrapara">Взгляните на следующую программу BSL:  <a name="(idx._(gentag._525))"></a> <a name="(idx._(gentag._526))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">close-to-pi</span><span class="hspace">&nbsp;</span><span class="RktVal">3.14</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area-of-circle</span><span class="hspace">&nbsp;</span><span class="RktSym">r</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">close-to-pi</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r</span><span class="hspace">&nbsp;</span><span class="RktSym">r</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">volume-of-10-cylinder</span><span class="hspace">&nbsp;</span><span class="RktSym">r</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">area-of-circle</span><span class="hspace">&nbsp;</span><span class="RktSym">r</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Думайте об этих определениях как об области определений в DrRacket. После того, как вы 
нажмете <span class="emph">RUN</span>, вы можете вычислить выражения, включающие 
<span class="RktSym">close-to-pi</span>,  <span class="RktSym">area-of-circle</span> и 
<span class="RktSym">volume-of-10-cylinder</span> в области взаимодействий: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">area-of-circle</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td>

<p><span class="RktRes">#i3.14</span></p>

</td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">volume-of-10-cylinder</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td>

<p><span class="RktRes">#i31.400000000000002</span></p>

</td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktSym">close-to-pi</span><span class="RktPn">)</span></td></tr><tr><td>

<p><span class="RktRes">#i9.42</span></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">Цель этого раздела - 
снова усовершенствовать(уточнить) ваш вычислитель, чтобы он мог имитировать большую часть DrRacket.</div>

<p></p>

<p><a name="(counter._(exercise._ex~3absl-da-all))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;360. Сформулируйте определение данных для представления области определений 
DrRacket. Конкретно, представление данных должно работать для последовательности, которая 
свободно смешивает определения констант и определения функций с одним аргументом. Убедитесь, 
что вы можете представить область определений, состоящую из трех определений, в начале этого
 раздела. Мы называем этот класс данных 
 <a name="(tech._bsl._da._all)"></a><span style="font-style: italic">BSL-da-all</span>.</p>

<p>Разработайте функцию <span class="RktSym">lookup-con-def</span>. Она потребляет 
 <a href="#%28tech._bsl._da._all%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-da-all</span></a> <span class="RktSym">da</span> и символ 
<span class="RktSym">x</span>. Она выдает представление определения константы с именем 
<span class="RktSym">x</span>, если такая часть данных существует в 
<span class="RktSym">da</span>; в противном случае функция сигнализирует об ошибке, 
говоря, что такое определение константы не может быть найдено.</p>

<p>Создайте функцию <span class="RktSym">lookup-fun-def</span>. Она потребляет 
<a href="#%28tech._bsl._da._all%29" class="techoutside" data-pltdoc="x"><span class="techinside">BSL-da-all</span></a> <span class="RktSym">da</span> и символ 
<span class="RktSym">f</span>. Она выдает представление определения функции с именем 
<span class="RktSym">f</span>, если такая часть данных существует в 
<span class="RktSym">da</span>; в противном случае функция сигнализирует об ошибке, 
говоря, что такое определение функции не может быть найдено. 
<a href="#%28counter._%28exercise._ex~3absl-da-all%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3absl-eval-all))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;361. Разработайте <span class="RktSym">eval-all</span>. 
Подобно <span class="RktSym">eval-function*</span> из  <a href="#%28counter._%28exercise._ex~3absl-eval-def%29%29" data-pltdoc="x">упражнения&nbsp;359</a>, эта функция использует представление
выражения и области определений. Она выдает то же значение, что и DrRacket, если выражение
вводится в приглашении в области взаимодействий, а область определений содержит соответствующие
определения. <span style="font-weight: bold">Подсказка</span> Ваша функция 
<span class="RktSym">eval-all</span> должна обрабатывать переменные в данном выражении, 
как <span class="RktSym">eval-var-lookup</span> в 
<a href="#%28counter._%28exercise._ex~3absl-var-eval2%29%29" data-pltdoc="x">упражнении&nbsp;355</a>. <a href="#%28counter._%28exercise._ex~3absl-eval-all%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3absl-all-sexpr))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;362. Громоздко вводить структурное представление данных 
выражений BSL и области определений. Как показывает конец 
<a href="#%28part._sec~3ainterpreter%29" data-pltdoc="x">Интерпретация выражений</a>, 
гораздо проще заключать в кавычки выражения и (списки) определений. </p>

<p>Разработайте <span class="RktSym">interpreter</span>(интерпретатор) функций. Он использует
<span class="RktSym">S-expr</span> и <span class="RktSym">Sl</span>. Первый должен 
представлять выражение, а второй - список определений. Функция выполняет синтаксический 
анализ с помощью соответствующих функций синтаксического анализа, а затем использует 
<span class="RktSym">eval-all</span> из  <a href="#%28counter._%28exercise._ex~3absl-eval-all%29%29" data-pltdoc="x">упражнения&nbsp;361</a> для вычисления выражения. 
<span style="font-weight: bold">Совет</span> Вы должны адаптировать идеи  
<a href="#%28counter._%28exercise._ex~3absl-parse2%29%29" data-pltdoc="x">упражнения&nbsp;350</a>,
чтобы создать синтаксический анализатор определений и списков определений.
<a href="#%28counter._%28exercise._ex~3absl-all-sexpr%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p>На данный момент вы многое знаете об интерпретации BSL. Вот некоторые из недостающих 
частей: <a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a>(логические значения) с 
<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> или <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span>; Строки
(<a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a>) и такие операции, как  <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string-length%29%29" class="RktValLink" data-pltdoc="x">string-length</a></span> или <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string-append%29%29" class="RktValLink" data-pltdoc="x">string-append</a></span>; и списки с <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span>, <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span>,
 <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span>, <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span>, <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span>, <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span>; и так далее. 
Как только ваш вычислитель сможет справиться со всем этим, это будет в основном завершено, 
потому что ваши вычислители уже знают, как интерпретировать рекурсивные функции. Теперь, 
когда мы говорим «доверьтесь нам, вы знаете, как создавать эти усовершенствования», 
мы имеем в виду это. </p>

<h3>22<tt>&nbsp;</tt><a name="(part._ch~3amoney-sexp)"></a>Проект: Торговля с помощью XML</h3>

<p>XML - широко используемый язык данных. Одно из применений касается обмена 
сообщениями между программами, запущенными на разных компьютерах. Например, 
когда вы указываете свой веб-браузер на веб-сайте, вы подключаете программу 
на своем компьютере к программе на другом компьютере, и последний отправляет 
данные XML первому. Как только браузер получает данные XML, он отображает 
их как изображение на мониторе вашего компьютера.
</p>

<p></p>

<div class="SIntrapara">Следующее сравнение иллюстрирует эту идею на конкретном примере: 
</div><div class="SIntrapara"><blockquote><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td style="border-bottom: 1px solid black;" align="left">

<p><span style="font-weight: bold">Данные XML</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span style="font-weight: bold">отображается в браузере </span></p>

</td></tr><tr><td valign="bottom" align="left"><table cellspacing="0" cellpadding="0"><tbody><tr><td>

<p><span class="stt">&lt;ul&gt;</span></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;</span><span class="stt">&lt;li&gt; hello &lt;/li&gt;</span></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;</span><span class="stt">&lt;li&gt; &lt;ul&gt; </span></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&lt;li&gt; one &lt;/li&gt;</span></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&lt;li&gt; two &lt;/li&gt;</span></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&lt;/ul&gt;</span></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;</span><span class="stt">&lt;/li&gt;</span></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;</span><span class="stt">&lt;li&gt; world &lt;/li&gt;</span></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;</span><span class="stt">&lt;li&gt; good bye &lt;/li&gt;</span></p>

</td></tr><tr><td>

<p><span class="stt">&lt;/ul&gt;</span></p>

</td></tr></tbody></table></td><td valign="bottom" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td valign="bottom" align="left">

<p><img src="part_four_files/xml-example.png" alt="" width="100" height="110"></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">Слева вы видите фрагмент 
XML-данных, который веб-сайт может отправить вашему веб-браузеру. Справа вы видите, как 
один популярный браузер отображает этот фрагмент графически.</div>

<p></p>

<p>В этой главе объясняются основы обработки XML как еще одно упражнение по проектированию,
касающееся взаимосвязанных определений данных и <a name="(idx._(gentag._527))"></a>
итеративного уточнения. Следующий раздел начинается с неформального сравнения 
S-выражений и данных XML и использует его для формулирования полноценного определения данных. 
<span class="refelem"><span class="refcolumn"><span class="refcontent">
Если вы считаете, что XML слишком старомоден для 2021 года, не стесняйтесь повторить 
упражнение для JSON или другого современного формата обмена данными. Принципы разработки
остались прежними. 
</span></span></span>
В остальных разделах на примерах объясняется, как обрабатывать S-выражениями данные XML. </p>

<h4>22.1<tt>&nbsp;</tt><a name="(part._sec~3axml)"></a>XML как S-выражения</h4>

<p></p>

<div class="SIntrapara">Самый простой фрагмент XML-данных выглядит так: 
</div><div class="SIntrapara"><blockquote><table class="SVerbatim" cellspacing="0" cellpadding="0"><tbody><tr><td>

<p><span class="stt">&lt;machine&gt; &lt;/machine&gt;</span></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">Он называется 
<span style="font-style: italic">element</span>, а “machine”(машина) - это имя элемента. 
Две части элемента похожи на круглые скобки, ограничивающие <span style="font-style: italic">content</span>(содержимое) элемента. Когда между двумя частями нет содержимого, 
кроме пробела, XML допускает сокращение: 
</div><div class="SIntrapara"><blockquote><table class="SVerbatim" cellspacing="0" cellpadding="0"><tbody><tr><td>

<p><span class="stt">&lt;machine /&gt;</span></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">Но, что касается нас, 
это сокращение эквивалентно явно заключенной в квадратные скобки версии.
</div>

<p></p>

<p></p>

<div class="SIntrapara">С точки зрения S-выражения, элемент XML - это 
<span style="font-weight: bold">именованная</span> пара круглых скобок, 
которые окружают некоторый контент(содержание).
<span class="refelem"><span class="refcolumn"><span class="refcontent">Библиотека 
<span class="stt">xml</span> Racket представляет XML в виде структур, а также S-выражениями.
</span></span></span> 
И действительно, представление вышесказанного с помощью S-выражения вполне естественно: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">machine</span><span class="RktVal">)</span></p>

</blockquote></div><div class="SIntrapara">Этот фрагмент данных имеет открывающую и 
закрывающую круглые скобки, и в нем есть место для встраивания содержимого.</div>

<p></p>

<p></p>

<div class="SIntrapara">Вот фрагмент XML-данных с содержанием: 
</div><div class="SIntrapara"><blockquote><table class="SVerbatim" cellspacing="0" cellpadding="0"><tbody><tr><td>

<p><span class="stt">&lt;machine&gt;&lt;action /&gt;&lt;/machine&gt;</span></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">Помните, что часть 
<span class="stt">&lt;action /&gt;</span> - это сокращение, то есть мы на самом деле 
смотрим на этот фрагмент данных: 
</div><div class="SIntrapara"><blockquote><table class="SVerbatim" cellspacing="0" cellpadding="0"><tbody><tr><td>

<p><span class="stt">&lt;machine&gt;&lt;action&gt;&lt;/action&gt;&lt;/machine&gt;</span></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">В общем, содержимое элемента
XML представляет собой серию элементов XML: 
</div><div class="SIntrapara"><blockquote><table class="SVerbatim" cellspacing="0" cellpadding="0"><tbody><tr><td>

<p><span class="stt">&lt;machine&gt;&lt;action /&gt;&lt;action /&gt;&lt;action /&gt;&lt;/machine&gt;</span></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">Стоп! Перед продолжением
раскройте сокращение для <span class="stt">&lt;action /&gt;</span></div>

<p></p>

<p></p>

<div class="SIntrapara">Представление S-выражения продолжает выглядеть простым. Вот первое: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">machine</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">action</span><span class="RktVal">)</span><span class="RktVal">)</span></p>

</blockquote></div><div class="SIntrapara">И это представление для второго: :
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">machine</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">action</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">action</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">action</span><span class="RktVal">)</span><span class="RktVal">)</span></p>

</blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">
Когда вы смотрите на фрагмент XML-данных с последовательностью из трех элементов 
<span class="stt">&lt;action /&gt;</span> в качестве содержимого, вы понимаете, что можете 
захотеть отличать такие элементы друг от друга. Для этой цели XML-элементы имеют 
<span style="font-style: italic">attributes</span>(атрибуты). Например, 
</div><div class="SIntrapara"><blockquote><table class="SVerbatim" cellspacing="0" cellpadding="0"><tbody><tr><td>

<p><span class="stt">&lt;machine initial="red"&gt;&lt;/machine&gt;</span></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">
этот элемент “machine”, снабжен одним атрибутом с <span style="font-style: italic">именем</span> 
“initial”(начальный) и значением “red”(красный) между строковыми кавычками. Вот сложный 
XML-элемент с вложенными элементами, тоже имеющими атрибуты: 
</div><div class="SIntrapara"><blockquote><table class="SVerbatim" cellspacing="0" cellpadding="0"><tbody><tr><td>

<p><span class="stt">&lt;machine initial="red"&gt;</span></p>

</td></tr><tr><td>

<p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;action state="red"</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">next="green" /&gt;</span></p>

</td></tr><tr><td>

<p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;action state="green"</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">next="yellow" /&gt;</span></p>

</td></tr><tr><td>

<p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;action state="yellow" next="red" /&gt;</span></p>

</td></tr><tr><td>

<p><span class="stt">&lt;/machine&gt;</span></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">Мы используем пробелы, 
отступы и разрывы строк, чтобы сделать элемент читаемым, но этот пробел здесь не имеет значения 
для наших XML-данных.</div>

<p></p>

<p></p>

<div class="SIntrapara">Естественно, S-выражения для этих элементов “machine” очень похожи 
на своих собратьев XML: 
<span class="refelem"><span class="refcolumn"><span class="refcontent">XML на 40 лет моложе S-выражений.</span></span></span>
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">machine</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">initial</span><span class="hspace">&nbsp;</span><span class="RktVal">"red"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></p>

</blockquote></div><div class="SIntrapara">Чтобы добавить атрибуты к элементу, 
мы используем список списков, каждый из которых содержит два элемента: символ и строку. 
Символ представляет имя атрибута, а строка - его значение. Эта идея, естественно, применима 
и к сложным формам XML-данных:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">machine</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">initial</span><span class="hspace">&nbsp;</span><span class="RktVal">"red"</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">action</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">state</span><span class="hspace">&nbsp;</span><span class="RktVal">"red"</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">next</span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">action</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">state</span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">next</span><span class="hspace">&nbsp;</span><span class="RktVal">"yellow"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">action</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">state</span><span class="hspace">&nbsp;</span><span class="RktVal">"yellow"</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">next</span><span class="hspace">&nbsp;</span><span class="RktVal">"red"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">А пока обратите внимание, как атрибуты отмечены двумя 
открывающими круглыми скобками, а оставшийся список (представлений) элементов XML 
имеет одну открывающую скобку.</div>

<p></p>

<p>Вы можете вспомнить идею из <a href="i2-3.html" data-pltdoc="x">Intermezzo 2: Quote, Unquote</a>, в котором S-выражения используются для представления XHTML, особого диалекта XML. 
В частности, интермеццо показывает, насколько легко программист может записывать нетривиальные 
XML-данные и даже шаблоны XML-представлений, используя <span class="RktSym">backquote</span>(обратные кавычки) и <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._unquote%29%29" class="RktStxLink" data-pltdoc="x">unquote</a></span>(отмены кавычек). Конечно, 
<a href="#%28part._sec~3ainterpreter%29" data-pltdoc="x">Интерпретация выражений</a> 
указывает на то, что вам нужен синтаксический анализатор, чтобы определить, является ли 
какое-либо данное S-выражение представлением данных XML, а синтаксический анализатор является
сложной и необычной функцией. </p>

<p></p>

<div class="SIntrapara">Тем не менее, мы выбрали представление XML на основе S-выражений, 
чтобы продемонстрировать практическую пользу этой старой поэтической идеи. Мы постепенно 
переходим к разработке определения данных, заставляя работать <a name="(idx._(gentag._528))"></a>итеративное уточнение. Вот первая попытка: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._xexpr..v0)"></a><span style="font-style: italic">Xexpr.v0</span><span class="RktCmt"> (short for </span><span style="font-style: italic">X-expression</span><span class="RktCmt">) is a one-item list:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">Это идея «именованных скобок» из 
начала этого раздела. Оснастить это представление элемента содержимым очень просто: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._xexpr..v1)"></a><span style="font-style: italic">Xexpr.v1</span><span class="RktCmt"> is a list:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="stt"> </span><span class="RktPn">[</span><span class="RktSym">List-of</span><span class="stt"> </span><a href="#%28tech._xexpr..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v1</span></a><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Символьное имя становится первым элементом в списке, который в противном случае состоит 
из представителей элементов XML.
</div>

<p></p>

<p></p>

<div class="SIntrapara">Последний шаг уточнения - добавление атрибутов. Поскольку атрибуты
в элементе XML являются необязательными, пересмотренное определение данных содержит два 
предложения: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._xexpr..v2)"></a><span style="font-style: italic">Xexpr.v2</span><span class="RktCmt"> is a list: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="stt"> </span><span style="font-style: italic">Body</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktPn">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="stt"> </span><a href="#%28tech._attribute%29" class="techoutside" data-pltdoc="x"><span class="techinside">Attribute</span></a><span class="RktPn">]</span><span class="stt"> </span><span style="font-style: italic">Body</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">where </span><span style="font-style: italic">Body</span><span class="RktCmt"> is short for [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="#%28tech._xexpr..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v2</span></a><span class="RktCmt">]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._attribute)"></a><span style="font-style: italic">Attribute</span><span class="RktCmt"> is a list of two items:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p><a name="(counter._(exercise._ex~3axml-no-list-of))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;363. Все элементы <a href="#%28tech._xexpr..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v2</span></a> начинаются с символа(<a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a>), но за некоторыми следует список атрибутов, а за 
некоторыми - просто список  <a href="#%28tech._xexpr..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v2</span></a>s. Переформулируйте определение 
<a href="#%28tech._xexpr..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v2</span></a>, чтобы выделить общее начало и выделить различные 
типы окончаний.</p>

<p>Исключите использование <a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a> из
<a href="#%28tech._xexpr..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v2</span></a>. <a href="#%28counter._%28exercise._ex~3axml-no-list-of%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p></p>

<div class="SIntrapara"><a name="(counter._(exercise._ex~3axml-represent))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;364. Представьте эти XML-данные как элементы 
<a href="#%28tech._xexpr..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v2</span></a>:
</div><div class="SIntrapara"><ol><li>

<p><span class="stt">&lt;transition from="seen-e" to="seen-f" /&gt;</span></p>

</li><li>

<p><span class="stt">&lt;ul&gt;&lt;li&gt;&lt;word /&gt;&lt;word /&gt;&lt;/li&gt;&lt;li&gt;&lt;word /&gt;&lt;/li&gt;&lt;/ul&gt;</span></p>

</li></ol></div><div class="SIntrapara">Какой из них может быть представлен в 
 <a href="#%28tech._xexpr..v0%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v0</span></a> или <a href="#%28tech._xexpr..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v1</span></a>? <a href="#%28counter._%28exercise._ex~3axml-represent%29%29" class="ex-end" data-pltdoc="x"></a></div>

<p></p>

<p></p>

<div class="SIntrapara"><a name="(counter._(exercise._ex~3axml-interpret))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;365. Интерпретируйте следующие элементы 
<a href="#%28tech._xexpr..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v2</span></a> как данные XML: 
</div><div class="SIntrapara"><ol><li>

<p><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">server</span><span class="stt"> </span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">name</span><span class="stt"> </span><span class="RktVal">"example.org"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></p>

</li><li>

<p><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">carcas</span><span class="stt"> </span><span class="RktVal">(</span><span class="RktVal">board</span><span class="stt"> </span><span class="RktVal">(</span><span class="RktVal">grass</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="stt"> </span><span class="RktVal">(</span><span class="RktVal">player</span><span class="stt"> </span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">name</span><span class="stt"> </span><span class="RktVal">"sam"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></p>

</li><li>

<p><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">start</span><span class="RktVal">)</span></p>

</li></ol></div><div class="SIntrapara">Какие из них являются элементами 
<a href="#%28tech._xexpr..v0%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v0</span></a> или <a href="#%28tech._xexpr..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v1</span></a>? 
<a href="#%28counter._%28exercise._ex~3axml-interpret%29%29" class="ex-end" data-pltdoc="x"></a></div>

<p></p>

<p></p>

<div class="SIntrapara">Грубо говоря, X-выражения моделируют структуры через списки. 
Симуляция удобна для программистов; они требует наименьшего количества ввода с клавиатуры.
Например, если X-выражение не имеет списка атрибутов, оно просто опускается. Такой выбор
представления данных представляет собой компромисс между созданием таких выражений вручную 
и их автоматической обработкой. Лучший способ справиться с последней проблемой - предоставить
функции, которые делают X-выражения похожими на структуры, особенно функции, которые обращаются 
к квазиполям: 
</div><div class="SIntrapara"><ul><li>

<p><span class="RktSym">xexpr-name</span>, который извлекает тег представления элемента;</p>

</li><li>

<p><span class="RktSym">xexpr-attr</span>, извлекающий список атрибутов; а также
</p>

</li><li>

<p><span class="RktSym">xexpr-content</span>, который извлекает список элементов содержимого.</p>

</li></ul></div><div class="SIntrapara">Когда у нас есть эти функции, мы можем использовать 
списки для представления XML, которые действуют так, как если бы они были экземплярами 
структурного типа.</div>

<p></p>

<p></p>

<div class="SIntrapara">Эти функции анализируют S-выражения, и их сложно спроектировать. 
Итак, давайте тщательно их спроектируем, начав с некоторых примеров данных: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a0</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">initial</span><span class="hspace">&nbsp;</span><span class="RktVal">"X"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">e0</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">machine</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">e1</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">machine</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a0</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">e2</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">machine</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">action</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">e3</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">machine</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">action</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">e4</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">machine</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a0</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">action</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">action</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Первое определение вводит список атрибутов, который дважды повторно используется при 
построении X-выражений. Определение <span class="RktSym">e0</span> напоминает нам, 
что X-выражение может не иметь атрибутов или содержимого. Вы должны уметь объяснить, почему 
<span class="RktSym">e2</span> и <span class="RktSym">e3</span> в основном эквивалентны.</div>

<p></p>

<p></p>

<div class="SIntrapara">Затем мы формулируем сигнатуру, предназначение и заголовок:  
<a name="(idx._(gentag._529))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._xexpr..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v2</span></a><span class="RktCmt"> -&gt; [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="#%28tech._attribute%29" class="techoutside" data-pltdoc="x"><span class="techinside">Attribute</span></a><span class="RktCmt">]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">retrieves the list of attributes of </span><span class="RktSym">xe</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-attr</span><span class="hspace">&nbsp;</span><span class="RktSym">xe</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Здесь мы сосредотачиваемся на <span class="RktSym">xexpr-attr</span>; оставим два других 
в качестве упражнений.</div>

<p></p>

<p></p>

<div class="SIntrapara">Составление функциональных примеров требует решения об 
извлечении атрибутов из X-выражений без их использования. Хотя наше выбранное представление
полностью опускает отсутствующие атрибуты, мы должны предоставить <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span> для структурного 
представления XML. Поэтому функция производит <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span> для таких X-выражений: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-attr</span><span class="hspace">&nbsp;</span><span class="RktSym">e0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-attr</span><span class="hspace">&nbsp;</span><span class="RktSym">e1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">initial</span><span class="hspace">&nbsp;</span><span class="RktVal">"X"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-attr</span><span class="hspace">&nbsp;</span><span class="RktSym">e2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-attr</span><span class="hspace">&nbsp;</span><span class="RktSym">e3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-attr</span><span class="hspace">&nbsp;</span><span class="RktSym">e4</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">initial</span><span class="hspace">&nbsp;</span><span class="RktVal">"X"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Пора разработать шаблон. Поскольку определение данных для 
 <a href="#%28tech._xexpr..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v2</span></a> является сложным, мы продвигаемся медленно, 
шаг за шагом. Во-первых, хотя определение данных различает два вида X-выражений, 
оба предложения описывают данные, созданные путем <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span>inga(включения) символа в список. Во-вторых, то, что отличает 
эти два предложения, - это остальная часть списка и особенно необязательное наличие списка
атрибутов. Давайте превратим эти две идеи в шаблон: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-attr</span><span class="hspace">&nbsp;</span><span class="RktSym">xe</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">optional-loa+content</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">xe</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">optional-loa+content</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">Локальное определение(loacal define) 
отбрасывает имя  X-выражения и оставляет оставшуюся часть списка, который может 
начинаться или не начинаться со списка атрибутов. Ключ в том, что это просто список, 
и два предложения <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> указывают на это. В-третьих, этот список
определяется <span style="font-weight: bold">не</span> через ссылку на себя, а как 
необязательный <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span> некоторых 
атрибутов в возможно пустой список X-выражений. Другими словами, нам все еще нужно различать 
два обычных случая и извлекать обычные части: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-attr</span><span class="hspace">&nbsp;</span><span class="RktSym">xe</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">optional-loa+content</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">xe</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">optional-loa+content</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">optional-loa+content</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">optional-loa+content</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">На этом этапе мы уже видим, что рекурсия не нужна для данной 
задачи. Итак, переходим к пятому шагу рецепта проектирования. Ясно, что атрибутов нет, 
если данное X-выражение не содержит ничего, кроме имени. Во втором предложении вопрос 
заключается в том, является ли первый элемент в списке списком атрибутов или просто 
<a href="#%28tech._xexpr..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v2</span></a>. Поскольку это звучит сложно, мы загадываем 
пожелание:  
<a name="(idx._(gentag._530))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="#%28tech._attribute%29" class="techoutside" data-pltdoc="x"><span class="techinside">Attribute</span></a><span class="RktCmt">] or </span><a href="#%28tech._xexpr..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v2</span></a><span class="RktCmt"> -&gt; ???</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">determines whether </span><span class="RktSym">x</span><span class="RktCmt"> is an element of [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="#%28tech._attribute%29" class="techoutside" data-pltdoc="x"><span class="techinside">Attribute</span></a><span class="RktCmt">]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktVal">#false</span><span class="RktCmt"> otherwise</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-of-attributes?</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">#false</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
С помощью этой функции легко завершить <span class="RktSym">xexpr-attr</span>; см. 
<a href="#%28counter._%28figure._fig~3axexpr-attr%29%29" data-pltdoc="x">рисунок&nbsp;<span class="FigureRef">126</span></a>. Если первым элементом является список атрибутов, 
функция его производит; в противном случае атрибутов нет. </div>

<p></p>

<blockquote class="Figure"><a name="(counter._(figure._fig~3axexpr-attr))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-attr</span><span class="hspace">&nbsp;</span><span class="RktSym">xe</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">optional-loa+content</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">xe</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">optional-loa+content</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loa-or-x</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">optional-loa+content</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-of-attributes?</span><span class="hspace">&nbsp;</span><span class="RktSym">loa-or-x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">loa-or-x</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;126: </span>Полное определение <span class="RktSym">xexpr-attr</span></span></p>

</blockquote>

<p></p>

<div class="SIntrapara">Для разработки списка <span class="RktSym">list-of-attributes?</span> 
Мы действуем таким же образом и получаем следующее определение: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="#%28tech._attribute%29" class="techoutside" data-pltdoc="x"><span class="techinside">Attribute</span></a><span class="RktCmt">] or </span><a href="#%28tech._xexpr..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v2</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">is </span><span class="RktSym">x</span><span class="RktCmt"> a list of attributes</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-of-attributes?</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">possible-attribute</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">possible-attribute</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Мы пропускаем детали процесса проектирования, потому что они ничем не примечательны. 
Что <span style="font-weight: bold">примечательно</span>, так это сигнатура этой функции. 
Вместо того чтобы указывать одно определение данных в качестве возможных входных данных, 
сигнатура объединяет два определения данных, разделенных английским словом “or”(или). 
В ISL+ такая неформальная сигнатура с определенным значением иногда приемлема. </div>

<p></p>

<p><a name="(counter._(exercise._ex~3axml-accessors))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;366. Разработайте <span class="RktSym">xexpr-name</span> и
<span class="RktSym">xexpr-content</span>. 
<a href="#%28counter._%28exercise._ex~3axml-accessors%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3axml-odd-recursion))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;367. Рецепт разработки требует наличия ссылки на себя в шаблоне 
для <span class="RktSym">xexpr-attr</span>. Добавьте эту ссылку на себя в шаблон, а затем
объясните, почему завершенная функция синтаксического анализа не содержит ее.
<a href="#%28counter._%28exercise._ex~3axml-odd-recursion%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3axml-dd))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;368. Сформулируйте определение данных, которое заменяет неформальную сигнатуру
“or”(или) для определения функции <span class="RktSym">list-of-attributes?</span>.  
<a href="#%28counter._%28exercise._ex~3axml-dd%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3alookup-attribute))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;369. Разработайте <span class="RktSym">find-attr</span>. 
Функция использует список атрибутов и символ. Если список атрибутов связывает 
символ со строкой, функция извлекает эту строку; в противном случае возвращается 
<span class="RktVal">#false</span>. Найдите <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._assq%29%29" class="RktValLink" data-pltdoc="x">assq</a></span>
и используйте его для определения функции.
 <a href="#%28counter._%28exercise._ex~3alookup-attribute%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p>В оставшейся части этой главы <a name="(tech._xexpr)"></a><span style="font-style: italic">Xexpr</span> ссылается на  <a href="#%28tech._xexpr..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v2</span></a>. Кроме того, мы предполагаем, что
определены <span class="RktSym">xexpr-name</span>, <span class="RktSym">xexpr-attr</span>
и <span class="RktSym">xexpr-content</span>. Наконец, мы используем 
<span class="RktSym">find-attr</span> из  <a href="#%28counter._%28exercise._ex~3alookup-attribute%29%29" data-pltdoc="x">упражнения&nbsp;369</a> для получения значений атрибутов. </p>

<h4>22.2<tt>&nbsp;</tt><a name="(part._sec~3aenum)"></a>Визуализация XML-перечислений</h4>

<p>XML - это фактически <span style="font-weight: bold">семейство</span> языков. 
Люди определяют диалекты для определенных каналов общения. Например, XHTML - это 
язык для отправки веб-контента в формате XML. В этом разделе мы проиллюстрируем, 
как разработать функцию рендеринга для небольшого фрагмента XHTML, в частности 
перечислений(enumerations) из начала этой главы. </p>

<p>Тег <span class="stt">ul</span> окружает так называемый неупорядоченный список HTML. 
Каждый элемент этого списка помечен <span class="stt">li</span>, который обычно содержит 
слова, а также другие элементы, даже перечисления. «Неупорядоченный HTML» означает, что 
каждый элемент должен отображаться с начальным маркером вместо числа.
</p>

<p></p>

<div class="SIntrapara">Поскольку <a href="#%28tech._xexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr</span></a> не содержит простых строк, не сразу 
становится очевидным, как представлять перечисления XHTML в подмножестве. Один из вариантов 
- еще раз уточнить представление данных, чтобы <a href="#%28tech._xexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr</span></a> мог быть 
<a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a>(строкой). Другой вариант - ввести представление для 
текста: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._xword)"></a><span style="font-style: italic">XWord</span><span class="RktCmt"> is </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">word</span><span class="stt"> </span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">text</span><span class="stt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktCmt">.</span></p>

</blockquote></div><div class="SIntrapara">Здесь мы используем второй вариант; Racket, 
язык, на котором основаны языки обучения, предлагает библиотеки, которые включают 
<a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a> в <a href="#%28tech._xexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr</span></a>.</div>

<p></p>

<p><a name="(counter._(exercise._ex~3axml-words))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;370. Составьте три примера для <a href="#%28tech._xword%29" class="techoutside" data-pltdoc="x"><span class="techinside">XWord</span></a>s. Разработайте 
<span class="RktSym">word?</span>, которая проверяет, находится ли какое-либо значение ISL+ 
в <a href="#%28tech._xword%29" class="techoutside" data-pltdoc="x"><span class="techinside">XWord</span></a>, и <span class="RktSym">word-text</span>, которая извлекает значение единственного
атрибута экземпляра  <a href="#%28tech._xword%29" class="techoutside" data-pltdoc="x"><span class="techinside">XWord</span></a>. 
<a href="#%28counter._%28exercise._ex~3axml-words%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3axml+string))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;371. Уточните определение <a href="#%28tech._xexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr</span></a>, чтобы вы могли представлять элементы XML,
включая элементы в перечислениях, в виде простых строк. 
<a href="#%28counter._%28exercise._ex~3axml%2Bstring%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p></p>

<div class="SIntrapara">Учитывая представление слов, представление перечисления слов в 
стиле XHTML очень просто: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._xenum..v1)"></a><span style="font-style: italic">XEnum.v1</span><span class="RktCmt"> is one of: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">ul</span><span class="stt"> </span><span class="RktPn">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="stt"> </span><a href="#%28tech._xitem..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v1</span></a><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">ul</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktSym">Attributes</span><span class="stt"> </span><span class="RktPn">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="stt"> </span><a href="#%28tech._xitem..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v1</span></a><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._xitem..v1)"></a><span style="font-style: italic">XItem.v1</span><span class="RktCmt"> is one of:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">li</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="#%28tech._xword%29" class="techoutside" data-pltdoc="x"><span class="techinside">XWord</span></a><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">li</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktSym">Attributes</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="#%28tech._xword%29" class="techoutside" data-pltdoc="x"><span class="techinside">XWord</span></a><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Для полноты определение данных включает списки атрибутов, даже если они не влияют на 
визуализацию.
</div>

<p></p>

<p>Стоп! Утверждают, что каждый элемент <a href="#%28tech._xenum..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">XEnum.v1</span></a> также находится в 
<a href="#%28tech._xexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">XExpr</span></a>.</p>

<p></p>

<div class="SIntrapara">Вот пример элемента  <a href="#%28tech._xenum..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">XEnum.v1</span></a>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">e0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">ul</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">li</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">word</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">text</span><span class="hspace">&nbsp;</span><span class="RktVal">"one"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">li</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">word</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">text</span><span class="hspace">&nbsp;</span><span class="RktVal">"two"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Это соответствует внутреннему перечислению примера из начала главы. При рендеринге с помощью
  <span class="sroman">библиотеки <span class="Smaller"><span style="font-style: italic">2htdp/image</span></span> </span> должно получиться такое изображение: 
</div><div class="SIntrapara"><blockquote class="SCentered">

<p><img style="vertical-align: -3.2265625px; margin: -3px -3px -3px -3px;" src="part_four_files/pict_146.png" alt="image" width="37.0654296875" height="38.15625"></p>

</blockquote></div><div class="SIntrapara">Радиус ядра и расстояние между маркером и 
текстом являются эстетическими; здесь  имеет значение идея.
</div>

<p></p>

<p></p>

<div class="SIntrapara">Чтобы создать такой образ, вы можете использовать эту программу ISL+: 
<span class="refelem"><span class="refcolumn"><span class="refcontent">
мы разработали эти выражения в области взаимодействий. 
Что бы  <span style="font-style: italic">вы</span> сделали? 
</span></span></span>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">e0-rendered</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._above%2Falign%29%29" class="RktValLink" data-pltdoc="x">above/align</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">left</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._beside%2Falign%29%29" class="RktValLink" data-pltdoc="x">beside/align</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">center</span><span class="hspace">&nbsp;</span><span class="RktSym">BT</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._text%29%29" class="RktValLink" data-pltdoc="x">text</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"one"</span><span class="hspace">&nbsp;</span><span class="RktVal">12</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">black</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._beside%2Falign%29%29" class="RktValLink" data-pltdoc="x">beside/align</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">center</span><span class="hspace">&nbsp;</span><span class="RktSym">BT</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._text%29%29" class="RktValLink" data-pltdoc="x">text</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"two"</span><span class="hspace">&nbsp;</span><span class="RktVal">12</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">black</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
предполагая, что <span class="RktSym">BT</span> - это рендеринг ядра(отображение круга перед
текстом).
</div>

<p></p>

<p>Теперь давайте тщательно спроектируем функцию. Поскольку для представления данных 
требуется два определения данных, рецепт проектирования говорит вам, что вы должны 
проектировать две функции параллельно. Однако повторный взгляд показывает, что в этом 
конкретном случае второе определение данных не связано с первым, что означает, что мы 
можем иметь дело с ним отдельно.</p>

<p></p>

<div class="SIntrapara">Кроме того, определение <a href="#%28tech._xitem..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v1</span></a> 
состоит из двух предложений, то есть сама функция должна состоять из 
<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> с двумя предложениями. Однако смысл 
рассмотрения <a href="#%28tech._xitem..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v1</span></a> как подъязыка <a href="#%28tech._xexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr</span></a>, состоит 
в том, чтобы рассматривать эти два предложения в терминах функций селектора 
<a href="#%28tech._xexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr</span></a>, в частности, <span class="RktSym">xexpr-content</span>. С помощью этой функции 
мы можем извлечь текстовую часть элемента, независимо от того, есть ли у него атрибуты 
или нет: 
<a name="(idx._(gentag._531))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._xitem..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v1</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._image%29" class="techoutside" data-pltdoc="x"><span class="techinside">Image</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">renders an item as a "word" prefixed by a bullet </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">render-item1</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-content</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Обычно <span class="RktSym">xexpr-content</span> извлекает список <a href="#%28tech._xexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr</span></a>; в этом 
конкретном случае список содержит ровно одно <a href="#%28tech._xword%29" class="techoutside" data-pltdoc="x"><span class="techinside">XWord</span></a>, и это слово содержит один текст: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">render-item1</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-content</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">element</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a-word</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">word-text</span><span class="hspace">&nbsp;</span><span class="RktSym">element</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a-word</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Отсюда все просто: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">render-item1</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-content</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">element</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a-word</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">word-text</span><span class="hspace">&nbsp;</span><span class="RktSym">element</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">item</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._text%29%29" class="RktValLink" data-pltdoc="x">text</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a-word</span><span class="hspace">&nbsp;</span><span class="RktVal">12</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">black</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._beside%2Falign%29%29" class="RktValLink" data-pltdoc="x">beside/align</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">center</span><span class="hspace">&nbsp;</span><span class="RktSym">BT</span><span class="hspace">&nbsp;</span><span class="RktSym">item</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
После извлечения текста, который будет отображаться в элементе, остается просто отобразить 
его как текст и снабдить его начальным маркером; см. приведенные выше примеры, чтобы узнать, 
как вы можете обнаружить этот последний шаг. </div>

<p></p>

<p><a name="(counter._(exercise._ex~3axml-item1))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;372. Прежде чем продолжить, снабдите определение 
<span class="RktSym">render-item1</span> тестами. Обязательно сформулируйте эти тесты таким
образом, чтобы они не зависели от константы <span class="RktSym">BT</span>. Затем объясните, 
<span style="font-weight: bold">как</span> работает функция; имейте в виду, что в 
предназначении объясняется, <span style="font-weight: bold">что</span> она делает. 
<a href="#%28counter._%28exercise._ex~3axml-item1%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p></p>

<div class="SIntrapara">Теперь мы можем сосредоточиться на разработке функции, 
которая отображает перечисление. Используя приведенный выше пример, первые два шага 
проектирования просты: 
 <a name="(idx._(gentag._532))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._xenum..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">XEnum.v1</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._image%29" class="techoutside" data-pltdoc="x"><span class="techinside">Image</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">renders a simple enumeration as an image </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">render-enum1</span><span class="hspace">&nbsp;</span><span class="RktSym">e0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">e0-rendered</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">render-enum1</span><span class="hspace">&nbsp;</span><span class="RktSym">xe</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._empty-image%29%29" class="RktValLink" data-pltdoc="x">empty-image</a></span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Ключевым этапом является разработка шаблона. Согласно определению данных, элемент 
<a href="#%28tech._xenum..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">XEnum.v1</span></a> содержит одну интересную часть данных, а 
именно (представление) XML-элементов. Первым элементом всегда является 
<span class="RktVal">'</span><span class="RktVal">ul</span>, поэтому нет необходимости 
извлекать его, а второй, необязательный элемент, представляет собой список атрибутов, 
которые мы игнорируем. Имея это в виду, первый черновик шаблона выглядит так же, как 
и для <span class="RktSym">render-item1</span>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">render-enum1</span><span class="hspace">&nbsp;</span><span class="RktSym">xe</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-content</span><span class="hspace">&nbsp;</span><span class="RktSym">xe</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="#%28tech._xitem..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v1</span></a><span class="RktCmt">]</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">В то время как рецепт разработки, 
<a name="(idx._(gentag._533))"></a>ориентированный на данные, говорит вам, что вы должны
разработать отдельную функцию всякий раз, когда вы сталкиваетесь со сложной формой данных, 
<a name="(idx._(gentag._534))"></a>рецепт разработки на основе абстракции из 
<a href="part_three.html" data-pltdoc="x">Абстракция</a> говорит вам повторно использовать
существующую абстракцию, скажем, функцию обработки списка из 
<a href="part_three.html#%28counter._%28figure._fig~3aisl-ho-list%29%29" data-pltdoc="x">рисунков&nbsp;<span class="FigureRef">95</span></a> и <a href="part_three.html#%28counter._%28figure._fig~3aisl-ho-list2%29%29" data-pltdoc="x"><span class="FigureRef">96</span></a>, когда это возможно. Учитывая, что 
<span class="RktSym">render-enum1</span> должна обрабатывать список и создавать из него 
одно изображение, единственными двумя абстракциями обработки списков, сигнатуры которых
соответствуют всем требованиям, являются <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29" class="RktValLink" data-pltdoc="x">foldr</a></span> и
 <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldl%29%29" class="RktValLink" data-pltdoc="x">foldl</a></span>. 
Если вы также изучите их предназначения, вы увидите шаблон, похожий на приведенный выше 
пример <span class="RktSym">e0-rendered</span>, особенно для <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29" class="RktValLink" data-pltdoc="x">foldr</a></span>. Попробуем использовать его, следуя рецепту повторного 
использования разработки: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">render-enum1</span><span class="hspace">&nbsp;</span><span class="RktSym">xe</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-content</span><span class="hspace">&nbsp;</span><span class="RktSym">xe</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._xitem..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v1</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._image%29" class="techoutside" data-pltdoc="x"><span class="techinside">Image</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._image%29" class="techoutside" data-pltdoc="x"><span class="techinside">Image</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">deal-with-one</span><span class="hspace">&nbsp;</span><span class="RktSym">item</span><span class="hspace">&nbsp;</span><span class="RktSym">so-far</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29" class="RktValLink" data-pltdoc="x">foldr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">deal-with-one</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._empty-image%29%29" class="RktValLink" data-pltdoc="x">empty-image</a></span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Из сопоставления типов вы также знаете, что:
</div><div class="SIntrapara"><ol><li>

<p> первым аргументом <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29" class="RktValLink" data-pltdoc="x">foldr</a></span> должна 
быть функция с двумя аргументами;</p>

</li><li>

<p> вторым аргументом должно быть изображение; а также</p>

</li><li>

<p> последний аргумент - это список, представляющий содержимое XML.</p>

</li></ol></div><div class="SIntrapara">Естественно, что <span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._empty-image%29%29" class="RktValLink" data-pltdoc="x">empty-image</a></span>(пустое изображение) 
- правильная отправная точка. </div>

<p></p>

<p></p>

<div class="SIntrapara">Это разработка через повторное использование фокусирует наше 
внимание на функции, которая должна выполнить “folded”(свертку) над списком. Она превращает 
один элемент и изображение, созданное <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29" class="RktValLink" data-pltdoc="x">foldr</a></span>, 
в другое изображение. Сигнатура для <span class="RktSym">deal-with-one</span> выражает это
понимание. Поскольку первым аргументом является <a href="#%28tech._xitem..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v1</span></a>, 
<span class="RktSym">render-item1</span> - это функция, которая его отображает. 
Это дает два изображения, которые необходимо объединить: изображение первого элемента 
и изображение остальных элементов. Чтобы сложить их, мы используем  
<span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._above%29%29" class="RktValLink" data-pltdoc="x">above(выше)</a></span>: 
<a name="(idx._(gentag._535))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">render-enum1</span><span class="hspace">&nbsp;</span><span class="RktSym">xe</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-content</span><span class="hspace">&nbsp;</span><span class="RktSym">xe</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._xitem..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v1</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._image%29" class="techoutside" data-pltdoc="x"><span class="techinside">Image</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._image%29" class="techoutside" data-pltdoc="x"><span class="techinside">Image</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">deal-with-one</span><span class="hspace">&nbsp;</span><span class="RktSym">item</span><span class="hspace">&nbsp;</span><span class="RktSym">so-far</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._above%2Falign%29%29" class="RktValLink" data-pltdoc="x">above/align</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">left</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">render-item1</span><span class="hspace">&nbsp;</span><span class="RktSym">item</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">so-far</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29" class="RktValLink" data-pltdoc="x">foldr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">deal-with-one</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._empty-image%29%29" class="RktValLink" data-pltdoc="x">empty-image</a></span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<blockquote class="Herefigure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._xitem..v2)"></a><span style="font-style: italic">XItem.v2</span><span class="RktCmt"> is one of: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">li</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="#%28tech._xword%29" class="techoutside" data-pltdoc="x"><span class="techinside">XWord</span></a><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">li</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktPn">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="stt"> </span><a href="#%28tech._attribute%29" class="techoutside" data-pltdoc="x"><span class="techinside">Attribute</span></a><span class="RktPn">]</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><a href="#%28tech._xword%29" class="techoutside" data-pltdoc="x"><span class="techinside">XWord</span></a><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">li</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="#%28tech._xenum..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XEnum.v2</span></a><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">li</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktPn">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="stt"> </span><a href="#%28tech._attribute%29" class="techoutside" data-pltdoc="x"><span class="techinside">Attribute</span></a><span class="RktPn">]</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><a href="#%28tech._xenum..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XEnum.v2</span></a><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._xenum..v2)"></a><span style="font-style: italic">XEnum.v2</span><span class="RktCmt"> is one of:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">ul</span><span class="stt"> </span><span class="RktPn">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="stt"> </span><a href="#%28tech._xitem..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v2</span></a><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">ul</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktPn">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="stt"> </span><a href="#%28tech._attribute%29" class="techoutside" data-pltdoc="x"><span class="techinside">Attribute</span></a><span class="RktPn">]</span><span class="stt"> </span><span class="RktPn">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="stt"> </span><a href="#%28tech._xitem..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v2</span></a><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3axenum))" x-target-lift="Figure"></a>Рисунок&nbsp;127: </span>Реалистичное представление данных перечислений XML </span></p>

</blockquote>

<p>Плоские перечисления распространены, но они также являются простым приближением 
к полноценному случаю. В реальном мире веб-браузеры должны справляться с произвольно 
вложенными перечислениями, которые поступают через Интернет. В XML и его диалекте 
веб-браузера XHTML вложение выполняется просто. Любой элемент может отображаться как 
содержимое любого другого элемента. 
<span class="refelem"><span class="refcolumn"><span class="refcontent">
Вам интересно, является ли произвольное вложение правильным подходом к решению 
этой проблемы? Если да, разработайте определение данных, которое допускает только три уровня вложенности, а затем используйте его. </span></span></span>  
Чтобы представить эту взаимосвязь в нашем ограниченном представлении XHTML, мы говорим, 
что элемент является либо словом, либо другим перечислением. На 
 <a href="#%28counter._%28figure._fig~3axenum%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">127</span></a> показана вторая версия определения данных. Оно включает 
пересмотр определения данных для перечислений, так что первое определение относится к 
правильной форме элемента.
</p>

<blockquote class="Herefigure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">SIZE</span><span class="hspace">&nbsp;</span><span class="RktVal">12</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">font size </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">COLOR</span><span class="hspace">&nbsp;</span><span class="RktVal">"black"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">font color </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">BT</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">a graphical constant </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._beside%29%29" class="RktValLink" data-pltdoc="x">beside</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._circle%29%29" class="RktValLink" data-pltdoc="x">circle</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">solid</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">black</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._text%29%29" class="RktValLink" data-pltdoc="x">text</a></span><span class="hspace">&nbsp;</span><span class="RktVal">" "</span><span class="hspace">&nbsp;</span><span class="RktSym">SIZE</span><span class="hspace">&nbsp;</span><span class="RktSym">COLOR</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="part_one.html#%28tech._image%29" class="techoutside" data-pltdoc="x"><span class="techinside">Image</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._image%29" class="techoutside" data-pltdoc="x"><span class="techinside">Image</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">marks item with bullet</span><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bulletize</span><span class="hspace">&nbsp;</span><span class="RktSym">item</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._beside%2Falign%29%29" class="RktValLink" data-pltdoc="x">beside/align</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">center</span><span class="hspace">&nbsp;</span><span class="RktSym">BT</span><span class="hspace">&nbsp;</span><span class="RktSym">item</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._xenum..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XEnum.v2</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._image%29" class="techoutside" data-pltdoc="x"><span class="techinside">Image</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">renders an </span><a href="#%28tech._xenum..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XEnum.v2</span></a><span class="RktCmt"> as an image </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">render-enum</span><span class="hspace">&nbsp;</span><span class="RktSym">xe</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-content</span><span class="hspace">&nbsp;</span><span class="RktSym">xe</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._xitem..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v2</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._image%29" class="techoutside" data-pltdoc="x"><span class="techinside">Image</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._image%29" class="techoutside" data-pltdoc="x"><span class="techinside">Image</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">deal-with-one</span><span class="hspace">&nbsp;</span><span class="RktSym">item</span><span class="hspace">&nbsp;</span><span class="RktSym">so-far</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._above%2Falign%29%29" class="RktValLink" data-pltdoc="x">above/align</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">left</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">render-item</span><span class="hspace">&nbsp;</span><span class="RktSym">item</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">so-far</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29" class="RktValLink" data-pltdoc="x">foldr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">deal-with-one</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._empty-image%29%29" class="RktValLink" data-pltdoc="x">empty-image</a></span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._xitem..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v2</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._image%29" class="techoutside" data-pltdoc="x"><span class="techinside">Image</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">renders one </span><a href="#%28tech._xitem..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v2</span></a><span class="RktCmt"> as an image </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">render-item</span><span class="hspace">&nbsp;</span><span class="RktSym">an-item</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-content</span><span class="hspace">&nbsp;</span><span class="RktSym">an-item</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bulletize</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">word?</span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._text%29%29" class="RktValLink" data-pltdoc="x">text</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">word-text</span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">SIZE</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">black</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">render-enum</span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3aenum))" x-target-lift="Figure"></a>Рисунок&nbsp;128: </span>Уточняющие функции для соответствия уточнениям определений данных</span></p>

</blockquote>

<p>Следующий вопрос заключается в том, как это изменение определения данных влияет 
на функции отрисовки. Другими словами, нам нужно пересмотреть 
<span class="RktSym">render-enum1</span> и <span class="RktSym">render-item1</span>, 
чтобы они могли справиться с <a href="#%28tech._xenum..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XEnum.v2</span></a> и <a href="#%28tech._xitem..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v2</span></a> соответственно.
Инженеры-программисты постоянно сталкиваются с подобными вопросами, и это еще одна ситуация, 
когда <a name="(idx._(gentag._536))"></a>рецепт дизайна сияет. </p>

<p><a href="#%28counter._%28figure._fig~3aenum%29%29" data-pltdoc="x">Рисунок&nbsp;<span class="FigureRef">128</span></a> показывает полный ответ. Поскольку изменение ограничивается
определениями данных для <a href="#%28tech._xitem..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v2</span></a>, неудивительно, что изменение программы визуализации
отображается на функции для визуализации элементов. В то время как 
<span class="RktSym">render-item1</span> не должен различать разные формы 
<a href="#%28tech._xitem..v1%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v1</span></a>, <span class="RktSym">render-item</span> вынужден
использовать <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span>, потому что <a href="#%28tech._xitem..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v2</span></a> перечисляет 
два разных типа элементов. Учитывая, что это определение данных близко к определению из 
реального мира, отличительной характеристикой является не что-то простое, например 
<span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span> vs
 <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span>, а 
конкретная часть данного элемента. Если содержимым элемента является 
<a href="part_two.html#%28tech._word%29" class="techoutside" data-pltdoc="x"><span class="techinside">Word</span></a>, функция рендеринга продолжается, как и раньше. 
В противном случае элемент содержит перечисление, и в этом случае 
<span class="RktSym">render-item</span> использует  <span class="RktSym">render-enum</span>
для работы с данными, потому что определение данных для 
<a href="#%28tech._xitem..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v2</span></a> ссылается обратно на
 <a href="#%28tech._xenum..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XEnum.v2</span></a> именно в этот момент. 
<a name="(idx._(gentag._537))"></a></p>

<p><a name="(counter._(exercise._ex~3aenum2-test))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;373.  На  <a href="#%28counter._%28figure._fig~3aenum%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">128</span></a> отсутствуют тестовые примеры.
Разработайте тестовые примеры для всех функций.
 <a href="#%28counter._%28exercise._ex~3aenum2-test%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(idx._(gentag._538))"></a> <a name="(idx._(gentag._539))"></a></p>

<p><a name="(counter._(exercise._ex~3aenum2-design))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;374. Определения данных на 
 <a href="#%28counter._%28figure._fig~3axenum%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">127</span></a> используют <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span>.
Перепишите их, чтобы они использовали <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span>. 
Затем используйте рецепт для разработки функций рендеринга для <a href="#%28tech._xenum..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XEnum.v2</span></a> и
<a href="#%28tech._xitem..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XItem.v2</span></a> с нуля. Вы должны прийти к тем же определениям, 
что и на  <a href="#%28counter._%28figure._fig~3aenum%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">128</span></a>. 
<a href="#%28counter._%28exercise._ex~3aenum2-design%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p></p>

<div class="SIntrapara"><a name="(counter._(exercise._ex~3aenum-refactor))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;375. Обертывание <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> с помощью
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._beside%2Falign%29%29" class="RktValLink" data-pltdoc="x">beside/align</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">center</span><span class="hspace">&nbsp;</span><span class="RktSym">BT</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara"> может вас удивить. Измените определение функции 
так, чтобы переход появлялся один раз в каждом предложении. Почему вы уверены, что ваше 
изменение работает? Какую версию вы предпочитаете?
 <a href="#%28counter._%28exercise._ex~3aenum-refactor%29%29" class="ex-end" data-pltdoc="x"></a></div>

<p></p>

<p><a name="(counter._(exercise._ex~3aenum-count))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;376. Разработайте программу, которая считает все <span class="RktVal">"hello"</span>
в экземпляре  <a href="#%28tech._xenum..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XEnum.v2</span></a>. 
<a href="#%28counter._%28exercise._ex~3aenum-count%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3aenum-subst))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;377. Разработайте программу, которая заменяет все <span class="RktVal">"hello"</span> 
на <span class="RktVal">"bye"</span> в перечислении.  
<a href="#%28counter._%28exercise._ex~3aenum-subst%29%29" class="ex-end" data-pltdoc="x"></a></p>

<h4>22.3<tt>&nbsp;</tt><a name="(part._sec~3aconfig)"></a>Предметно-ориентированные языки(языки специфичные для предметной области, сленг) - Domain-Specific Languages(DSL)</h4>

<p>Инженеры обычно создают большие программные системы, которые требуют 
настройки для специфичных контекстов перед запуском. Эта задача настройки 
обычно выпадает на долю <span style="font-style: italic">системных администраторов</span>, 
которым приходится иметь дело с множеством различных программных систем. 
Слово “configuration”(конфигурация) относится к данным, которые необходимы 
основной функции при запуске программы. В некотором смысле конфигурация - 
это просто дополнительный аргумент, хотя обычно она настолько сложна, что 
разработчики программ предпочитают другой механизм для ее передачи. </p>

<p>Поскольку инженеры-программисты не могут предполагать, что системные администраторы 
знают все языки программирования, они склонны разрабатывать простые специализированные 
языки конфигурации. Эти специальные языки также известны как предметно-ориентированные 
языки(<span style="font-style: italic">domain-specific languages</span> - DSL).
<span class="refelem"><span class="refcolumn"><span class="refcontent">
Поскольку конфигурации абстрагируют программу над различными частями данных, Пол Худак 
утверждал в 1990-х годах, что DSL являются <span style="font-weight: bold">окончательной абстракцией</span>, то есть что они до совершенства обобщают идеи 
<a href="part_three.html" data-pltdoc="x">Абстракции</a>.
</span></span></span>  
Разработка этих DSL на основе общего ядра, скажем, хорошо известного синтаксиса XML, 
упрощает жизнь системным администраторам. Они могут писать небольшие XML-«программы» 
и таким образом настраивать системы, которые они должны запускать. </p>

<p>Хотя создание DSL часто считается задачей для опытного программиста, на самом деле 
вы уже в состоянии понять, оценить и реализовать достаточно сложный DSL. В этом разделе
объясняется, как все это работает. Сначала он заново знакомит вас с конечными автоматами (FSM).
Затем показано, как спроектировать, реализовать и запрограммировать DSL для настройки системы,
моделирующей произвольные конечные автоматы.</p>

<p>Вспомним о конечных автоматах(<span style="font-weight: bold">Finite State Machines</span>) 
Тема конечных автоматов - важная тема в вычислениях, и в этой книге она была представлена 
несколько раз. Здесь мы повторно используем пример из  <a href="part_two.html#%28part._sec~3asec-fsm-list%29" data-pltdoc="x">конечных автоматов(Finite State Machines)</a> в качестве 
компонента, для которого мы хотим спроектировать и реализовать конфигурационный DSL. 
</p>

<blockquote class="Figure"><a name="(counter._(figure._fig~3afsm-again))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><span style="font-style: italic">FSM</span><span class="RktCmt"> is a [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="#%28tech._1transition%29" class="techoutside" data-pltdoc="x"><span class="techinside">1Transition</span></a><span class="RktCmt">]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._1transition)"></a><span style="font-style: italic">1Transition</span><span class="RktCmt"> is a list of two items:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="part_two.html#%28tech._fsm._state%29" class="techoutside" data-pltdoc="x"><span class="techinside">FSM-State</span></a><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="part_two.html#%28tech._fsm._state%29" class="techoutside" data-pltdoc="x"><span class="techinside">FSM-State</span></a><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><span style="font-style: italic">FSM-State</span><span class="RktCmt"> is a </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt"> that specifies a color</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">data examples </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fsm-traffic</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">"red"</span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">"green"</span><span class="hspace">&nbsp;</span><span class="RktVal">"yellow"</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">"yellow"</span><span class="hspace">&nbsp;</span><span class="RktVal">"red"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="part_two.html#%28tech._fsm%29" class="techoutside" data-pltdoc="x"><span class="techinside">FSM</span></a><span class="RktCmt"> </span><a href="part_two.html#%28tech._fsm._state%29" class="techoutside" data-pltdoc="x"><span class="techinside">FSM-State</span></a><span class="RktCmt"> -&gt; </span><a href="part_two.html#%28tech._fsm._state%29" class="techoutside" data-pltdoc="x"><span class="techinside">FSM-State</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">matches the keys pressed by a player with the given </span><a href="part_two.html#%28tech._fsm%29" class="techoutside" data-pltdoc="x"><span class="techinside">FSM</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simulate</span><span class="hspace">&nbsp;</span><span class="RktSym">state0</span><span class="hspace">&nbsp;</span><span class="RktSym">transitions</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._big-bang%29%29" class="RktStxLink" data-pltdoc="x">big-bang</a></span><span class="hspace">&nbsp;</span><span class="RktSym">state0</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="part_two.html#%28tech._fsm._state%29" class="techoutside" data-pltdoc="x"><span class="techinside">FSM-State</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._to-draw%29%29" class="RktStxLink" data-pltdoc="x">to-draw</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">current</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._square%29%29" class="RktValLink" data-pltdoc="x">square</a></span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="hspace">&nbsp;</span><span class="RktVal">"solid"</span><span class="hspace">&nbsp;</span><span class="RktSym">current</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._on-key%29%29" class="RktStxLink" data-pltdoc="x">on-key</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">current</span><span class="hspace">&nbsp;</span><span class="RktSym">key-event</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">find</span><span class="hspace">&nbsp;</span><span class="RktSym">transitions</span><span class="hspace">&nbsp;</span><span class="RktSym">current</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[X Y] [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> [</span><a href="part_three.html#%28tech._sim-dd._list%29" class="techoutside" data-pltdoc="x"><span class="techinside">List</span></a><span class="RktCmt"> </span><span class="RktCmt">X</span><span class="RktCmt"> </span><span class="RktCmt">Y</span><span class="RktCmt">]] X -&gt; Y</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">finds the matching Y for the given X in </span><span class="RktSym">alist</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">find</span><span class="hspace">&nbsp;</span><span class="RktSym">alist</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fm</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._assoc%29%29" class="RktValLink" data-pltdoc="x">assoc</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">alist</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fm</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._second%29%29" class="RktValLink" data-pltdoc="x">second</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fm</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"not found"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;129: </span>Возвращение к конечным машинам </span></p>

</blockquote>

<p>Для удобства на  <a href="#%28counter._%28figure._fig~3afsm-again%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">129</span></a> снова представлен весь код, 
хотя он был переформулирован с использованием только списков и всей мощи ISL+. 
Программа состоит из двух определений данных, одного примера данных и двух 
определений функций: <span class="RktSym">simulate</span>(моделирование) и 
<span class="RktSym">find</span>(поиск). В отличие от связанных программ в предыдущих 
главах, эта представляет переход в виде списка из двух элементов: текущего состояния и 
следующего.
<a name="(idx._(gentag._540))"></a> <a name="(idx._(gentag._541))"></a></p>

<p>Основная функция <span class="RktSym">simulate</span> использует таблицу переходов 
и начальное состояние; Затем она вычисляет выражение <span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._big-bang%29%29" class="RktStxLink" data-pltdoc="x">big-bang</a></span>, которое реагирует на каждое 
клавиатурное событие переходом состояния. Состояния отображаются в виде цветных квадратов.
Предложения <span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._to-draw%29%29" class="RktStxLink" data-pltdoc="x">to-draw</a></span> и
<span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._on-key%29%29" class="RktStxLink" data-pltdoc="x">on-key</a></span> указываются с помощью 
<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span>-выражений, которые используют текущее
состояние плюс фактическое клавиатурное событие и создают изображение или следующее 
состояние, соответственно. </p>

<p>Как видно из её сигнатуры, вспомогательная функция <span class="RktSym">find</span> 
полностью независима от применения конечного автомата. Она использует список из двух элемнтов
и элемент, но фактический характер элементов указывается с помощью параметров. В контексте 
этой программы <span class="RktCmt">X</span> и <span class="RktCmt">Y</span> представляют 
<a href="part_two.html#%28tech._fsm._state%29" class="techoutside" data-pltdoc="x"><span class="techinside">FSM-State(состояния конченого автомата)</span></a>, что означает, что 
<span class="RktSym">find</span> использует таблицу переходов вместе с состоянием и создает
состояние. В теле функции для выполнения большей части работы используется встроенная функция
<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._assoc%29%29" class="RktValLink" data-pltdoc="x">assoc</a></span>. Посмотрите
документацию для <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._assoc%29%29" class="RktValLink" data-pltdoc="x">assoc</a></span>, чтобы понять,
почему в теле <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span> используется выражение 
<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span>.</p>

<p><a name="(counter._(exercise._ex~3afsm-reacquaint1))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;378. Измените функцию рендеринга так, чтобы она накладывала название состояния на цветной квадрат.
<a href="#%28counter._%28exercise._ex~3afsm-reacquaint1%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3afsm-reacquaint2))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;379. Сформулируйте тестовые примеры для поиска - <span class="RktSym">find</span>. <a href="#%28counter._%28exercise._ex~3afsm-reacquaint2%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3afsm-reacquaint3))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;380.Измените определение данных для <a href="#%28tech._1transition%29" class="techoutside" data-pltdoc="x"><span class="techinside">1Transition</span></a>, чтобы 
можно было ограничить переходы определенными нажатиями клавиш. Попробуйте сформулировать 
изменение так, чтобы <span class="RktSym">find</span> продолжала работать без изменений. 
Что еще нужно изменить, чтобы вся программа работала? Какая часть рецепта разработки дает 
ответ(ы)? См. Исходное задание упражнения в 
<a href="part_two.html#%28counter._%28exercise._ex~3afsm-design3%29%29" data-pltdoc="x">упражнении&nbsp;229</a>. 
<a href="#%28counter._%28exercise._ex~3afsm-reacquaint3%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><span style="font-weight: bold"> Конфигурации</span> Функция моделирования конечного 
автомата использует два аргумента, которые совместно описывают машину. Вместо того, 
чтобы учить потенциального “customer”(пользователя) открывать программу ISL+ в DrRacket и 
запускать функцию двух аргументов, “seller”(поставщика) и <span class="RktSym">simulate</span>(моделирования) можно пожелать дополнить этот продукт компонентом конфигурации. </p>

<p></p>

<div class="SIntrapara">Компонент конфигурации состоит из двух частей. Первый - это широко
используемый простой язык, который клиенты используют для формулирования исходных аргументов 
для основной функции (функций) компонента. Вторая - это функция, которая переводит то, 
что говорят клиенты, в вызов функции для основной функции. Что касается симулятора конечного
автомата, мы должны договориться о том, как мы представляем конечные автоматы в XML. 
При разумном планировании <a href="#%28part._sec~3axml%29" data-pltdoc="x">XML в виде S-выражений</a> представляет серию примеров машин, которые идеально подходят для данной задачи.
Вспомните последний пример <span class="stt">machine</span>(машины) в этом разделе: 
</div><div class="SIntrapara"><blockquote><table class="SVerbatim" cellspacing="0" cellpadding="0"><tbody><tr><td>

<p><span class="stt">&lt;machine initial="red"&gt;</span></p>

</td></tr><tr><td>

<p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;action state="red"</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">next="green" /&gt;</span></p>

</td></tr><tr><td>

<p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;action state="green"</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">next="yellow" /&gt;</span></p>

</td></tr><tr><td>

<p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;action state="yellow" next="red" /&gt;</span></p>

</td></tr><tr><td>

<p><span class="stt">&lt;/machine&gt;</span></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">Сравните это с таблицей
переходов  <span class="RktSym">fsm-traffic</span> из   
<a href="#%28counter._%28figure._fig~3afsm-again%29%29" data-pltdoc="x">рисунка&nbsp;<span class="FigureRef">129</span></a>. Также вспомните согласованное представление 
<a href="#%28tech._xexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr</span></a> этого примера: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">xm0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">machine</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">initial</span><span class="hspace">&nbsp;</span><span class="RktVal">"red"</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">action</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">state</span><span class="hspace">&nbsp;</span><span class="RktVal">"red"</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">next</span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">action</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">state</span><span class="hspace">&nbsp;</span><span class="RktVal">"green"</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">next</span><span class="hspace">&nbsp;</span><span class="RktVal">"yellow"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">action</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">state</span><span class="hspace">&nbsp;</span><span class="RktVal">"yellow"</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">next</span><span class="hspace">&nbsp;</span><span class="RktVal">"red"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Чего нам все еще не хватает, так это общего определения данных, 
которое описывает все возможные представления <a href="part_two.html#%28tech._fsm%29" class="techoutside" data-pltdoc="x"><span class="techinside">FSM</span></a>
(конечных автоматов) <a href="#%28tech._xexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr</span></a>: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._xmachine)"></a><span style="font-style: italic">XMachine</span><span class="RktCmt"> is a nested list of this shape:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">machine</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">initial</span><span class="stt"> </span><span class="RktRdr">,</span><a href="part_two.html#%28tech._fsm._state%29" class="techoutside" data-pltdoc="x"><span class="techinside">FSM-State</span></a><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="stt"> </span><a href="#%28tech._x1t%29" class="techoutside" data-pltdoc="x"><span class="techinside">X1T</span></a><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._x1t)"></a><span style="font-style: italic">X1T</span><span class="RktCmt"> is a nested list of this shape:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">action</span><span class="stt"> </span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">state</span><span class="stt"> </span><span class="RktRdr">,</span><a href="part_two.html#%28tech._fsm._state%29" class="techoutside" data-pltdoc="x"><span class="techinside">FSM-State</span></a><span class="RktVal">)</span><span class="stt"> </span><span class="RktVal">(</span><span class="RktVal">next</span><span class="stt"> </span><span class="RktRdr">,</span><a href="part_two.html#%28tech._fsm._state%29" class="techoutside" data-pltdoc="x"><span class="techinside">FSM-State</span></a><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Как и <a href="#%28tech._xenum..v2%29" class="techoutside" data-pltdoc="x"><span class="techinside">XEnum.v2</span></a>, <a href="#%28tech._xmachine%29" class="techoutside" data-pltdoc="x"><span class="techinside">XMachine</span></a> описывает подмножество всех 
<a href="#%28tech._xexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr</span></a>. Таким образом, когда мы разрабатываем функции, которые обрабатывают эту новую 
форму данных, мы можем продолжать использовать обобщенные функции 
<a href="#%28tech._xexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr</span></a> для доступа к частям.</div>

<p></p>

<p><a name="(counter._(exercise._ex~3axmachine-data0))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;381. В определениях <a href="#%28tech._xmachine%29" class="techoutside" data-pltdoc="x"><span class="techinside">XMachine</span></a> и
<a href="#%28tech._x1t%29" class="techoutside" data-pltdoc="x"><span class="techinside">X1T</span></a> используется цитата(quote), что крайне не подходит для начинающих разработчиков программ. Перепишите их сначала, чтобы использовать <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span>, а затем - <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span>. 
<a href="#%28counter._%28exercise._ex~3axmachine-data0%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3axmachine-data1))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;382. Сформулируйте конфигурацию XML для машины BW, 
которая переключается с белого на черный и обратно для каждого клавиатурного события. 
Преобразуйте конфигурацию XML в представление <a href="#%28tech._xmachine%29" class="techoutside" data-pltdoc="x"><span class="techinside">XMachine</span></a>. См.  
<a href="part_two.html#%28counter._%28exercise._ex~3afsm-design2%29%29" data-pltdoc="x">Упражнение&nbsp;227</a> для реализации машины как программы. <a href="#%28counter._%28exercise._ex~3axmachine-data1%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p></p>

<div class="SIntrapara">Прежде чем мы углубимся в проблему конфигурации, связанную с
преобразованием, давайте поясним ее:
  </div><div class="SIntrapara"><blockquote>

<p><span style="font-weight: bold"> Пример проблемы</span> Создайте программу, которая 
использует конфигурацию <a href="#%28tech._xmachine%29" class="techoutside" data-pltdoc="x"><span class="techinside">XMachine</span></a> для запуска 
<span class="RktSym">simulate</span>(моделирования).</p>

</blockquote></div><div class="SIntrapara">Хотя эта проблема специфична для нашего случая, 
легко представить обобщение для подобных систем, и мы рекомендуем вам это сделать.</div>

<p></p>

<p></p>

<div class="SIntrapara">Постановка задачи предлагает полную схему:  
<a name="(idx._(gentag._542))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._xmachine%29" class="techoutside" data-pltdoc="x"><span class="techinside">XMachine</span></a><span class="RktCmt"> -&gt; </span><a href="part_two.html#%28tech._fsm._state%29" class="techoutside" data-pltdoc="x"><span class="techinside">FSM-State</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">simulates an FSM via the given configuration </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simulate-xmachine</span><span class="hspace">&nbsp;</span><span class="RktSym">xm</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simulate</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Следуя формулировке проблемы(постановке задачи),  наши функции  
<span class="RktSym">simulate</span> вызываются с двумя аргументами, которые необходимо
определить. Для завершения определения нам нужны две части: начальное состояние и 
таблица переходов. Эти две части являются частью <span class="RktSym">xm</span>, и мы 
желаем им соответствующих функций: 
</div><div class="SIntrapara"><ul><li>

<p></p>

<div class="SIntrapara"><span class="RktSym">xm-state0</span> извлекает начальное состояние 
из заданного 
<a href="#%28tech._xmachine%29" class="techoutside" data-pltdoc="x"><span class="techinside">XMachine</span></a>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xm-state0</span><span class="hspace">&nbsp;</span><span class="RktSym">xm0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"red"</span><span class="RktPn">)</span></p>

</blockquote></div>

<p></p>

</li><li>

<p></p>

<div class="SIntrapara"><span class="RktSym">xm-&gt;transitions</span> переводит встроенный список
<a href="#%28tech._x1t%29" class="techoutside" data-pltdoc="x"><span class="techinside">X1T</span></a> в список  <a href="#%28tech._1transition%29" class="techoutside" data-pltdoc="x"><span class="techinside">1Transition</span></a>s:
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xm-&gt;transitions</span><span class="hspace">&nbsp;</span><span class="RktSym">xm0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">fsm-traffic</span><span class="RktPn">)</span></p>

</blockquote></div>

<p></p>

</li></ul></div>

<p></p>

<p></p>

<div class="SIntrapara"><a name="(idx._(gentag._543))"></a>
<a name="(idx._(gentag._544))"></a>
<a name="(idx._(gentag._545))"></a>
</div><div class="SIntrapara"><blockquote class="Figure"><a name="(counter._(figure._fig~3adsl))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._xmachine%29" class="techoutside" data-pltdoc="x"><span class="techinside">XMachine</span></a><span class="RktCmt"> -&gt; </span><a href="part_two.html#%28tech._fsm._state%29" class="techoutside" data-pltdoc="x"><span class="techinside">FSM-State</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">interprets the given configuration as a state machine </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simulate-xmachine</span><span class="hspace">&nbsp;</span><span class="RktSym">xm</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simulate</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xm-state0</span><span class="hspace">&nbsp;</span><span class="RktSym">xm</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xm-&gt;transitions</span><span class="hspace">&nbsp;</span><span class="RktSym">xm</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._xmachine%29" class="techoutside" data-pltdoc="x"><span class="techinside">XMachine</span></a><span class="RktCmt"> -&gt; </span><a href="part_two.html#%28tech._fsm._state%29" class="techoutside" data-pltdoc="x"><span class="techinside">FSM-State</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">extracts and translates the transition table from </span><span class="RktSym">xm0</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xm-state0</span><span class="hspace">&nbsp;</span><span class="RktSym">xm0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"red"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xm-state0</span><span class="hspace">&nbsp;</span><span class="RktSym">xm0</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">find-attr</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-attr</span><span class="hspace">&nbsp;</span><span class="RktSym">xm0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">initial</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._xmachine%29" class="techoutside" data-pltdoc="x"><span class="techinside">XMachine</span></a><span class="RktCmt"> -&gt; [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="#%28tech._1transition%29" class="techoutside" data-pltdoc="x"><span class="techinside">1Transition</span></a><span class="RktCmt">]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">extracts the transition table from </span><span class="RktSym">xm</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xm-&gt;transitions</span><span class="hspace">&nbsp;</span><span class="RktSym">xm0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">fsm-traffic</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xm-&gt;transitions</span><span class="hspace">&nbsp;</span><span class="RktSym">xm</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._x1t%29" class="techoutside" data-pltdoc="x"><span class="techinside">X1T</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._1transition%29" class="techoutside" data-pltdoc="x"><span class="techinside">1Transition</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xaction-&gt;action</span><span class="hspace">&nbsp;</span><span class="RktSym">xa</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">find-attr</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-attr</span><span class="hspace">&nbsp;</span><span class="RktSym">xa</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">state</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">find-attr</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-attr</span><span class="hspace">&nbsp;</span><span class="RktSym">xa</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">next</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktSym">xaction-&gt;action</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-content</span><span class="hspace">&nbsp;</span><span class="RktSym">xm</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;130: </span> Интерпретация программы DSL </span></p>

</blockquote></div>

<p></p>

<p>Поскольку <a href="#%28tech._xmachine%29" class="techoutside" data-pltdoc="x"><span class="techinside">XMachine</span></a> является подмножеством <span class="RktSym">Xexpr</span>,
определение  <span class="RktSym">xm-state0</span> несложно. Учитывая, что начальное состояние
задано как атрибут, <span class="RktSym">xm-state0</span> извлекает список атрибутов с помощью
<span class="RktSym">xexpr-attr</span>, а затем извлекает  
<span class="RktVal">'</span><span class="RktVal">initial</span>(начальное) значение атрибута.</p>

<p></p>

<div class="SIntrapara">Затем обратимся к <span class="RktSym">xm-&gt;transitions</span>, 
которое переводит переходы внутри конфигурации <span class="RktSym">XMachine</span> в таблицу
переходов:  
<a name="(idx._(gentag._546))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._xmachine%29" class="techoutside" data-pltdoc="x"><span class="techinside">XMachine</span></a><span class="RktCmt"> -&gt; [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="#%28tech._1transition%29" class="techoutside" data-pltdoc="x"><span class="techinside">1Transition</span></a><span class="RktCmt">]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">extracts &amp; translates the transition table from </span><span class="RktSym">xm</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xm-&gt;transitions</span><span class="hspace">&nbsp;</span><span class="RktSym">xm</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Имя функции предписывает сигнатура и предлагает предназначение. В нашем предназначении
описывается двухэтапный процесс: (1) извлечь представление <span class="RktSym">Xexpr</span> 
для переходов и (2) преобразовать их в экземпляр [<a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a> <a href="#%28tech._1transition%29" class="techoutside" data-pltdoc="x"><span class="techinside">1Transition</span></a>].</div>

<p></p>

<p></p>

<div class="SIntrapara">Хотя часть извлечения явно использует 
<span class="RktSym">xexpr-content</span> для получения списка, часть преобразования требует
дополнительного анализа. Если вы посмотрите на определение данных <a href="#%28tech._xmachine%29" class="techoutside" data-pltdoc="x"><span class="techinside">XMachine</span></a>, вы увидите, 
что содержимое <a href="#%28tech._xexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr</span></a> представляет собой список <a href="#%28tech._x1t%29" class="techoutside" data-pltdoc="x"><span class="techinside">X1T</span></a>. 
Сигнатура сообщает нам, что таблица переходов представляет собой список <a href="#%28tech._1transition%29" class="techoutside" data-pltdoc="x"><span class="techinside">1Transition</span></a>. Действительно, совершенно очевидно, 
что каждый элемент в первом списке переводится в один элемент во втором, что предполагает
использование  <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span>: 
<a name="(idx._(gentag._547))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xm-&gt;transitions</span><span class="hspace">&nbsp;</span><span class="RktSym">xm</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._x1t%29" class="techoutside" data-pltdoc="x"><span class="techinside">X1T</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._1transition%29" class="techoutside" data-pltdoc="x"><span class="techinside">1Transition</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xaction-&gt;action</span><span class="hspace">&nbsp;</span><span class="RktSym">xa</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktSym">xaction-&gt;action</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">xexpr-content</span><span class="hspace">&nbsp;</span><span class="RktSym">xm</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Как видите, мы следуем идеям разработки из раздела <a href="part_three.html#%28part._sec~3ausage-examples%29" data-pltdoc="x">Использование абстракций на примерах</a> и формулируем функцию 
как <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span>, тело которой использует 
<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span>. Определение 
<span class="RktSym">xaction-&gt;action</span> опять же просто вопрос извлечения 
соответствующих значений из <a href="#%28tech._xexpr%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr</span></a>.</div>

<p></p>

<p>На  <a href="#%28counter._%28figure._fig~3adsl%29%29" data-pltdoc="x">Рис.&nbsp;<span class="FigureRef">130</span></a> показано полное решение. Здесь перевод из DSL в правильный 
вызов функции равен исходному компоненту. Это не относится к системам реального мира; 
компонент DSL, как правило, составляет небольшую часть всего продукта, поэтому этот 
подход так популярен.</p>

<p><a name="(counter._(exercise._ex~3axmachine-data2))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;383. Запустите код на 
<a href="#%28counter._%28figure._fig~3adsl%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">130</span></a> с конфигурацией BW Machine из  
<a href="#%28counter._%28exercise._ex~3axmachine-data1%29%29" data-pltdoc="x">упражнения&nbsp;382</a>. 
<a href="#%28counter._%28exercise._ex~3axmachine-data2%29%29" class="ex-end" data-pltdoc="x"></a></p>

<blockquote class="Herefigure"><blockquote class="Leftfigure"><blockquote class="FigureInside"><blockquote class="SubFlow"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">machine-configuration.xml</span></span></p>

<blockquote class="Rfilecontent"><table class="SVerbatim" cellspacing="0" cellpadding="0"><tbody><tr><td>

<p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;machine initial="red"&gt;</span></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">&lt;action state="red"</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">next="green" /&gt;</span></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">&lt;action state="green"</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">next="yellow" /&gt;</span></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">&lt;action state="yellow" next="red" /&gt;</span></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;/machine&gt;</span></p>

</td></tr><tr><td>

<p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p>

</td></tr></tbody></table></blockquote></blockquote></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3amachine-configuration..xml))" x-target-lift="Figure"></a>Рисунок&nbsp;131: </span>Файл с конфигурацией машины</span></p>

</blockquote><h4>22.4<tt>&nbsp;</tt><a name="(part._sub~3areading-xml)"></a>Чтение XML</h4>

<p></p>

<div class="SIntrapara">Системные администраторы ожидают, что сложные приложения читают 
программы конфигурации
<span class="refelem"><span class="refcolumn"><span class="refcontent">
В этом разделе используются библиотеки
<span class="sroman"><span class="Smaller"><span style="font-style: italic">2htdp/batch-io</span></span></span>
<span class="sroman"><span class="Smaller"><span style="font-style: italic">2htdp/universe</span></span></span>, и
<span class="sroman"><span class="Smaller"><span style="font-style: italic">2htdp/image</span></span></span>.</span></span></span> 
из файла или, возможно, из какого-то места в сети web. В ISL+ ваши программы могут извлекать
(некоторую) информацию XML. На  <a href="#%28counter._%28figure._fig~3axexpr-tp%29%29" data-pltdoc="x">Рис.&nbsp;<span class="FigureRef">132</span></a> показан соответствующий отрывок 
из обучающего пакета. Для согласованности на рисунке используется суффикс 
<span class="stt">.v3</span> для своего XML-представления, включая те определения данных, 
для которых нет версии 2:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._xexpr..v3)"></a><span style="font-style: italic">Xexpr.v3</span><span class="RktCmt"> is one of:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt"> </span><span class="RktCmt">–</span><span class="RktCmt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt"> </span><span class="RktCmt">–</span><span class="RktCmt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt"> </span><span class="RktCmt">–</span><span class="RktCmt"> </span><a href="part_one.html#%28tech._number%29" class="techoutside" data-pltdoc="x"><span class="techinside">Number</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt"> </span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="#%28tech._attribute%2A..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Attribute*.v3</span></a><span class="stt"> </span><span class="RktPn">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="stt"> </span><a href="#%28tech._xexpr..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v3</span></a><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt"> </span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="stt"> </span><span class="RktPn">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="stt"> </span><a href="#%28tech._xexpr..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v3</span></a><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._attribute*..v3)"></a><span style="font-style: italic">Attribute*.v3</span><span class="RktCmt"> is a [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="#%28tech._attribute..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Attribute.v3</span></a><span class="RktCmt">].</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._attribute..v3)"></a><span style="font-style: italic">Attribute.v3</span><span class="RktCmt"> is a list of two items:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="stt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara"><a name="(idx._(gentag._548))"></a>
<a name="(idx._(gentag._549))"></a>
<a name="(idx._(gentag._550))"></a>
<a name="(idx._(gentag._551))"></a>
<a name="(idx._(gentag._552))"></a>
</div><div class="SIntrapara"><blockquote class="Figure"><a name="(counter._(figure._fig~3axexpr-tp))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="part_one.html#%28tech._any%29" class="techoutside" data-pltdoc="x"><span class="techinside">Any</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">is </span><span class="RktSym">x</span><span class="RktCmt"> an </span><a href="#%28tech._xexpr..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v3</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span style="font-weight: bold">effect</span><span class="RktCmt"> displays bad piece if </span><span class="RktSym">x</span><span class="RktCmt"> is not an </span><a href="#%28tech._xexpr..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v3</span></a></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._xexpr~3f%29%29" class="RktValLink" data-pltdoc="x">xexpr?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._xexpr..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v3</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">produces the first XML element in file </span><span class="RktSym">f</span><span class="RktCmt"> </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-xexpr%29%29" class="RktValLink" data-pltdoc="x">read-xexpr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktVal">#false</span><span class="RktCmt">, if this url returns a </span><span class="RktCmt">'</span><span class="RktCmt">404</span><span class="RktCmt">'</span><span class="RktCmt">; </span><span class="RktVal">#true</span><span class="RktCmt"> otherwise</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._url-exists~3f%29%29" class="RktValLink" data-pltdoc="x">url-exists?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">u</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt"> -&gt; [</span><a href="part_three.html#%28tech._sim-dd._maybe%29" class="techoutside" data-pltdoc="x"><span class="techinside">Maybe</span></a><span class="RktCmt"> </span><a href="#%28tech._xexpr..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v3</span></a><span class="RktCmt">]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">retrieves the first XML (HTML) element from URL </span><span class="RktSym">u</span><span class="RktCmt"> </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktVal">#false</span><span class="RktCmt"> if </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._not%29%29" class="RktValLink" data-pltdoc="x">not</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._url-exists~3f%29%29" class="RktValLink" data-pltdoc="x">url-exists?</a></span><span class="stt"> </span><span class="RktSym">u</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-plain-xexpr%2Fweb%29%29" class="RktValLink" data-pltdoc="x">read-plain-xexpr/web</a></span><span class="hspace">&nbsp;</span><span class="RktSym">u</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt"> -&gt; [</span><a href="part_three.html#%28tech._sim-dd._maybe%29" class="techoutside" data-pltdoc="x"><span class="techinside">Maybe</span></a><span class="RktCmt"> </span><a href="#%28tech._xexpr..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v3</span></a><span class="RktCmt">]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">retrieves the first XML (HTML) element from URL </span><span class="RktSym">u</span><span class="RktCmt"> </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktVal">#false</span><span class="RktCmt"> if </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._not%29%29" class="RktValLink" data-pltdoc="x">not</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._url-exists~3f%29%29" class="RktValLink" data-pltdoc="x">url-exists?</a></span><span class="stt"> </span><span class="RktSym">u</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-xexpr%2Fweb%29%29" class="RktValLink" data-pltdoc="x">read-xexpr/web</a></span><span class="hspace">&nbsp;</span><span class="RktSym">u</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;132: </span>Чтение X-выражений</span></p>

</blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Предположим, у нас есть файл, показанный на 
<a href="#%28counter._%28figure._fig~3amachine-configuration..xml%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">131</span></a>. Если требуется библиотека 
<span class="sroman"> <span class="Smaller"><span style="font-style: italic">2htdp/batch-io</span></span> </span>, программа может прочитать элемент с помощью 
<span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-plain-xexpr%29%29" class="RktValLink" data-pltdoc="x">read-plain-xexpr</a></span>. Функция извлекает элемент XML в формате, 
который соответствует определению данных <a href="#%28tech._xmachine%29" class="techoutside" data-pltdoc="x"><span class="techinside">XMachine</span></a>. В обучающем пакете также доступна функция для извлечения XML-элементов из Интернета. Попробуйте это в DrRacket:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="stt">&gt;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-plain-xexpr%2Fweb%29%29" class="RktValLink" data-pltdoc="x">read-plain-xexpr/web</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string-append%29%29" class="RktValLink" data-pltdoc="x">string-append</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"Https://Felleisen.org/"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"matthias/"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"HtDP2e/Files/machine-configuration.xml"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Если ваш компьютер подключен к Интернету, это выражение возвращает нашу стандартную 
конфигурацию машины.
</div>

<p></p>

<p>Чтение файлов или веб-страниц вводит в нашу вычислительную модель совершенно новую идею. 
Как объясняет <a href="i1-2.html" data-pltdoc="x">Intermezzo 1: Beginning Student Language(Язык начинающих студентов</a>, программа BSL вычисляется так же, как вы вычисляете переменные 
выражений в алгебре. С определениями функций также обращаются так же, как в алгебре. 
Действительно, в большинстве курсов алгебры вводятся определения условных функций, 
то есть <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> также не вызывает никаких проблем. 
Наконец, хотя ISL+ вводит функции как значения, модель вычисления в основном остается 
той же.
</p>

<p></p>

<div class="SIntrapara">Одним из важных свойств этой вычислительной модели является то, 
что независимо от того, как часто вы вызываете функцию <span class="RktSym">f</span> 
для некоторого аргумента (аргументов)  <span class="RktSym">a</span><span class="stt"> </span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span>
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">ответ остается прежним. Однако введение 
<span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-file%29%29" class="RktValLink" data-pltdoc="x">read-file</a></span>,
<span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-xexpr%29%29" class="RktValLink" data-pltdoc="x">read-xexpr</a></span> и их родственников разрушает это свойство. 
Проблема в том, что файлы и веб-сайты могут изменяться со временем, поэтому каждый раз, 
когда программа читает файлы или веб-сайты, она может получать новый результат.</div>

<p></p>

<p>Рассмотрим идею поиска стоимости акций компании. Укажите в браузере 
 <span class="stt">google.com/finance</span> или любой другой финансовый веб-сайт и 
введите название своей любимой компании, например <span class="stt">Ford</span>. 
В ответ сайт отобразит текущую цену акций компании и другую информацию, например, 
насколько изменилась цена с момента последней публикации, текущее время и многие 
другие факты и объявления. Важным моментом является то, что при перезагрузке этой 
страницы в течение дня или недели часть информации на этой веб-странице изменится. </p>

<p></p>

<div class="SIntrapara">Альтернативой поиску такой информации о компании вручную 
является написание небольшой программы, которая извлекает такую информацию на 
регулярной основе, скажем, каждые 15 секунд. С помощью ISL вы можете написать 
программный мир(программу), который выполняет эту задачу. 
Вы бы запустили его так: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">stock-alert</span><span class="hspace">&nbsp;</span><span class="RktVal">"Ford"</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
чтобы увидеть окно мира, в котором отображается изображение, подобное приведенному ниже: 
</div><div class="SIntrapara"><blockquote class="SCentered">

<p><img style="vertical-align: -0.0px; margin: -3px -3px -3px -3px;" src="part_four_files/pict_147.png" alt="image" width="316.0" height="51.0"></p>

</blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Для разработки такой программы требуются навыки, 
выходящие за рамки обычного проектирования программы. Во-первых, вам нужно изучить, 
как веб-сайт форматирует свою информацию. В случае страницы финансовых услуг Google 
проверку исходного веб-кода показывает следующий шаблон вверху: 
</div><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0"><tbody><tr><td>

<p><span class="Smaller"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;meta content="17.09" itemprop="price" /&gt;</span></span></p>

</td></tr><tr><td>

<p><span class="Smaller"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;meta content="+0.07" itemprop="priceChange" /&gt;</span></span></p>

</td></tr><tr><td>

<p><span class="Smaller"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;meta content="0.41" itemprop="priceChangePercent" /&gt;</span></span></p>

</td></tr><tr><td>

<p><span class="Smaller"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;meta content="2013-08-12T16:59:06Z" itemprop="quoteTime" /&gt;</span></span></p>

</td></tr><tr><td>

<p><span class="Smaller"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;meta content="NYSE real-time data" itemprop="dataSource" /&gt;</span></span></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Если бы у нас была функция, которая могла бы искать в <a href="#%28tech._xexpr..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v3</span></a> и 
извлекать (представление XML) <span class="stt">meta</span>(мета)-элементы со значениями 
атрибута <span class="RktVal">"price"</span> и <span class="RktVal">"priceChange"</span>, 
остальная часть <span class="RktSym">stock-alert</span> была бы простой. </div>

<p></p>

<p></p>

<div class="SIntrapara"><a name="(idx._(gentag._553))"></a>
</div><div class="SIntrapara"><blockquote class="Herefigure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PREFIX</span><span class="hspace">&nbsp;</span><span class="RktVal">"Https://www.google.com/finance?q="</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">SIZE</span><span class="hspace">&nbsp;</span><span class="RktVal">22</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">font size </span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">data</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">price</span><span class="hspace">&nbsp;</span><span class="RktSym">delta</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._stockworld)"></a><span style="font-style: italic">StockWorld</span><span class="RktCmt"> is a structure: </span><span class="RktPn">(</span><span class="RktSym">make-data</span><span class="stt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="stt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._stockworld%29" class="techoutside" data-pltdoc="x"><span class="techinside">StockWorld</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">retrieves the stock price of </span><span class="RktSym">co</span><span class="RktCmt"> and its change every 15s</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">stock-alert</span><span class="hspace">&nbsp;</span><span class="RktSym">co</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">url</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string-append%29%29" class="RktValLink" data-pltdoc="x">string-append</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PREFIX</span><span class="hspace">&nbsp;</span><span class="RktSym">co</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[</span><a href="#%28tech._stockworld%29" class="techoutside" data-pltdoc="x"><span class="techinside">StockWorld</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._stockworld%29" class="techoutside" data-pltdoc="x"><span class="techinside">StockWorld</span></a><span class="RktCmt">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">retrieve-stock-data</span><span class="hspace">&nbsp;</span><span class="RktVar">__w</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-xexpr%2Fweb%29%29" class="RktValLink" data-pltdoc="x">read-xexpr/web</a></span><span class="hspace">&nbsp;</span><span class="RktSym">url</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-data</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">get</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">"price"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">get</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">"priceChange"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._stockworld%29" class="techoutside" data-pltdoc="x"><span class="techinside">StockWorld</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._image%29" class="techoutside" data-pltdoc="x"><span class="techinside">Image</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">render-stock-data</span><span class="hspace">&nbsp;</span><span class="RktSym">w</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[</span><a href="#%28tech._stockworld%29" class="techoutside" data-pltdoc="x"><span class="techinside">StockWorld</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt">] -&gt; </span><a href="part_one.html#%28tech._image%29" class="techoutside" data-pltdoc="x"><span class="techinside">Image</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">word</span><span class="hspace">&nbsp;</span><span class="RktSym">sel</span><span class="hspace">&nbsp;</span><span class="RktSym">col</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._text%29%29" class="RktValLink" data-pltdoc="x">text</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">sel</span><span class="hspace">&nbsp;</span><span class="RktSym">w</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">SIZE</span><span class="hspace">&nbsp;</span><span class="RktSym">col</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._overlay%29%29" class="RktValLink" data-pltdoc="x">overlay</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._beside%29%29" class="RktValLink" data-pltdoc="x">beside</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">word</span><span class="hspace">&nbsp;</span><span class="RktSym">data-price</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">black</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._text%29%29" class="RktValLink" data-pltdoc="x">text</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">"</span><span class="hspace">&nbsp;</span><span class="RktSym">SIZE</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">white</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">word</span><span class="hspace">&nbsp;</span><span class="RktSym">data-delta</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">red</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._rectangle%29%29" class="RktValLink" data-pltdoc="x">rectangle</a></span><span class="hspace">&nbsp;</span><span class="RktVal">300</span><span class="hspace">&nbsp;</span><span class="RktVal">35</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">solid</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">white</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._big-bang%29%29" class="RktStxLink" data-pltdoc="x">big-bang</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">retrieve-stock-data</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">no-use</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._on-tick%29%29" class="RktStxLink" data-pltdoc="x">on-tick</a></span><span class="hspace">&nbsp;</span><span class="RktSym">retrieve-stock-data</span><span class="hspace">&nbsp;</span><span class="RktVal">15</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._to-draw%29%29" class="RktStxLink" data-pltdoc="x">to-draw</a></span><span class="hspace">&nbsp;</span><span class="RktSym">render-stock-data</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._(figure._fig~3areal-time))" x-target-lift="Figure"></a>Рисунок&nbsp;133: </span>Web (Интернет)-данные как событие</span></p>

</blockquote></div>

<p></p>

<p><span class="refelem"><span class="refcolumn"><span class="refcontent">Это упражнение 
больше невозможно выполнить, потому что веб-сервис больше не предоставляет 
котировки акций. </span></span></span></p>

<p> На  <a href="#%28counter._%28figure._fig~3areal-time%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">133</span></a> показано ядро программы. Разработка 
<span class="RktSym">get</span> оставлена в качестве упражнений, потому что её работа 
основана на взаимосвязанных данных.</p>

<p>Как показано на рисунке, основная функция определяет две локальные: обработчик 
тактовых импульсов часов(clock-tick) и функцию отрисовки(rendering). Спецификация 
<span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._big-bang%29%29" class="RktStxLink" data-pltdoc="x">big-bang</a></span> требует, чтобы часы тикали каждые 
15 секунд. Когда часы тикают, ISL+ применяет <span class="RktSym">retrieve-stock-data</span>
к текущему миру, которая это тик игнорирует. Вместо этого функция посещает веб-сайт через 
<span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-xexpr%2Fweb%29%29" class="RktValLink" data-pltdoc="x">read-xexpr/web</a></span> и извлекает соответствующую информацию с помощью 
<span class="RktSym">get</span>. Таким образом, новый мир создается из недавно доступной
информации в сети, а не из некоторых местных данных. </p>

<p><a name="(counter._(exercise._ex~3aweb-data0))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;384.  На  <a href="#%28counter._%28figure._fig~3areal-time%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">133</span></a> упоминается 
<span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-xexpr%2Fweb%29%29" class="RktValLink" data-pltdoc="x">read-xexpr/web</a></span>. См.  <a href="#%28counter._%28figure._fig~3axexpr-tp%29%29" data-pltdoc="x">Рисунок&nbsp;<span class="FigureRef">132</span></a> с её 
сигнатурой и предназначением, а затем прочтите документацию, чтобы определить разницу с 
её “plain”(простым) родственником.
</p>

<p>На <a href="#%28counter._%28figure._fig~3areal-time%29%29" data-pltdoc="x"> рис.&nbsp;<span class="FigureRef">133</span></a> также не хватает нескольких важных частей, в частности,
интерпретации <span class="RktSym">data</span>(данных) и предназначения для всех локально
определенных функций. Сформулируйте недостающие части, чтобы понять программу. 
 <a href="#%28counter._%28exercise._ex~3aweb-data0%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3aweb-data1))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;385. Посмотрите текущую цену акций вашей любимой компании на
странице финансовых услуг Google. Если у вас нет любимой компании, выберите Ford. Затем 
сохраните исходный код страницы в виде файла в вашем рабочем каталоге. Используйте 
<span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-xexpr%29%29" class="RktValLink" data-pltdoc="x">read-xexpr</a></span> в DrRacket, чтобы просмотреть источник как 
<a href="#%28tech._xexpr..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v3</span></a>. <a href="#%28counter._%28exercise._ex~3aweb-data1%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p></p>

<div class="SIntrapara"><a name="(counter._(exercise._ex~3aweb-data2))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;386. Вот функция <span class="RktSym">get</span>: 
<a name="(idx._(gentag._554))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._xexpr..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v3</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">retrieves the value of the </span><span class="RktVal">"content"</span><span class="RktMeta"></span><span class="RktCmt"> attribute </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">from a </span><span class="RktVal">'</span><span class="RktVal">meta</span><span class="RktCmt"> element that has attribute </span><span class="RktVal">"itemprop"</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">with value </span><span class="RktSym">s</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">get</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">meta</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">content</span><span class="hspace">&nbsp;</span><span class="RktVal">"+1"</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">itemprop</span><span class="hspace">&nbsp;</span><span class="RktVal">"F"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"F"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">"+1"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">get</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">result</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">get-xexpr</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">result</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">result</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"not found"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Предполагается, что существует функция <span class="RktSym">get-xexpr</span>, которая 
ищет в произвольном <a href="#%28tech._xexpr..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v3</span></a> требуемый атрибут и выдает 
 [<a href="part_three.html#%28tech._sim-dd._maybe%29" class="techoutside" data-pltdoc="x"><span class="techinside">Maybe</span></a> <a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a>].</div>

<p></p>

<p>Сформулируйте тестовые примеры, которые ищут значения, отличные от 
<span class="RktVal">"F"</span>, и эта принудительная <span class="RktSym">get</span>
сигнализирует об ошибке.
</p>

<p>Разработайте <span class="RktSym">get-xexpr</span>. Получите функциональные примеры для 
этой функции из примеров для <span class="RktSym">get</span>. Обобщите эти примеры, чтобы 
вы были уверены, что <span class="RktSym">get-xexpr</span> может пройти произвольный 
<a href="#%28tech._xexpr..v3%29" class="techoutside" data-pltdoc="x"><span class="techinside">Xexpr.v3</span></a>. Наконец, сформулируйте тест, который использует 
веб-данные, сохраненные в 
<a href="#%28counter._%28exercise._ex~3aweb-data1%29%29" data-pltdoc="x">упражнении&nbsp;385</a>. <a href="#%28counter._%28exercise._ex~3aweb-data2%29%29" class="ex-end" data-pltdoc="x"></a></p>

<h3>23<tt>&nbsp;</tt><a name="(part._ch~3asimu)"></a>Одновременная обработка</h3>

<p>Некоторые функции должны использовать два аргумента, принадлежащих классам с
 нетривиальными определениями данных. Как разработать такие функции, зависит от 
соотношения между аргументами. Во-первых, один из аргументов, возможно, придется 
рассматривать как атомарный. Во-вторых, возможно, что функция должна обрабатывать 
два аргумента синхронно. Наконец, функция может обрабатывать заданные данные во всех 
возможных случаях. Эта глава иллюстрирует три случая с примерами и предоставляет 
рассширенный рецепт проектирования. В последнем разделе обсуждается равенство 
составных данных. </p>

<h4>23.1<tt>&nbsp;</tt><a name="(part._sec~3atwo-inputs~3acase1)"></a>Одновременная обработка 
двух списков: случай 1</h4>

<p></p>

<div class="SIntrapara">Рассмотрим следующую сигнатуру, предназначение и заголовок:  
<a name="(idx._(gentag._555))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._number%29" class="techoutside" data-pltdoc="x"><span class="techinside">Number</span></a><span class="RktCmt">] [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._number%29" class="techoutside" data-pltdoc="x"><span class="techinside">Number</span></a><span class="RktCmt">] -&gt; [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._number%29" class="techoutside" data-pltdoc="x"><span class="techinside">Number</span></a><span class="RktCmt">]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">replaces the final </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktCmt"> in </span><span class="RktSym">front</span><span class="RktCmt"> with </span><span class="RktSym">end</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">replace-eol-with</span><span class="hspace">&nbsp;</span><span class="RktSym">front</span><span class="hspace">&nbsp;</span><span class="RktSym">end</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">front</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
В сигнатуре написано, что функция использует два списка. Посмотрим, как работает рецепт 
проектирования в этом случае.
</div>

<p></p>

<p></p>

<div class="SIntrapara">Начнем с работы с примерами. Если первый аргумент - 
<span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span>, 
<span class="RktSym">replace-eol-with</span> должна произвести второй аргумент, независимо 
от того, какой он: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">replace-eol-with</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">b</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">b</span><span class="RktVal">)</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">В отличие от этого, если первый аргумент 
не является <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span>, предназначение требует, чтобы мы заменили <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span> в конце с <span class="RktSym">front</span>
на <span class="RktSym">end</span>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">replace-eol-with</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">a</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">a</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">replace-eol-with</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">a</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">a</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Предназначение и примеры предполагают, что, пока второй аргумент 
является списком, функции не нужно ничего о нем знать. Подразумевается, что его шаблон 
должен быть шаблоном функции обработки списка относительно первого аргумента:  
<a name="(idx._(gentag._556))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">replace-eol-with</span><span class="hspace">&nbsp;</span><span class="RktSym">front</span><span class="hspace">&nbsp;</span><span class="RktSym">end</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">front</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">front</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">replace-eol-with</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">front</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">end</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Давайте заполним пробелы в шаблоне, следуя пятому шагу рецепта 
разработки. Если  <span class="RktSym">front</span> это <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span>, <span class="RktSym">replace-eol-with</span>
выдает <span class="RktSym">end</span>. Если <span class="RktSym">front</span> не 
<span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span>, 
мы должны вспомнить, что вычисляют выражения шаблона:
</div><div class="SIntrapara"><ul><li>

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="stt"> </span><span class="RktSym">front</span><span class="RktPn">)</span> вычисляет первый элемент в
списке, а
</p>

</li><li>

<p><span class="RktPn">(</span><span class="RktSym">replace-eol-with</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="stt"> </span><span class="RktSym">front</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">end</span><span class="RktPn">)</span> 
заменяет последний
<span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span> in <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="stt"> </span><span class="RktSym">front</span><span class="RktPn">)</span> на <span class="RktSym">end</span>.</p>

</li></ul></div><div class="SIntrapara">Стоп! Используйте <a name="(idx._(gentag._557))"></a>
табличный метод, чтобы понять, что означают эти маркеры в текущем примере.
</div>

<p></p>

<p></p>

<div class="SIntrapara">Отсюда небольшой шаг до полного определения: 
<a name="(idx._(gentag._558))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">replace-eol-with</span><span class="hspace">&nbsp;</span><span class="RktSym">front</span><span class="hspace">&nbsp;</span><span class="RktSym">end</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">front</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">end</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">front</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">replace-eol-with</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">front</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">end</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p><a name="(counter._(exercise._ex~3across))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;387. Разработайте <span class="RktSym">cross</span>. Функция использует список
символов и список чисел и производит все возможные упорядоченные пары символов и чисел. 
То есть, когда даны  <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">a</span><span class="stt"> </span><span class="RktVal">b</span><span class="stt"> </span><span class="RktVal">c</span><span class="RktVal">)</span> и <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="RktVal">)</span>, ожидаемый результат <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">a</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktVal">)</span><span class="stt"> </span><span class="RktVal">(</span><span class="RktVal">a</span><span class="stt"> </span><span class="RktVal">2</span><span class="RktVal">)</span><span class="stt"> </span><span class="RktVal">(</span><span class="RktVal">b</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktVal">)</span><span class="stt"> </span><span class="RktVal">(</span><span class="RktVal">b</span><span class="stt"> </span><span class="RktVal">2</span><span class="RktVal">)</span><span class="stt"> </span><span class="RktVal">(</span><span class="RktVal">c</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktVal">)</span><span class="stt"> </span><span class="RktVal">(</span><span class="RktVal">c</span><span class="stt"> </span><span class="RktVal">2</span><span class="RktVal">)</span><span class="RktVal">)</span>. 
<a href="#%28counter._%28exercise._ex~3across%29%29" class="ex-end" data-pltdoc="x"></a></p>

<h4>23.2<tt>&nbsp;</tt><a name="(part._sec~3atwo-inputs~3acase2)"></a>Одновременная обработка двух списков: случай 2</h4>

<p>Раздел <a href="part_two.html#%28part._sec~3alist-produce%29" data-pltdoc="x">Функции, которые производят списки</a>, представляет функцию <span class="RktSym">wages*</span>(заработной платы),
которая вычисляет недельную заработную плату некоторых рабочих с учетом их рабочих часов. 
Она использует список чисел, который представляет количество отработанных часов в неделю, 
и производит список чисел, которые представляют собой соответствующую недельную заработную 
плату. Хотя задача предполагает, что все сотрудники получали одинаковую ставку 
заработной платы, даже небольшая компания выплачивает своим работникам дифференцированную
заработную плату.</p>

<p></p>

<div class="SIntrapara">Здесь мы рассмотрим чуть более реалистичную версию. 
Теперь функция использует <span style="font-weight: bold">два</span> списка: 
список отработанных часов и список соответствующей почасовой оплаты труда. 
Мы переводим эту исправленную проблему в исправленный заголовок: 
<a name="(idx._(gentag._559))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._number%29" class="techoutside" data-pltdoc="x"><span class="techinside">Number</span></a><span class="RktCmt">] [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._number%29" class="techoutside" data-pltdoc="x"><span class="techinside">Number</span></a><span class="RktCmt">] -&gt; [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._number%29" class="techoutside" data-pltdoc="x"><span class="techinside">Number</span></a><span class="RktCmt">]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">multiplies the corresponding items on </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktSym">hours</span><span class="RktCmt"> and </span><span class="RktSym">wages/h</span><span class="RktCmt"> </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span style="font-weight: bold">assume</span><span class="RktCmt"> the two lists are of equal length </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">wages*.v2</span><span class="hspace">&nbsp;</span><span class="RktSym">hours</span><span class="hspace">&nbsp;</span><span class="RktSym">wages/h</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">Придумывать примеры просто:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">wages*.v2</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">wages*.v2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">5.65</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">40</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">226.0</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">wages*.v2</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">5.65</span><span class="hspace">&nbsp;</span><span class="RktVal">8.75</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">40.0</span><span class="hspace">&nbsp;</span><span class="RktVal">30.0</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">226.0</span><span class="hspace">&nbsp;</span><span class="RktVal">262.5</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">При необходимости во всех трех примерах используются списки одинаковой длины.
</div>

<p></p>

<p></p>

<div class="SIntrapara">Предположение, касающееся входных данных, также может быть 
использовано для разработки шаблона. Более конкретно, условие говорит, что 
<span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="stt"> </span><span class="RktSym">hours</span><span class="RktPn">)</span> истинно, когда <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="stt"> </span><span class="RktSym">wages/h</span><span class="RktPn">)</span> истинно, и,
более того, <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="stt"> </span><span class="RktSym">hours</span><span class="RktPn">)</span> истинно, когда <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="stt"> </span><span class="RktSym">wages/h</span><span class="RktPn">)</span> истинно. Таким образом, допустимо использовать шаблон 
для одного из двух списков: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">wages*.v2</span><span class="hspace">&nbsp;</span><span class="RktSym">hours</span><span class="hspace">&nbsp;</span><span class="RktSym">wages/h</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">hours</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">hours</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">wages/h</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">wages*.v2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">hours</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">wages/h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
В первом предложении <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> и <span class="RktSym">hours</span>(часы),
и <span class="RktSym">wages/h</span>(заработная плата/час) равны 
<span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span>.
Следовательно, никаких селекторных выражений не требуется. Во втором предложении и 
<span class="RktSym">hours</span>(часы), и <span class="RktSym">wages/h</span>
(заработная плата/час) являются <span class="RktSym">constructed</span>(составными) списками, 
что означает, что нам нужно четыре выражения селектора. Наконец, поскольку последние 
два списка равны по длине, они представляют собой естественного кандидата для 
естественной рекурсии <span class="RktSym">wages*.v2</span>.</div>

<p></p>

<p>Единственным необычным аспектом этого шаблона является то, что рекурсивное 
применение состоит из двух выражений, оба выражения селектора для двух аргументов. 
Но эта идея прямо следует из предположения.</p>

<p></p>

<div class="SIntrapara">Отсюда - короткий шаг до полного определения функции: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">wages*.v2</span><span class="hspace">&nbsp;</span><span class="RktSym">hours</span><span class="hspace">&nbsp;</span><span class="RktSym">wages/h</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">hours</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">weekly-wage</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">hours</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">wages/h</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">wages*.v2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">hours</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">wages/h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Первый пример подразумевает, что ответ на первое предложение <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> - <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span>. Во втором у нас есть три доступных 
значения:
</div><div class="SIntrapara"><ol><li>

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="stt"> </span><span class="RktSym">hours</span><span class="RktPn">)</span>, которое представляет собой 
первое количество часов в неделю;</p>

</li><li>

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="stt"> </span><span class="RktSym">wages/h</span><span class="RktPn">)</span>, которое является 
первой ставкой заработной платы; а также</p>

</li><li>

<p><span class="RktPn">(</span><span class="RktSym">wages*.v2</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="stt"> </span><span class="RktSym">hours</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="stt"> </span><span class="RktSym">wages/h</span><span class="RktPn">)</span><span class="RktPn">)</span>,которое, в соответствии с предназначением, вычисляет список недельной заработной платы 
для оставшихся двух списков.</p>

</li></ol></div><div class="SIntrapara">Теперь нам просто нужно объединить эти значения, 
чтобы получить окончательный ответ. Согласно примерам, мы должны вычислить недельную 
заработную плату для первого работника и <span class="RktSym">construct</span>(построить) 
список из этой заработной платы и остальной(rest) заработной платы: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">weekly-wage</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">hours</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">wages/h</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">wages*.v2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">hours</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">wages/h</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Вспомогательная функция <span class="RktSym">weekly-wage</span>(недельная заработная плата)
использует количество отработанных часов и ставку заработной платы для расчета недельной
заработной платы одного работника: 
<a name="(idx._(gentag._560))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="part_one.html#%28tech._number%29" class="techoutside" data-pltdoc="x"><span class="techinside">Number</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._number%29" class="techoutside" data-pltdoc="x"><span class="techinside">Number</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._number%29" class="techoutside" data-pltdoc="x"><span class="techinside">Number</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">computes the weekly wage from </span><span class="RktSym">pay-rate</span><span class="RktCmt"> and </span><span class="RktSym">hours</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">weekly-wage</span><span class="hspace">&nbsp;</span><span class="RktSym">pay-rate</span><span class="hspace">&nbsp;</span><span class="RktSym">hours</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">pay-rate</span><span class="hspace">&nbsp;</span><span class="RktSym">hours</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Стоп! Какую функцию вам нужно использовать, если вы хотите вычислить заработную плату 
для одного рабочего? Какую функцию вам нужно изменить, если вы хотите иметь дело с 
подоходным налогом?</div>

<p></p>

<p><a name="(counter._(exercise._ex~3aweekly-wage))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;388. В реальном мире <span class="RktSym">wages*.v2</span> 
использует списки структур сотрудников и списки рабочих записей. Структура сотрудников 
содержит имя сотрудника, номер социального страхования и ставку заработной платы. 
В рабочих записях(work record) также указывается имя сотрудника и количество отработанных 
часов в неделю. Результатом является список структур, содержащих имя сотрудника и 
недельную заработную плату. </p>

<p>Измените программу в этом разделе, чтобы она работала с этими реалистичными 
версиями данных. Предоставьте необходимые определения структурного типа и 
определения данных. Используйте рецепт разработки, чтобы направлять процесс 
модификации.
 <a href="#%28counter._%28exercise._ex~3aweekly-wage%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p></p>

<div class="SIntrapara"><a name="(counter._(exercise._ex~3azip))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;389. Разработайте функцию <span class="RktSym">zip</span>, 
которая использует список имен, представленных в виде строк, и список телефонных номеров, 
также строк. Она объединяет эти одинаково длинные списки в список телефонных записей: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">phone-record</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">number</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._phonerecord)"></a><span style="font-style: italic">PhoneRecord</span><span class="RktCmt"> is a structure:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-phone-record</span><span class="stt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="stt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Предположим, что соответствующие элементы списка принадлежат одному и тому же человеку.  
<a href="#%28counter._%28exercise._ex~3azip%29%29" class="ex-end" data-pltdoc="x"></a></div>

<p></p>

<h4>23.3<tt>&nbsp;</tt><a name="(part._sec~3atwo-inputs~3acase3)"></a>Одновременная обработка двух списков: случай 3</h4>

<p></p>

<div class="SIntrapara">Вот проблема третьего типа:
</div><div class="SIntrapara"><blockquote>

<p><span style="font-weight: bold">Пример Задачи</span> Имея список символов 
<span class="RktSym">los</span> и натуральное число <span class="RktSym">n</span>, 
функция <span class="RktSym">list-pick</span> извлекает <span class="RktSym">n</span>-й символ 
из <span class="RktSym">los</span>; если такого символа нет, это сигнализирует об ошибке</p>

</blockquote></div><div class="SIntrapara">Вопрос в том, насколько хорошо работает 
рецепт для разработки <span class="RktSym">list-pick</span>.</div>

<p></p>

<p></p>

<div class="SIntrapara">Хотя определение данных для списка символов к настоящему времени 
довольно знакомо, вспомните класс натуральных чисел из раздела 
<a href="part_two.html#%28part._sec~3anats%29" data-pltdoc="x">Натуральные Числа</a>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span style="font-style: italic">N</span><span class="RktCmt"> is one of: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktVal">0</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="stt"> </span><a href="part_two.html#%28tech._n%29" class="techoutside" data-pltdoc="x"><span class="techinside">N</span></a><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Теперь мы можем перейти ко второму шагу: 
<a name="(idx._(gentag._561))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="RktCmt">] </span><a href="part_two.html#%28tech._n%29" class="techoutside" data-pltdoc="x"><span class="techinside">N</span></a><span class="RktCmt"> -&gt; </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">extracts the </span><span class="RktSym">n</span><span class="RktCmt">th symbol from </span><span class="RktSym">l</span><span class="RktCmt">; </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">signals an error if there is no such symbol</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">a</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
И списки символов, и натуральные числа являются классами со сложными определениями данных. 
Такое сочетание делает проблему нестандартной, а это означает, что мы должны обращать 
внимание на каждую деталь на каждом этапе рецепта разработки.</div>

<p></p>

<p></p>

<div class="SIntrapara">На этом этапе мы обычно выбираем несколько примеров ввода и выясняем, 
каков желаемый результат. Мы начинаем со входов, для которых функция должна работать безупречно:
<span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">a</span><span class="stt"> </span><span class="RktVal">b</span><span class="stt"> </span><span class="RktVal">c</span><span class="RktVal">)</span> и <span class="RktVal">2</span>. 
Для списка из трех символов и индекса <span class="RktVal">2</span> функция 
<span class="RktSym">list-pick</span> должна возвращать символ. Вопрос в том, будет ли это 
<span class="RktVal">'</span><span class="RktVal">b</span> или
<span class="RktVal">'</span><span class="RktVal">c</span>. В начальной школе вы бы посчитали 
<span class="RktVal">1</span>, <span class="RktVal">2</span> и выбрали бы 
<span class="RktVal">'</span><span class="RktVal">b</span>, даже не задумываясь. Но это
информатика, а не начальная школа. Здесь люди начинают отсчет с <span class="RktVal">0</span>,
что означает, что <span class="RktVal">'</span><span class="RktVal">c</span> также является
подходящим выбором. И действительно, мы используем этот выбор: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">b</span><span class="hspace">&nbsp;</span><span class="RktVal">c</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">c</span><span class="RktPn">)</span></p>

</blockquote></div>

<p></p>

<p>Теперь, когда мы устранили эту тонкую точку в <span class="RktSym">list-pick</span>, 
давайте посмотрим на реальную проблему - выбор входных данных. Цель шага примера - 
максимально охватить пространство ввода. Мы делаем это, выбирая один вход для каждого 
предложения в описании сложных форм данных. Здесь эта процедура предлагает выбрать 
по крайней мере два элемента из каждого класса, потому что каждое определение данных 
имеет два предложения. Мы выбираем <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span> и
<span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">a</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span> для первого аргумента и <span class="RktVal">0</span> и
<span class="RktVal">3</span> для последнего. Два варианта выбора для каждого аргумента 
означают, что всего четыре примера; в конце концов, нет никакой очевидной связи между 
двумя аргументами и никаких ограничений в сигнатуре.</p>

<p></p>

<div class="SIntrapara">Оказывается, только одна из этих пар дает правильный результат; 
остальные выбирают позицию, которой не существует, потому что в списке недостаточно символов: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-error%29%29" class="RktStxLink" data-pltdoc="x">check-error</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"list too short"</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">a</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-error%29%29" class="RktStxLink" data-pltdoc="x">check-error</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"list too short"</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Ожидается, что функция сигнализирует об ошибке, и мы выбираем здесь свое любимое сообщение.
</div>

<p></p>

<p>Стоп! Поместите эти фрагменты в область определений DrRacket и запустите частичную программу.
</p>

<p>Обсуждение примеров показывает, что действительно есть четыре независимых случая, 
которые мы должны изучить для разработки функции. Один из способов обнаружить эти 
случаи - расположить условия для каждого из предложений в двумерной таблице: </p>

<p></p>

<div class="SIntrapara"><blockquote><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td style="border-bottom: 1px solid black;; border-right: 1px solid black;">

<p></p>

</td><td style="border-bottom: 1px solid black;; border-right: 1px solid black;">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="stt"> </span><span class="RktSym">l</span><span class="RktPn">)</span> </p>

</td><td style="border-bottom: 1px solid black;">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="stt"> </span><span class="RktSym">l</span><span class="RktPn">)</span> </p>

</td></tr><tr><td style="border-right: 1px solid black;">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="stt"> </span><span class="RktSym">n</span><span class="stt"> </span><span class="RktVal">0</span><span class="RktPn">)</span> </p>

</td><td style="border-right: 1px solid black;">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td>

<p></p>

</td><td>

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td>

<p></p>

</td></tr><tr><td style="border-right: 1px solid black;">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="stt"> </span><span class="RktSym">n</span><span class="stt"> </span><span class="RktVal">0</span><span class="RktPn">)</span> </p>

</td><td style="border-right: 1px solid black;">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td>

<p></p>

</td><td>

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td>

<p></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">В горизонтальном 
измерении таблицы перечислены те вопросы, которые <span class="RktSym">list-pick</span> 
должен задать о списках; вертикальное измерение содержит вопросы о натуральных числах. 
При таком расположении мы, естественно, получаем четыре квадрата, каждый из которых 
представляет случай, когда оба условия на горизонтальной и вертикальной оси истинны.</div>

<p></p>

<p></p>

<div class="SIntrapara">Наша таблица предполагает, что <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> для шаблона 
функции имеет четыре предложения. Мы можем определить подходящее условие для каждого из этих
предложений с помощью <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span>-ing(операции И) горизонтального и 
вертикального условия для каждого поля в таблице:  
</div><div class="SIntrapara"><blockquote><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td style="border-bottom: 1px solid black;; border-right: 1px solid black;">

<p></p>

</td><td style="border-bottom: 1px solid black;; border-right: 1px solid black;">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="stt"> </span><span class="RktSym">l</span><span class="RktPn">)</span> </p>

</td><td style="border-bottom: 1px solid black;">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="stt"> </span><span class="RktSym">l</span><span class="RktPn">)</span> </p>

</td></tr><tr><td style="border-right: 1px solid black;">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="stt"> </span><span class="RktSym">n</span><span class="stt"> </span><span class="RktVal">0</span><span class="RktPn">)</span> </p>

</td><td style="border-right: 1px solid black;">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td><td>

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td></tr><tr><td style="border-right: 1px solid black;">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="stt"> </span><span class="RktSym">n</span><span class="stt"> </span><span class="RktVal">0</span><span class="RktPn">)</span> </p>

</td><td style="border-right: 1px solid black;">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td><td>

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Схема  <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> шаблона - это просто перевод этой 
таблицы в условное выражение: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p>Как всегда, выражение <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> позволяет нам различать четыре возможности 
и сосредотачиваться на каждой отдельно, поскольку мы добавляем выражения селектора к каждому
предложению <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span>: </p>

<p></p>

<div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29" class="RktValLink" data-pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29" class="RktValLink" data-pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Первый аргумент <span class="RktSym">l</span> - это список, а предложение <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> шаблона для непустых списков содержит 
два выражения селектора. Второй аргумент, <span class="RktSym">n</span>, принадлежит к 
<a href="part_two.html#%28tech._n%29" class="techoutside" data-pltdoc="x"><span class="techinside">N</span></a>, и для предложения <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span>
шаблона для чисел, отличных от <span class="RktVal">0</span>, требуется только одно 
выражение селектора. В тех случаях, когда выполняется либо <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="stt"> </span><span class="RktSym">l</span><span class="RktPn">)</span>, либо 
<span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="stt"> </span><span class="RktSym">n</span><span class="stt"> </span><span class="RktVal">0</span><span class="RktPn">)</span>, соответствующий аргумент является атомарным и нет необходимости 
в соответствующем выражении селектора.</div>

<p></p>

<p></p>

<div class="SIntrapara">Последний шаг построения шаблона требует, чтобы мы 
аннотировали шаблон рекурсиями, в которых результаты выражений селектора принадлежат 
к тому же классу, что и входные данные. В этом первом примере мы сосредоточимся на 
последнем предложении <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span>, которое содержит выражения селектора для 
обоих аргументов. Однако неясно, как формировать естественные рекурсии. Если не принимать во
 внимание назначение функции, возможны три рекурсии: 
</div><div class="SIntrapara"><ol><li>

<p><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="stt"> </span><span class="RktSym">l</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29" class="RktValLink" data-pltdoc="x">sub1</a></span><span class="stt"> </span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span></p>

</li><li>

<p><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="stt"> </span><span class="RktSym">l</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29" class="RktValLink" data-pltdoc="x">sub1</a></span><span class="stt"> </span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span></p>

</li><li>

<p><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="stt"> </span><span class="RktSym">l</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">n</span><span class="RktPn">)</span></p>

</li></ol></div><div class="SIntrapara">Каждое из них представляет собой возможную 
комбинацию доступных выражений. Поскольку мы не можем знать, какой из них имеет значение 
или все три имеют значение, мы переходим к следующему этапу разработки. </div>

<p></p>

<blockquote class="Figure"><a name="(counter._(figure._fig~3alist-pick))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="RktCmt">] </span><a href="part_two.html#%28tech._n%29" class="techoutside" data-pltdoc="x"><span class="techinside">N</span></a><span class="RktCmt"> -&gt; </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">extracts the </span><span class="RktSym">n</span><span class="RktCmt">th symbol from </span><span class="RktSym">l</span><span class="RktCmt">; </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">signals an error if there is no such symbol</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">list-pick</span><span class="hspace">&nbsp;</span><span class="RktVal">"list too short"</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">list-pick</span><span class="hspace">&nbsp;</span><span class="RktVal">"list too short"</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29" class="RktValLink" data-pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;134: </span>Индексирование в списке</span></p>

</blockquote>

<p></p>

<div class="SIntrapara">Следуя рецепту разработки для пятого шага, давайте проанализируем 
каждое предложение <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> в шаблоне и решим, каким будет 
правильный ответ: 
</div><div class="SIntrapara"><ol><li>

<p>Если выполняется <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="stt"> </span><span class="RktSym">n</span><span class="stt"> </span><span class="RktVal">0</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="stt"> </span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span>, <span class="RktSym">list-pick</span> должен выбрать первый символ 
из пустого списка, что невозможно. Ответ должен быть сигналом ошибки.</p>

</li><li>

<p>Если выполняется <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="stt"> </span><span class="RktSym">n</span><span class="stt"> </span><span class="RktVal">0</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="stt"> </span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span>, <span class="RktSym">list-pick</span> опять предлагается выбрать 
символ из пустого списка.</p>

</li><li>

<p>Если выполняется <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="stt"> </span><span class="RktSym">n</span><span class="stt"> </span><span class="RktVal">0</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="stt"> </span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span>, предполагается, что <span class="RktSym">list-pick</span> выдаст
первый символ из <span class="RktSym">l</span>. Выражение селектора 
<span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="stt"> </span><span class="RktSym">l</span><span class="RktPn">)</span> является ответом.
</p>

</li><li>

<p></p>

<div class="SIntrapara">Если выполняется <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="stt"> </span><span class="RktSym">n</span><span class="stt"> </span><span class="RktVal">0</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="stt"> </span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span>, мы должны проанализировать, что вычисляют доступные выражения. 
Как мы уже видели, для этого шага рекомендуется проработать существующий пример. 
Выберем сокращенный вариант первого примера: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">b</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">Вот что вычисляют три естественные рекурсии с 
этими значениями:
</div><div class="SIntrapara"><ol><li>

<p><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">b</span><span class="RktVal">)</span><span class="stt"> </span><span class="RktVal">0</span><span class="RktPn">)</span>  производит <span class="RktVal">'</span><span class="RktVal">b</span>;</p>

</li><li>

<p><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">a</span><span class="stt"> </span><span class="RktVal">b</span><span class="RktVal">)</span><span class="stt"> </span><span class="RktVal">0</span><span class="RktPn">)</span> вычисляется как <span class="RktVal">'</span><span class="RktVal">a</span>, 
это неправильный ответ;</p>

</li><li>

<p>и <span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">b</span><span class="RktVal">)</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span> сигнализирует об ошибке.</p>

</li></ol></div><div class="SIntrapara">Из этого мы заключаем, что 
  <span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="stt"> </span><span class="RktSym">l</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29" class="RktValLink" data-pltdoc="x">sub1</a></span><span class="stt"> </span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span>  вычисляет желаемый ответ в последнем предложении <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span>.</div>

<p></p>

</li></ol></div>

<p></p>

<p></p>

<div class="SIntrapara"><a name="(counter._(exercise._ex~3atree-pick))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;390. Разработайте функцию <span class="RktSym">tree-pick</span>. Функция потребляет дерево символов и список направлений: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">branch</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._left%29%29" class="RktStxLink" data-pltdoc="x">left</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._right%29%29" class="RktStxLink" data-pltdoc="x">right</a></span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._to)"></a><span style="font-style: italic">TOS</span><span class="RktCmt"> is one of:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym">make-branch</span><span class="stt"> </span><a href="#%28tech._to%29" class="techoutside" data-pltdoc="x"><span class="techinside">TOS</span></a><span class="stt"> </span><a href="#%28tech._to%29" class="techoutside" data-pltdoc="x"><span class="techinside">TOS</span></a><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._direction)"></a><span style="font-style: italic">Direction</span><span class="RktCmt"> is one of:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._quote%29%29" class="RktStxLink" data-pltdoc="x">'</a></span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._left%29%29" class="RktStxLink" data-pltdoc="x">left</a></span><span class="RktMeta"></span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._quote%29%29" class="RktStxLink" data-pltdoc="x">'</a></span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._right%29%29" class="RktStxLink" data-pltdoc="x">right</a></span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A list of </span><a href="#%28tech._direction%29" class="techoutside" data-pltdoc="x"><span class="techinside">Direction</span></a><span class="RktCmt">s is also called a path. </span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Очевидно, что <a href="#%28tech._direction%29" class="techoutside" data-pltdoc="x"><span class="techinside">Direction</span></a>(направление) указывает функции, выбрать ли 
левую или правую ветвь в несимволическом дереве. Что дает функция 
<span class="RktSym">tree-pick</span> (выбора на дереве)? 
Не забудьте сформулировать полную сигнатуру. Функция сигнализирует об ошибке, если 
задан символ и непустой путь.  
<a href="#%28counter._%28exercise._ex~3atree-pick%29%29" class="ex-end" data-pltdoc="x"></a></div>

<p></p>

<h4>23.4<tt>&nbsp;</tt><a name="(part._sec~3atwo-inputs~3asimplify)"></a>Упрощение функций</h4>

<p></p>

<div class="SIntrapara">Функция <span class="RktSym">list-pick</span> на  
<a href="#%28counter._%28figure._fig~3alist-pick%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">134</span></a> намного сложнее, чем необходимо. Первые два предложения 
<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> сигнализируют об ошибке. То есть, если будет либо 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">либо
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">ответ - ошибка. Мы можем перевести это наблюдение 
в код: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">list-pick</span><span class="hspace">&nbsp;</span><span class="RktVal">"list too short"</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29" class="RktValLink" data-pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Чтобы еще больше упростить эту функцию, нам нужно познакомиться 
с алгебраическими законами, относящимися к логическим значениям:
<span class="refelem"><span class="refcolumn"><span class="refcontent">
Эти уравнения известны как законы де Моргана. </span></span></span>
</div><div class="SIntrapara"><blockquote><table cellspacing="0" cellpadding="0"><tbody><tr><td valign="top"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktSym">bexp1</span><span class="hspace">&nbsp;</span><span class="RktSym">a-bexp</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktSym">bexp2</span><span class="hspace">&nbsp;</span><span class="RktSym">a-bexp</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td><td valign="top">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td valign="top">

<p><span class="RktSym">==</span></p>

</td><td valign="top">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td valign="top"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktSym">bexp1</span><span class="hspace">&nbsp;</span><span class="RktSym">bexp2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">a-bexp</span><span class="RktPn">)</span></td></tr></tbody></table></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Аналогичный закон применяется, когда подвыражения <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span>
меняются местами. Применение этих законов к <span class="RktSym">list-pick</span> 
дает следующее: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">list-pick</span><span class="hspace">&nbsp;</span><span class="RktVal">"list too short"</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29" class="RktValLink" data-pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Теперь рассмотрим  <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="stt"> </span><span class="RktSym">n</span><span class="stt"> </span><span class="RktVal">0</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="stt"> </span><span class="RktSym">n</span><span class="stt"> </span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span>. Оно всегда <span class="RktVal">#true</span>,
потому что <span class="RktSym">n</span> принадлежит <a href="part_two.html#%28tech._n%29" class="techoutside" data-pltdoc="x"><span class="techinside">N</span></a>. 
Поскольку <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="stt"> </span><span class="RktVal">#true</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="stt"> </span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="RktPn">)</span> эквивалентно <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="stt"> </span><span class="RktSym">alos</span><span class="RktPn">)</span>, мы можем снова переписать функцию: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">list-pick</span><span class="hspace">&nbsp;</span><span class="RktVal">"list too short"</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29" class="RktValLink" data-pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p>Это последнее определение уже значительно проще, чем определение на  
<a href="#%28counter._%28figure._fig~3alist-pick%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">134</span></a>, но мы можем сделать даже лучше. Сравните первое условие 
в последней версии <span class="RktSym">list-pick</span> со вторым и третьим. Поскольку 
первое предложение <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> отфильтровывает все случаи, когда
<span class="RktSym">alos</span> пусто, <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="stt"> </span><span class="RktSym">alos</span><span class="RktPn">)</span> в последних двух предложениях всегда будет вычислятся как 
<span class="RktVal">#true</span>. Если мы заменим условие на <span class="RktVal">#true</span> 
и снова упростим выражения <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span>, мы получим трехстрочную версию 
  <span class="RktSym">list-pick</span></p>

<blockquote class="Figure"><a name="(counter._(figure._fig~3alist-pick2))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktSym">list-pick</span><span class="RktCmt">: [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="RktCmt">] </span><a href="part_two.html#%28tech._n%29" class="techoutside" data-pltdoc="x"><span class="techinside">N</span></a><span class="RktCmt">[&gt;= 0] -&gt; </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">determines the </span><span class="RktSym">nth</span><span class="RktCmt"> symbol from </span><span class="RktSym">alos</span><span class="RktCmt">, counting from </span><span class="RktVal">0</span><span class="RktCmt">;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">signals an error if there is no </span><span class="RktSym">n</span><span class="RktCmt">th symbol</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">list-pick</span><span class="hspace">&nbsp;</span><span class="RktVal">"list too short"</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-pick</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alos</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29" class="RktValLink" data-pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;135: </span>Индексирование в список, упрощенное </span></p>

</blockquote>

<p>На  <a href="#%28counter._%28figure._fig~3alist-pick2%29%29" data-pltdoc="x">рис.&nbsp;<span class="FigureRef">135</span></a> показана эта упрощенная версия 
<span class="RktSym">list-pick</span>. Хотя она намного проще оригинала, важно понимать, 
что мы разработали оригинал систематическим образом и что мы смогли преобразовать первый 
во второй с помощью хорошо установленных алгебраических законов. Поэтому мы можем доверять 
этой простой версии. Если мы попытаемся найти простые версии функций напрямую, мы рано 
или поздно не справимся с ситуацией в нашем анализе, и мы гарантированно создадим 
некорректные программы.</p>

<p><a name="(counter._(exercise._ex~3areplace-eol-simp))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;391.  Разработайте <span class="RktSym">replace-eol-with</span>,
используя стратегию <a href="#%28part._sec~3atwo-inputs~3acase3%29" data-pltdoc="x">Одновременной обработки двух списков: Случай 3.</a>. Начните с тестов. Систематически упрощайте результат.
 <a href="#%28counter._%28exercise._ex~3areplace-eol-simp%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3atree-ref-simpl))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;392. Упростите функцию <span class="RktSym">tree-pick</span> из  
<a href="#%28counter._%28exercise._ex~3atree-pick%29%29" data-pltdoc="x">упражнения&nbsp;390</a>. <a href="#%28counter._%28exercise._ex~3atree-ref-simpl%29%29" class="ex-end" data-pltdoc="x"></a></p>

<h4>23.5<tt>&nbsp;</tt><a name="(part._sec~3atwo-inputs~3adesign)"></a>Разработка функций,
использующих два сложных входа
</h4>

<p></p>

<div class="SIntrapara">Правильный подход к проектированию функций двух (или более) 
сложных аргументов - следовать <a name="(idx._(gentag._562))"></a>общему рецепту. 
Вы должны провести анализ данных и определить соответствующие классы данных. Если использование
параметрических определений, таких как <a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a>, и 
сокращенных примеров, таких как <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">b</span><span class="stt"> </span><span class="RktVal">&amp;</span><span class="RktVal">)</span>, смущает вас, 
расширьте их, чтобы конструкторы стали явными. Далее вам понадобится сигнатура функции 
и ее назначение. На этом этапе вы можете подумать и решить, с какой из следующих трех ситуаций 
вы столкнулись: 
</div><div class="SIntrapara"><ol><li>

<p>Если один из параметров играет доминирующую роль, подумайте о другом как о 
элементарной части данных, если речь идет о функции.</p>

</li><li>

<p>В некоторых случаях параметры относятся к одному классу значений и должны 
иметь одинаковый размер. Например, два списка должны иметь одинаковую длину, 
или две веб-страницы должны иметь одинаковую длину, и если одна из них содержит 
встроенную страницу, другая тоже. Если два параметра имеют этот равный статус и 
цель предполагает, что они обрабатываются синхронно, вы выбираете один параметр, 
организуете функцию вокруг него и проходите другой параллельно. </p>

</li><li>

<p>Если очевидной связи между двумя параметрами нет, необходимо разобрать 
все возможные случаи на примерах. Затем используйте этот анализ для разработки шаблона, 
особенно рекурсивных частей.</p>

</li></ol></div>

<p></p>

<p></p>

<div class="SIntrapara">Как только вы решите, что функция попадает в третью категорию,
разработайте двухмерную таблицу, чтобы убедиться, что ни один случай не будет упущен. 
Давайте снова воспользуемся парой нетривиальных определений данных, чтобы объяснить эту идею: 
</div><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0"><tbody><tr><td valign="top" align="left"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._lod)"></a><span style="font-style: italic">LOD</span><span class="RktCmt"> is one of: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><a href="#%28tech._direction%29" class="techoutside" data-pltdoc="x"><span class="techinside">Direction</span></a><span class="stt"> </span><a href="#%28tech._lod%29" class="techoutside" data-pltdoc="x"><span class="techinside">LOD</span></a><span class="RktPn">)</span></td></tr></tbody></table></td><td valign="top" align="left">

<p><span class="hspace">&nbsp;</span></p>

</td><td valign="top" align="left"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._tid)"></a><span style="font-style: italic">TID</span><span class="RktCmt"> is one of: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym">make-binary</span><span class="stt"> </span><a href="#%28tech._tid%29" class="techoutside" data-pltdoc="x"><span class="techinside">TID</span></a><span class="stt"> </span><a href="#%28tech._tid%29" class="techoutside" data-pltdoc="x"><span class="techinside">TID</span></a><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><span class="RktPn">(</span><span class="RktSym">make-with</span><span class="stt"> </span><a href="#%28tech._tid%29" class="techoutside" data-pltdoc="x"><span class="techinside">TID</span></a><span class="stt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="stt"> </span><a href="#%28tech._tid%29" class="techoutside" data-pltdoc="x"><span class="techinside">TID</span></a><span class="RktPn">)</span></td></tr></tbody></table></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Левое определение данных - это обычное определение списка; правый вариант 
<a href="#%28tech._to%29" class="techoutside" data-pltdoc="x"><span class="techinside">TOS</span></a> из трех пунктов. Он использует два определения типа структуры: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">with</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">lft</span><span class="hspace">&nbsp;</span><span class="RktSym">info</span><span class="hspace">&nbsp;</span><span class="RktSym">rght</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">binary</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">lft</span><span class="hspace">&nbsp;</span><span class="RktSym">rght</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Предполагая, что функция потребляет <a href="#%28tech._lod%29" class="techoutside" data-pltdoc="x"><span class="techinside">LOD</span></a> и 
<a href="#%28tech._tid%29" class="techoutside" data-pltdoc="x"><span class="techinside">TID</span></a>, таблица, которую вы должны создать, имеет такую форму: 
</div><div class="SIntrapara"><blockquote><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td style="border-bottom: 1px solid black;; border-right: 1px solid black;">

<p></p>

</td><td style="border-bottom: 1px solid black;; border-right: 1px solid black;">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="stt"> </span><span class="RktSym">l</span><span class="RktPn">)</span> </p>

</td><td style="border-bottom: 1px solid black;">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29" class="RktValLink" data-pltdoc="x">cons?</a></span><span class="stt"> </span><span class="RktSym">l</span><span class="RktPn">)</span> </p>

</td></tr><tr><td style="border-right: 1px solid black;">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29" class="RktValLink" data-pltdoc="x">symbol?</a></span><span class="stt"> </span><span class="RktSym">t</span><span class="RktPn">)</span> </p>

</td><td style="border-right: 1px solid black;">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td>

<p></p>

</td><td>

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td>

<p></p>

</td></tr><tr><td style="border-right: 1px solid black;">

<p><span class="RktPn">(</span><span class="RktSym">binary?</span><span class="stt"> </span><span class="RktSym">t</span><span class="RktPn">)</span> </p>

</td><td style="border-right: 1px solid black;">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td>

<p></p>

</td><td>

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td>

<p></p>

</td></tr><tr><td style="border-right: 1px solid black;">

<p><span class="RktPn">(</span><span class="RktSym">with?</span><span class="stt"> </span><span class="RktSym">t</span><span class="RktPn">)</span> </p>

</td><td style="border-right: 1px solid black;">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td>

<p></p>

</td><td>

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td>

<p></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">Вдоль горизонтального
направления мы перечисляем условия, которые распознают подклассы для первого параметра, 
здесь  <a href="#%28tech._lod%29" class="techoutside" data-pltdoc="x"><span class="techinside">LOD</span></a>, а вдоль вертикального направления мы перечисляем условия для второго параметра, 
<a href="#%28tech._tid%29" class="techoutside" data-pltdoc="x"><span class="techinside">TID</span></a>.</div>

<p></p>

<p>Таблица направляет разработку как примеров функций, так и шаблона функции. 
Как объяснено, примеры должны охватывать все возможные случаи; то есть должен быть 
хотя бы один пример для каждой ячейки в таблице. Точно так же шаблон должен иметь 
одно предложение <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> на ячейку; его состояние объединяет
горизонтальные и вертикальные условия в выражении <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span>. 
Каждое предложение <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span>, в свою очередь, должно содержать 
все возможные выражения селектора для обоих параметров. Если один из параметров 
является атомарным, в выражении селектора нет необходимости. Наконец, вам нужно знать 
о возможных естественных рекурсиях. В общем, все возможные комбинации выражений селектора 
(и, возможно, атомарных аргументов) являются кандидатами на естественную рекурсию. 
Поскольку мы не можем знать, какие из них необходимы, а какие нет, мы учитываем их 
на этапе кодирования. </p>

<p>Таким образом, разработка многопараметрических функций - это просто вариация на тему 
старых рецептов разработки. Основная идея состоит в том, чтобы преобразовать определения данных
в таблицу, в которой показаны все возможные и интересные комбинации. При разработке 
примеров функций и шаблона таблица используется максимально. </p>

<h4>23.6<tt>&nbsp;</tt><a name="(part._sec~3atwo-inputs~3aex)"></a>Упражнения для пальцев: два входа</h4>

<p><a name="(counter._(exercise._ex~3aset2))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;393. На <a href="part_two.html#%28counter._%28figure._fig~3asets-vs-lists%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">62</span></a> представлены два определения 
данных для конечных множеств(наборов). Разработайте функцию объединения для представления 
конечных множеств по вашему выбору. Она потребляет два множества и производит одно, 
содержащее элементы обоих.
</p>

<p>Разработайте <span class="RktSym">intersect</span> для того же представления множеств. 
Она потребляет два множества(набора) и производит множество именно тех элементов, 
которые встречаются в обоих. 
 <a href="#%28counter._%28exercise._ex~3aset2%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3amerge))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;394. Разработайте <span class="RktSym">merge</span>. Функция использует два списка
чисел, отсортированных по возрастанию. Она создает единый отсортированный список чисел, 
который содержит все числа из обоих списков входов. Число встречается в выходных данных 
столько раз, сколько встречается в двух входных списках вместе. 
<a href="#%28counter._%28exercise._ex~3amerge%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3adrop-take))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;395. Разработайте <span class="RktSym">take</span>. Она ипользует список
<span class="RktSym">l</span> и натуральное число <span class="RktSym">n</span>. Она 
производит первые <span class="RktSym">n</span> элементов из <span class="RktSym">l</span> 
или все из <span class="RktSym">l</span>, если он слишком короток.
</p>

<p>Разработайте <span class="RktSym">drop</span>. Она потребляет список <span class="RktSym">l</span> и натуральное число <span class="RktSym">n</span>. Результатом будет 
<span class="RktSym">l</span> с удаленными первыми <span class="RktSym">n</span> элементами 
или просто ’<span class="RktPn">(</span><span class="RktPn">)</span>, если 
<span class="RktSym">l</span> слишком короток.
<a href="#%28counter._%28exercise._ex~3adrop-take%29%29" class="ex-end" data-pltdoc="x"></a></p>

<blockquote class="Figure"><a name="(counter._(figure._fig~3ahangman-game))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><a name="(tech._hm._word)"></a><span style="font-style: italic">HM-Word</span><span class="RktCmt"> is a [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="part_two.html#%28tech._letter%29" class="techoutside" data-pltdoc="x"><span class="techinside">Letter</span></a><span class="RktCmt"> or </span><span class="RktVal">"_"</span><span class="RktCmt">]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span style="font-weight: bold">interpretation</span><span class="RktCmt"> </span><span class="RktVal">"_"</span><span class="RktCmt"> represents a letter to be guessed </span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._hm._word%29" class="techoutside" data-pltdoc="x"><span class="techinside">HM-Word</span></a><span class="RktCmt"> </span><a href="part_two.html#%28tech._n%29" class="techoutside" data-pltdoc="x"><span class="techinside">N</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">runs a simplistic hangman game, produces the current state</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">play</span><span class="hspace">&nbsp;</span><span class="RktSym">the-pick</span><span class="hspace">&nbsp;</span><span class="RktSym">time-limit</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">the-word</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._explode%29%29" class="RktValLink" data-pltdoc="x">explode</a></span><span class="hspace">&nbsp;</span><span class="RktSym">the-pick</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">the-guess</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._make-list%29%29" class="RktValLink" data-pltdoc="x">make-list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">length</span><span class="hspace">&nbsp;</span><span class="RktSym">the-word</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"_"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._hm._word%29" class="techoutside" data-pltdoc="x"><span class="techinside">HM-Word</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._hm._word%29" class="techoutside" data-pltdoc="x"><span class="techinside">HM-Word</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">do-nothing</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._hm._word%29" class="techoutside" data-pltdoc="x"><span class="techinside">HM-Word</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._keyevent%29" class="techoutside" data-pltdoc="x"><span class="techinside">KeyEvent</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._hm._word%29" class="techoutside" data-pltdoc="x"><span class="techinside">HM-Word</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">checked-compare</span><span class="hspace">&nbsp;</span><span class="RktSym">current-status</span><span class="hspace">&nbsp;</span><span class="RktSym">ke</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._member~3f%29%29" class="RktValLink" data-pltdoc="x">member?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ke</span><span class="hspace">&nbsp;</span><span class="RktSym">LETTERS</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">compare-word</span><span class="hspace">&nbsp;</span><span class="RktSym">the-word</span><span class="hspace">&nbsp;</span><span class="RktSym">current-status</span><span class="hspace">&nbsp;</span><span class="RktSym">ke</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">current-status</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._implode%29%29" class="RktValLink" data-pltdoc="x">implode</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._big-bang%29%29" class="RktStxLink" data-pltdoc="x">big-bang</a></span><span class="hspace">&nbsp;</span><span class="RktSym">the-guess</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._hm._word%29" class="techoutside" data-pltdoc="x"><span class="techinside">HM-Word</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._to-draw%29%29" class="RktStxLink" data-pltdoc="x">to-draw</a></span><span class="hspace">&nbsp;</span><span class="RktSym">render-word</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._on-tick%29%29" class="RktStxLink" data-pltdoc="x">on-tick</a></span><span class="hspace">&nbsp;</span><span class="RktSym">do-nothing</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktSym">time-limit</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._on-key%29%29" class="RktStxLink" data-pltdoc="x">on-key</a></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">checked-compare</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._hm._word%29" class="techoutside" data-pltdoc="x"><span class="techinside">HM-Word</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._image%29" class="techoutside" data-pltdoc="x"><span class="techinside">Image</span></a></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">render-word</span><span class="hspace">&nbsp;</span><span class="RktSym">w</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._text%29%29" class="RktValLink" data-pltdoc="x">text</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._implode%29%29" class="RktValLink" data-pltdoc="x">implode</a></span><span class="hspace">&nbsp;</span><span class="RktSym">w</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">22</span><span class="hspace">&nbsp;</span><span class="RktVal">"black"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;136: </span>Простая игра hangman(палач)</span></p>

</blockquote>

<p><a name="(counter._(exercise._ex~3ahangman-list))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;396. Палач(Hangman) - хорошо известная игра в угадайку.
Один игрок загадывает слово, другому говорят сколько букв содержит слово. Последний
выбирает букву и спрашивает первого игрока, встречается ли где эта буква в выбранном
слове. Игра заканчивается по истечении оговоренного времени или количества раундов.
</p>

<p>На <a href="#%28counter._%28figure._fig~3ahangman-game%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">136</span></a> представлена суть ограниченой по времени версии игры.
См. <a href="part_three.html#%28part._sec~3alocal-is-power%29" data-pltdoc="x">Локальные определния Добавляющие Выразительную силу</a>, чтобы узнать почему
<span class="RktSym">checked-compare</span> определяется локально. 
<a name="(idx._(gentag._563))"></a></p>

<p>Цель этого упражнения - разработать <span class="RktSym">compare-word</span>, центральную
функцию. Она использует слово, которое нужно отгадать, слово <span class="RktSym">s</span> 
которое представляет, сколь мало уже обнаружил угадывающий игрок, и текущее предположение.
Функция возвращает <span class="RktSym">s</span> со всеми <span class="RktVal">"_"</span> там,
где при угадывании обнаружена буква.</p>

<p></p>

<div class="SIntrapara">После того, как вы создали функцию, запустите программу, следующим образом:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">LOCATION</span><span class="hspace">&nbsp;</span><span class="RktVal">"/usr/share/dict/words"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">on OS X</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">AS-LIST</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-lines%29%29" class="RktValLink" data-pltdoc="x">read-lines</a></span><span class="hspace">&nbsp;</span><span class="RktSym">LOCATION</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">SIZE</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">length</span><span class="hspace">&nbsp;</span><span class="RktSym">AS-LIST</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">play</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list-ref%29%29" class="RktValLink" data-pltdoc="x">list-ref</a></span><span class="hspace">&nbsp;</span><span class="RktSym">AS-LIST</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._random%29%29" class="RktValLink" data-pltdoc="x">random</a></span><span class="hspace">&nbsp;</span><span class="RktSym">SIZE</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
См. <a href="part_two.html#%28counter._%28figure._fig~3areading-a-dictionary%29%29" data-pltdoc="x">рисунок&nbsp;<span class="FigureRef">74</span></a> для объяснения. Наслаждайтесь
и дорабатывайте по желанию! 
<a href="#%28counter._%28exercise._ex~3ahangman-list%29%29" class="ex-end" data-pltdoc="x"></a></div>

<p></p>

<p><a name="(counter._(exercise._ex~3awage-general))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;397. На фабрике сотрудники перфорируют табели учета рабочего
времени по прибытии утром и уходя вечером. Электронные табели учета рабочего времени содержат
номер сотрудника(employee number) и записывают число(количество) отработанных часов в неделю.
Записи о сотрудниках всегда содержат имя сотрудника и ставку заработной платы.
<a name="(idx._(gentag._564))"></a></p>

<p>Разработайте <span class="RktSym">wages*.v3</span>. Функция потребляет список записей
сотрудников и список записей в табеле учета рабочего времени. Она создает список записей
о заработной плате, который содержит имя и недельную заработную плату сотрудника. Функция
сигнализирует об ошибке, если не может найти запись о сотруднике для табеля учета рабочего
времени или наоборот.</p>

<p><span style="font-weight: bold">Допущение</span> Существует не более одной карты времени на
один номер сотрудника. 
<a href="#%28counter._%28exercise._ex~3awage-general%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p></p>

<div class="SIntrapara"><a name="(counter._(exercise._ex~3apolyn))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;398. Линейная комбинация - это сумма многих линейных членов, то есть
произведений переменных и чисел. Последние в этом контексте называются коэффициентами.
Вот некоторые примеры:
</div><div class="SIntrapara"><blockquote><table cellspacing="0" cellpadding="0"><tbody><tr><td>

<p><img src="part_four_files/pict_148.png" alt="image" width="22" height="8"></p>

</td><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td>

<p><img src="part_four_files/pict_149.png" alt="image" width="65" height="10"></p>

</td><td>

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td>

<p><img src="part_four_files/pict_150.png" alt="image" width="102" height="10"></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">Во всех примерах,
коэффициент при <span style="font-style: italic">x</span> равен 5, коэффициент при
<span style="font-style: italic">y</span> равен 17, а коэффициент для <span style="font-style: italic">z</span> равен 3.</div>

<p></p>

<p>Если нам даны значения для переменных, мы можем определить значение полинома. Нарпример,
если <span style="font-style: italic">x = </span>1<span style="font-style: italic"></span>0<span style="font-style: italic"></span>, значение <img src="part_four_files/pict_151.png" alt="image" width="22" height="8"> равно
<span style="font-style: italic"></span>5<span style="font-style: italic"></span>0<span style="font-style: italic"></span>; если <span style="font-style: italic">x = </span>1<span style="font-style: italic"></span>0<span style="font-style: italic"></span> и <span style="font-style: italic">y = </span>1<span style="font-style: italic"></span>, значение <img src="part_four_files/pict_152.png" alt="image" width="65" height="10"> равно
<span style="font-style: italic"></span>6<span style="font-style: italic"></span>7<span style="font-style: italic"></span>; и если <span style="font-style: italic">x = </span>1<span style="font-style: italic"></span>0<span style="font-style: italic"></span>, <span style="font-style: italic">y = </span>1<span style="font-style: italic"></span>, и <span style="font-style: italic">z = </span>2<span style="font-style: italic"></span>, значение
<img src="part_four_files/pict_153.png" alt="image" width="102" height="10"> равно 
<span style="font-style: italic"></span>7<span style="font-style: italic"></span>3<span style="font-style: italic"></span>.</p>

<p></p>

<div class="SIntrapara">Есть много различных представлений линейных комбинаций. Мы могли бы,
например, представить их с помощью функций. Альтернативное представление - это список его
коэффициентов. Вышеуказанные комбинации будут представлены как:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">17</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">17</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Этот выбор представления предполагает фиксированный порядок переменных.
</div>

<p></p>

<p>Разработайте <span class="RktSym">value</span>. Функция использует два списка одинаковой
длины: линейную комбинацию и список значений переменных. Она производит значение комбинации для
этих значений. 
<a href="#%28counter._%28exercise._ex~3apolyn%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3aperm-xmas))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;399. Louise, Jane, Laura, Dana и Mary решают провести лотерею, в которой
каждой из них назначается по одному получателю подарка. Поскольку Jane(джейн) - разработчик,
они просят её написать программу, которая беспристрастно выполняет эту задачу.
Конечно, программа не должна назначать себе сестер.</p>

<p></p>

<div class="SIntrapara">Вот суть программы Джейн(Jane): 
<a name="(idx._(gentag._565))"></a> <a name="(idx._(gentag._566))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt">] -&gt; [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt">] </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">picks a random non-identity arrangement of </span><span class="RktSym">names</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">gift-pick</span><span class="hspace">&nbsp;</span><span class="RktSym">names</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">random-pick</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">non-same</span><span class="hspace">&nbsp;</span><span class="RktSym">names</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">arrangements</span><span class="hspace">&nbsp;</span><span class="RktSym">names</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt">] -&gt; [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt">]]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">returns all possible permutations of </span><span class="RktSym">names</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">see </span><a href="part_two.html#%28counter._%28exercise._ex~3apermutations%29%29" data-pltdoc="x">exercise&nbsp;213</a></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">arrangements</span><span class="hspace">&nbsp;</span><span class="RktSym">names</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Она потребляет список имен и случайным образом выбирает одну из тех перестановок, которые
нигде не согласуются с исходным списком.</div>

<p></p>

<p></p>

<div class="SIntrapara">Ваша задача - разработать две вспомогательные функции 
<a name="(idx._(gentag._567))"></a> <a name="(idx._(gentag._568))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[</span><a href="part_three.html#%28tech._sim-dd._nelist._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">NEList-of</span></a><span class="RktCmt"> X] -&gt; X </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">returns a random item from the list </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">random-pick</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt">] [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt">]] </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">-&gt; </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a><span class="RktCmt">]]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">produces the list of those lists in </span><span class="RktSym">ll</span><span class="RktCmt"> that do </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">not agree with </span><span class="RktSym">names</span><span class="RktCmt"> at any place </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">non-same</span><span class="hspace">&nbsp;</span><span class="RktSym">names</span><span class="hspace">&nbsp;</span><span class="RktSym">ll</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">ll</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Напомним что <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._random%29%29" class="RktValLink" data-pltdoc="x">random</a></span> выбирает
случайное число; см. <a href="part_one.html#%28counter._mix._%28exercise._mix-ufo-move%29%29" data-pltdoc="x">упражнение&nbsp;99</a>. <a href="#%28counter._%28exercise._ex~3aperm-xmas%29%29" class="ex-end" data-pltdoc="x"></a></div>

<p></p>

<p><a name="(counter._(exercise._ex~3adna-prefix))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;400. Создайте функцию <span class="RktSym">DNAprefix</span>. Функция принимает
два аргумента, оба списки символов <span class="RktVal">'</span><span class="RktVal">a</span>, <span class="RktVal">'</span><span class="RktVal">c</span>,
<span class="RktVal">'</span><span class="RktVal">g</span> и <span class="RktVal">'</span><span class="RktVal">t</span>, которые встречаются в описаниях ДНК(DNA). Первый список
называется шаблоном(pattern), втрой - строкой поиска. Функция возвращает 
<span class="RktVal">#true</span>, если шаблон идентичен начальной части строки поиска;
в противном случае она возвращает <span class="RktVal">#false</span>.</p>

<p>Также разработайте <span class="RktSym">DNAdelta</span>. Эта функция похожа на
<span class="RktSym">DNAprefix</span>, но возвращает первый элемент в строке поиска за
пределами шаблона. Если списки идентичны и за шаблоном нет ДНК буквы, функция сигнализирует
об ошибке. Если шаблон не соответствует началу строки поиска, возвращается  
<span class="RktVal">#false</span>. Функция не должна проходить ни один из списков более
одного раза.</p>

<p>Можно ли упростить <span class="RktSym">DNAprefix</span> или 
<span class="RktSym">DNAdelta</span>? 
<a href="#%28counter._%28exercise._ex~3adna-prefix%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p></p>

<div class="SIntrapara"><a name="(counter._(exercise._ex~3atest-compare))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;401. Разработайте <span class="RktSym">sexp=?</span>, 
функцию которая определяет, равны ли два S-выражения. Для удобства вот определение данных
в сжатом виде:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><span style="font-style: italic">S-expr</span><span class="RktCmt"> (S-expression) is one of: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><a href="#%28tech._atom%29" class="techoutside" data-pltdoc="x"><span class="techinside">Atom</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="#%28tech._s._expr%29" class="techoutside" data-pltdoc="x"><span class="techinside">S-expr</span></a><span class="RktCmt">]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An </span><span style="font-style: italic">Atom</span><span class="RktCmt"> is one of: </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><a href="part_one.html#%28tech._number%29" class="techoutside" data-pltdoc="x"><span class="techinside">Number</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">–</span><span class="RktCmt"> </span><a href="i2-3.html#%28tech._symbol%29" class="techoutside" data-pltdoc="x"><span class="techinside">Symbol</span></a><span class="RktCmt"> </span></td></tr></tbody></table></blockquote></div>

<p></p>

<p>Всякий раз, когда вы используете <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span>, она использует такую
функцию как <span class="RktSym">sexp=?</span>, чтобы проверить, равны ли два произвольных
значения. В противном случае проверка не удалась и <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span> сообщает об этом, как есть. 
<a href="#%28counter._%28exercise._ex~3atest-compare%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._(exercise._ex~3absl-var-eval-atomic))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;402. Перечитайте  <a href="#%28counter._%28exercise._ex~3absl-var-eval%29%29" data-pltdoc="x">упражнение&nbsp;354</a>.
Объясните причины, по которым мы советуем сначала думать о данном выражении как об атомарном
значении. 
<a href="#%28counter._%28exercise._ex~3absl-var-eval-atomic%29%29" class="ex-end" data-pltdoc="x"></a></p>

<h4>23.7<tt>&nbsp;</tt><a name="(part._db._sec~3aproj-db)"></a>Проект: База Данных</h4>

<p>Многие программные приложения используют базу данных для отслеживания данных. Грубо
говоря, база данных - это таблица с явно указанным организационным правилом. 
Первое это содержание(<span style="font-style: italic">content</span>);  последнне
<span class="refelem"><span class="refcolumn"><span class="refcontent">
В этом разделе собраны знания из всех четырех частей книги.
</span></span></span>  
называется схемой(<span style="font-style: italic">schema</span>). 
На <a href="#%28counter._db._%28figure._fig~3adb-tables%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">137</span></a> показаны два примера. Каждая таблица состоит из двух частей:
схемы над строкой и содержимого ниже.</p>

<p></p>

<div class="SIntrapara">Сфокусируемся на таблице слева. Она состоит из трех столбцов
и четырех строк. В каждом столбце есть правило, состоящее из двух частей:
</div><div class="SIntrapara"><ol><li>

<p>правило в крайнем левом столбце гласит, что метка столбца это имя(“Name”) и что 
каждая часть данных в этом столбце является строкой - <a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a>;</p>

</li><li>

<p>средний столбец помечен как возраст - “Age” и содержит 
<a href="part_one.html#%28tech._integer%29" class="techoutside" data-pltdoc="x"><span class="techinside">Integer</span></a>s; и</p>

</li><li>

<p>метка крайнего правого это Присутствует(“Present”); его значения являются логическими
значениями -
<a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a>.</p>

</li></ol></div><div class="SIntrapara">Стоп! Объясните таблицу справа таким же образом.</div>

<p></p>

<blockquote class="Figure"><a name="(counter._db._(figure._fig~3adb-tables))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><blockquote class="SVInsetFlow"><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td valign="top"><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td align="left">

<p>Name</p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p>Age</p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p>Present</p>

</td></tr><tr><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._integer%29" class="techoutside" data-pltdoc="x"><span class="techinside">Integer</span></a></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Alice"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">35</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">#true</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Bob"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">25</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">#false</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Carol"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">30</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">#true</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Dave"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">32</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">#false</span></p>

</td></tr></tbody></table></td><td valign="top">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td style="border-right: 1px solid black;" valign="top">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td style="border-right: 1px solid black;" valign="top">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td valign="top"><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td align="left">

<p>Present</p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p>Description</p>

</td></tr><tr><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">#true</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">"presence"</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">#false</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">"absence"</span></p>

</td></tr></tbody></table></td></tr></tbody></table></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;137: </span>База Данных как таблица</span></p>

</blockquote>

<p>Ученые-информатики думают об этих таблицах как об отношениях - 
<span style="font-style: italic">relations</span>. Схема вводит терминологию для обозначения
столбцов отношения и отдельных ячеек в строке.  Каждая строка связывает/соотносит(relates)
фиксированное число значений; совокупность всех строк составляет полное отношение.
В этой терминологии первая строка левой таблицы на  <a href="#%28counter._db._%28figure._fig~3adb-tables%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">137</span></a> 
соотносит/связывает  <span class="RktVal">"Alice"</span> с <span class="RktVal">35</span> и 
<span class="RktVal">#true</span>. Кроме того, первая ячейка строки называется “Name”, 
втроая ячейка “Age” и третья ячейка - “Present”.</p>

<p></p>

<div class="SIntrapara">В этом разделе мы представляем базы данных через структуры и
списки:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">schema</span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._db._db)"></a><span style="font-style: italic">DB</span><span class="RktCmt"> is a structure: </span><span class="RktPn">(</span><span class="RktSym">make-db</span><span class="stt"> </span><a href="#%28tech._db._schema%29" class="techoutside" data-pltdoc="x"><span class="techinside">Schema</span></a><span class="stt"> </span><a href="#%28tech._db._content%29" class="techoutside" data-pltdoc="x"><span class="techinside">Content</span></a><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._db._schema)"></a><span style="font-style: italic">Schema</span><span class="RktCmt"> is a [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="#%28tech._db._spec%29" class="techoutside" data-pltdoc="x"><span class="techinside">Spec</span></a><span class="RktCmt">]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._db._spec)"></a><span style="font-style: italic">Spec</span><span class="RktCmt"> is a [</span><a href="part_three.html#%28tech._sim-dd._list%29" class="techoutside" data-pltdoc="x"><span class="techinside">List</span></a><span class="RktCmt"> </span><a href="#%28tech._db._label%29" class="techoutside" data-pltdoc="x"><span class="techinside">Label</span></a><span class="RktCmt"> </span><a href="#%28tech._db._predicate%29" class="techoutside" data-pltdoc="x"><span class="techinside">Predicate</span></a><span class="RktCmt">]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._db._label)"></a><span style="font-style: italic">Label</span><span class="RktCmt"> is a </span><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._db._predicate)"></a><span style="font-style: italic">Predicate</span><span class="RktCmt"> is a [</span><a href="part_one.html#%28tech._any%29" class="techoutside" data-pltdoc="x"><span class="techinside">Any</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a><span class="RktCmt">]</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A (piece of) </span><a name="(tech._db._content)"></a><span style="font-style: italic">Content</span><span class="RktCmt"> is a [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="#%28tech._db._row%29" class="techoutside" data-pltdoc="x"><span class="techinside">Row</span></a><span class="RktCmt">]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._db._row)"></a><span style="font-style: italic">Row</span><span class="RktCmt"> is a [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="#%28tech._db._cell%29" class="techoutside" data-pltdoc="x"><span class="techinside">Cell</span></a><span class="RktCmt">]</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A </span><a name="(tech._db._cell)"></a><span style="font-style: italic">Cell</span><span class="RktCmt"> is </span><a href="part_one.html#%28tech._any%29" class="techoutside" data-pltdoc="x"><span class="techinside">Any</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span style="font-weight: bold">constraint</span><span class="RktCmt"> cells do not contain functions </span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span style="font-weight: bold">integrity constraint</span><span class="RktCmt"> In </span><span class="RktPn">(</span><span class="RktSym">make-db</span><span class="stt"> </span><span class="RktSym">sch</span><span class="stt"> </span><span class="RktSym">con</span><span class="RktPn">)</span><span class="RktCmt">, </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">for every row in </span><span class="RktSym">con</span><span class="RktCmt">,</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">(I1) its length is the same as </span><span class="RktSym">sch</span><span class="RktCmt">'</span><span class="RktCmt">s, and</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">(I2) its </span><span style="font-style: italic">i</span><span class="RktCmt">th </span><a href="#%28tech._db._cell%29" class="techoutside" data-pltdoc="x"><span class="techinside">Cell</span></a><span class="RktCmt"> satisfies the </span><span style="font-style: italic">i</span><span class="RktCmt">th </span><a href="#%28tech._db._predicate%29" class="techoutside" data-pltdoc="x"><span class="techinside">Predicate</span></a><span class="RktCmt"> in </span><span class="RktSym">sch</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Стоп! Переведите базы данных из <a href="#%28counter._db._%28figure._fig~3adb-tables%29%29" data-pltdoc="x">упражнения&nbsp;<span class="FigureRef">137</span></a> в выбранное представление
данных. Обратите внимание, что содержимое таблиц уже использует данные ISL+.</div>

<p></p>

<blockquote class="Figure"><a name="(counter._db._(figure._fig~3adb-isl))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><blockquote class="SVInsetFlow"><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td valign="top"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">school-schema</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">"Name"</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">"Age"</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._integer~3f%29%29" class="RktValLink" data-pltdoc="x">integer?</a></span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">"Present"</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></tbody></table></td><td valign="top">

<p><span class="hspace">&nbsp;</span></p>

</td><td style="border-right: 1px solid black;" valign="top">

<p><span class="hspace">&nbsp;</span></p>

</td><td style="border-right: 1px solid black;" valign="top">

<p><span class="hspace">&nbsp;</span></p>

</td><td valign="top"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">presence-schema</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">"Present"</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">"Description"</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></tbody></table></td></tr><tr><td valign="top">

<p></p>

</td><td valign="top">

<p><span class="hspace">&nbsp;</span></p>

</td><td style="border-right: 1px solid black;" valign="top">

<p><span class="hspace">&nbsp;</span></p>

</td><td style="border-right: 1px solid black;" valign="top">

<p><span class="hspace">&nbsp;</span></p>

</td><td valign="top">

<p></p>

</td></tr><tr><td valign="top"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">school-content</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">"Alice"</span><span class="hspace">&nbsp;</span><span class="RktVal">35</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">"Bob"</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">25</span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">"Carol"</span><span class="hspace">&nbsp;</span><span class="RktVal">30</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">"Dave"</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">32</span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></tbody></table></td><td valign="top">

<p><span class="hspace">&nbsp;</span></p>

</td><td style="border-right: 1px solid black;" valign="top">

<p><span class="hspace">&nbsp;</span></p>

</td><td style="border-right: 1px solid black;" valign="top">

<p><span class="hspace">&nbsp;</span></p>

</td><td valign="top"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">presence-content</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">#true</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">"presence"</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">#false</span><span class="hspace">&nbsp;</span><span class="RktVal">"absence"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></tbody></table></td></tr><tr><td valign="top">

<p></p>

</td><td valign="top">

<p><span class="hspace">&nbsp;</span></p>

</td><td style="border-right: 1px solid black;" valign="top">

<p><span class="hspace">&nbsp;</span></p>

</td><td style="border-right: 1px solid black;" valign="top">

<p><span class="hspace">&nbsp;</span></p>

</td><td valign="top">

<p></p>

</td></tr><tr><td valign="top"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">school-db</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-db</span><span class="hspace">&nbsp;</span><span class="RktSym">school-schema</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">school-content</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td><td valign="top">

<p><span class="hspace">&nbsp;</span></p>

</td><td style="border-right: 1px solid black;" valign="top">

<p><span class="hspace">&nbsp;</span></p>

</td><td style="border-right: 1px solid black;" valign="top">

<p><span class="hspace">&nbsp;</span></p>

</td><td valign="top"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">presence-db</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-db</span><span class="hspace">&nbsp;</span><span class="RktSym">presence-schema</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">presence-content</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></td></tr></tbody></table></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;138: </span>База данных как данные ISL+</span></p>

</blockquote>

<p>На <a href="#%28counter._db._%28figure._fig~3adb-isl%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">138</span></a> показано как представить две таблицы с
 <a href="#%28counter._db._%28figure._fig~3adb-tables%29%29" data-pltdoc="x">рисунка&nbsp;<span class="FigureRef">137</span></a> в виде <a href="#%28tech._db._db%29" class="techoutside" data-pltdoc="x"><span class="techinside">DB</span></a>s. Его левая строна представляет схему,
содержание и базу данных из левой таблицы с <a href="#%28counter._db._%28figure._fig~3adb-tables%29%29" data-pltdoc="x">рисунка&nbsp;<span class="FigureRef">137</span></a>; 
его правая часть соответствует правой части таблицы. Для краткости в примерах используются
обозначения как квазицитаты -
 <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._quasiquote%29%29" class="RktStxLink" data-pltdoc="x">quasiquote</a></span> и отмены цитирования - <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._unquote%29%29" class="RktStxLink" data-pltdoc="x">unquote</a></span>. Напомним, что она позволяет включать
такие обозначения, как <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span> в
цитируемый список.  Если вам не удобно использовать эти обозначения, переформулируйте эти
примеры с помощью <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span>.</p>

<p><a name="(counter._db._(exercise._ex~3adb-choice-of-rep))"></a><span style="font-weight: bold">Упраженение</span>&nbsp;403. <a href="#%28tech._db._spec%29" class="techoutside" data-pltdoc="x"><span class="techinside">Spec</span></a> объединяет <a href="#%28tech._db._label%29" class="techoutside" data-pltdoc="x"><span class="techinside">Label</span></a> и
 a <a href="#%28tech._db._predicate%29" class="techoutside" data-pltdoc="x"><span class="techinside">Predicate</span></a> в список. Хотя такой выбор приемлем, он нарушает наши
рекомендации по использованию структурного типа для фиксированного количества фрагментов
информации.</p>

<p></p>

<div class="SIntrapara">Вот альтернативное представление данных:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29" class="RktStxLink" data-pltdoc="x">define-struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">spec</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">label</span><span class="hspace">&nbsp;</span><span class="RktSym">predicate</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Spec is a structure: </span><span class="RktPn">(</span><span class="RktSym">make-spec</span><span class="stt"> </span><a href="#%28tech._db._label%29" class="techoutside" data-pltdoc="x"><span class="techinside">Label</span></a><span class="stt"> </span><a href="#%28tech._db._predicate%29" class="techoutside" data-pltdoc="x"><span class="techinside">Predicate</span></a><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Используйте это альтернативное представление для представления баз данных с 
 <a href="#%28counter._db._%28figure._fig~3adb-tables%29%29" data-pltdoc="x">рисунка&nbsp;<span class="FigureRef">137</span></a>. 
<a href="#%28counter._db._%28exercise._ex~3adb-choice-of-rep%29%29" class="ex-end" data-pltdoc="x"></a></div>

<p></p>

<p></p>

<div class="SIntrapara"><span style="font-weight: bold">Проверка целостности</span>
Использование баз данных критически зависит от их целостности. Здесь целостность(“integrity”)
отностися к ограничениям (I1) и (I2) из определения данных. Очевидно, что проверка
целостности базы данных является задачей функции: 
<a name="(idx._db._(gentag._569._db))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._db._db%29" class="techoutside" data-pltdoc="x"><span class="techinside">DB</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">do all rows in </span><span class="RktSym">db</span><span class="RktCmt"> satisfy (I1) and (I2)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">integrity-check</span><span class="hspace">&nbsp;</span><span class="RktSym">school-db</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">integrity-check</span><span class="hspace">&nbsp;</span><span class="RktSym">presence-db</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">integrity-check</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">#false</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Формулировка двух ограничений(constraints) предполагает, что
некоторая функция должна выдавать <span class="RktVal">#true</span> для каждой строки
в содержимом базы данных. Выражение этой идеи в коде требует использования
<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29" class="RktValLink" data-pltdoc="x">andmap</a></span> для 
содержимого <span class="RktSym">db</span>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">integrity-check</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._db._row%29" class="techoutside" data-pltdoc="x"><span class="techinside">Row</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">row-integrity-check</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29" class="RktValLink" data-pltdoc="x">andmap</a></span><span class="hspace">&nbsp;</span><span class="RktSym">row-integrity-check</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-content</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Следуя <a name="(idx._db._(gentag._570._db))"></a>рецепту разработки для использования
существующих абстракций, шаблон вводит вспомогательную функцию через определение
<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span>.</div>

<p></p>

<p></p>

<div class="SIntrapara">Разработка <span class="RktSym">row-integrity-check</span> начинается с этого: 
<a name="(idx._db._(gentag._571._db))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._db._row%29" class="techoutside" data-pltdoc="x"><span class="techinside">Row</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">does </span><span class="RktSym">row</span><span class="RktCmt"> satisfy (I1) and (I2) </span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">row-integrity-check</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">#false</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Как всегда, цель сформулировать предназначение это значит понять проблему. 
Здесь говорится, что функция проверяет <span style="font-weight: bold">два</span> условия.
Когда задействованы две задачи, наши <a name="(idx._db._(gentag._572._db))"></a> рекомендации 
по проектированию требуют и комбинации их результатов:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">length-of-row-check</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-every-cell</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Добавьте эти функции в свой список пожеланий; их имена передают их цель(назначение).
</div>

<p></p>

<p></p>

<div class="SIntrapara">Прежде чем проектировать эти функции, мы должны подумать, можем 
ли мы составить существующие примитивные операции для вычисления желаемого значения. 
Например, мы знаем, что <span class="RktPn">(</span><span class="RktSym">length</span><span class="stt"> </span><span class="RktSym">row</span><span class="RktPn">)</span> подсчитывает,
сколько ячеек находится в строке(<span class="RktSym">row</span>). Немного продвигаясь в 
этом направлении, мы явно хотим
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">length</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">length</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-schema</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">Это условие проверяет, что длина строки
(<span class="RktSym">row</span>) равна длине схемы <span class="RktSym">db</span>
(базы данных).</div>

<p></p>

<p></p>

<div class="SIntrapara">Точно так же <span class="RktSym">check-every-cell</span> вызывает 
проверку того, что некоторая функция выдает <span class="RktVal">#true</span> для каждой 
ячейки в строке. Еще раз, похоже, что <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29" class="RktValLink" data-pltdoc="x">andmap</a></span>
может быть вызван: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29" class="RktValLink" data-pltdoc="x">andmap</a></span><span class="hspace">&nbsp;</span><span class="RktSym">cell-integrity-check</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">Очевидно, что целью 
<span class="RktSym">cell-integrity-check</span>(проверки целостности ячейки) является проверка
ограничения (I2), то есть
</div><div class="SIntrapara"><blockquote>

<p>удовлетворяет ли <span style="font-style: italic">i</span>-я ячейка
(<a href="#%28tech._db._cell%29" class="techoutside" data-pltdoc="x"><span class="techinside">Cell</span></a>)  <span style="font-style: italic">i</span>-му предикату(<a href="#%28tech._db._predicate%29" class="techoutside" data-pltdoc="x"><span class="techinside">Predicate</span></a>) в схеме <span class="RktSym">db</span>.</p>

</blockquote></div><div class="SIntrapara">И теперь мы застряли, потому что это 
предназначение относится к относительному положению данной ячейки в строке(
<span class="RktSym">row</span>). Однако цель <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29" class="RktValLink" data-pltdoc="x">andmap</a></span>
состоит в том, чтобы применить <span class="RktSym">cell-integrity-check</span> к каждой 
ячейке единообразно(<span style="font-weight: bold">uniformly</span>).</div>

<p></p>

<p></p>

<div class="SIntrapara">Когда вы застряли, вы должны работать над примерами. Для 
вспомогательных или локальных(<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span>) 
функций лучше всего вывести эти примеры 
из примеров для основной функции. Первый пример <span class="RktSym">integrity-check</span>
утверждает, что <span class="RktSym">school-content</span>(школьный контент) удовлетворяет
ограничениям целостности. Очевидно, что все строки в  <span class="RktSym">school-content</span>
имеют ту же длину, что и <span class="RktSym">school-schema</span>. Возникает вопрос, почему такая строка, как 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Alice"</span><span class="hspace">&nbsp;</span><span class="RktVal">35</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">удовлетворяет предикатам в соответствующей схеме: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Name"</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Age"</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._integer~3f%29%29" class="RktValLink" data-pltdoc="x">integer?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Present"</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Ответ заключается в том, что все три применения трех предикатов к соответствующим ячейкам 
дают истинное значение: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Alice"</span><span class="RktPn">)</span></td></tr><tr><td>

<p><span class="RktRes">#true</span></p>

</td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._integer~3f%29%29" class="RktValLink" data-pltdoc="x">integer?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">35</span><span class="RktPn">)</span></td></tr><tr><td>

<p><span class="RktRes">#true</span></p>

</td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span></td></tr><tr><td>

<p><span class="RktRes">#true</span></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">Отсюда всего лишь небольшой
шаг, чтобы увидеть, что функция должна обрабатывать эти два списка - схему 
<span class="RktSym">db</span>(базы данных) и данную строку - параллельно.
</div>

<p></p>

<p><a name="(counter._db._(exercise._ex~3aandmap2))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;404. Создайте функцию <span class="RktSym">andmap2</span>. 
Она использует функцию <span class="RktSym">f</span>, которая из двух значений получает
логическое(<a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a>), и двух одинаково длинных списков. Её результат также
является логическим(<a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a>). В частности, она применяет 
<span class="RktSym">f</span> к парам соответствующих значений из двух списков, и если 
<span class="RktSym">f</span> всегда дает <span class="RktVal">#true</span>, 
<span class="RktSym">andmap2</span> также дает <span class="RktVal">#true</span>. 
В противном случае <span class="RktSym">andmap2</span> выдаст <span class="RktVal">#false</span>.
Короче говоря, <span class="RktSym">andmap2</span> похож на <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29" class="RktValLink" data-pltdoc="x">andmap</a></span>, но для двух списков.
 <a href="#%28counter._db._%28exercise._ex~3aandmap2%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p>Стоп! Прежде чем читать дальше, решите  
<a href="#%28counter._db._%28exercise._ex~3aandmap2%29%29" data-pltdoc="x">упражнение&nbsp;404</a>.
.</p>

<p></p>

<div class="SIntrapara">Если бы у нас был <span class="RktSym">andmap2</span> в ISL +, 
проверка второго условия в строке(<span class="RktSym">row</span>) была бы простой: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym">andmap2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._second%29%29" class="RktValLink" data-pltdoc="x">second</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-schema</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Данная функция потребляет <a href="#%28tech._db._spec%29" class="techoutside" data-pltdoc="x"><span class="techinside">Spec</span></a> <span class="RktSym">s</span> из схемы 
<span class="RktSym">db</span>, извлекает предикат во второй позиции и применяет его к 
заданной ячейке - <a href="#%28tech._db._cell%29" class="techoutside" data-pltdoc="x"><span class="techinside">Cell</span></a> <span class="RktSym">c</span>. Все, что возвращает предикат,
является результатом <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span>-функции.</div>

<p></p>

<p>Остановись снова! Объясните <span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._second%29%29" class="RktValLink" data-pltdoc="x">second</a></span><span class="stt"> </span><span class="RktSym">s</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">c</span><span class="RktPn">]</span>.</p>

<p></p>

<div class="SIntrapara">Как оказалось, <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29" class="RktValLink" data-pltdoc="x">andmap</a></span>
в ISL + уже похож на <span class="RktSym">andmap2</span>: 
<a name="(idx._db._(gentag._573._db))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">integrity-check</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._db._row%29" class="techoutside" data-pltdoc="x"><span class="techinside">Row</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">does </span><span class="RktSym">row</span><span class="RktCmt"> satisfy (I1) and (I2) </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">row-integrity-check</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">length</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">length</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-schema</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29" class="RktValLink" data-pltdoc="x">andmap</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._second%29%29" class="RktValLink" data-pltdoc="x">second</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-schema</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29" class="RktValLink" data-pltdoc="x">andmap</a></span><span class="hspace">&nbsp;</span><span class="RktSym">row-integrity-check</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-content</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Остановись в последний раз! Разработайте тест, при котором проверка целостности
( <span class="RktSym">integrity-check</span>) должна завершиться неудачно.</div>

<p></p>

<p><span style="font-weight: bold">Замечание о поднятии(Hoisting) выражений</span> 
Наше определение <span class="RktSym">integrity-check</span>(проверки целостности) страдает 
от нескольких проблем, некоторые из которых являются видимыми, некоторые - невидимыми. Очевидно,
что функция дважды извлекает схему <span class="RktSym">db</span>(базы данных). С существующим
<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span>(локальным) определением можно ввести
определение и избежать этого дублирования: </p>

<p></p>

<div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">integrity-check.v2</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">schema</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-schema</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._db._row%29" class="techoutside" data-pltdoc="x"><span class="techinside">Row</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">does </span><span class="RktSym">row</span><span class="RktCmt"> satisfy (I1) and (I2) </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">row-integrity-check</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">length</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">length</span><span class="hspace">&nbsp;</span><span class="RktSym">schema</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29" class="RktValLink" data-pltdoc="x">andmap</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._second%29%29" class="RktValLink" data-pltdoc="x">second</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">schema</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29" class="RktValLink" data-pltdoc="x">andmap</a></span><span class="hspace">&nbsp;</span><span class="RktSym">row-integrity-check</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-content</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Из <a href="part_three.html#%28part._sec~3alocal-definitions%29" data-pltdoc="x">Локальные Определения</a> мы знаем, что подъем(lifting) такого выражения может сократить время, 
необходимое для запуска проверки целостности. Как и определение <span class="RktSym">inf</span>
на  <a href="part_three.html#%28counter._%28figure._fig~3alocal-performance%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">100</span></a>, исходная версия 
<span class="RktSym">integrity-check</span> извлекает схему из <span class="RktSym">db</span>
(базы данных) для каждой отдельной строки, даже если она, очевидно, остается неизменной. 
</div>

<p></p>

<p></p>

<div class="SIntrapara"><a name="(idx._db._(gentag._574._db))"></a>
</div><div class="SIntrapara"><blockquote class="Figure"><a name="(counter._db._(figure._fig~3ahoisted))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">integrity-check.v3</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">schema</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-schema</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-content</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">width</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">length</span><span class="hspace">&nbsp;</span><span class="RktSym">schema</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._db._row%29" class="techoutside" data-pltdoc="x"><span class="techinside">Row</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">does </span><span class="RktSym">row</span><span class="RktCmt"> satisfy (I1) and (I2) </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">row-integrity-check</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29" class="RktValLink" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">length</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">width</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29" class="RktValLink" data-pltdoc="x">andmap</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">s</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._second%29%29" class="RktValLink" data-pltdoc="x">second</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">schema</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29" class="RktValLink" data-pltdoc="x">andmap</a></span><span class="hspace">&nbsp;</span><span class="RktSym">row-integrity-check</span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;139: </span>Результат систематического подъема выражения
</span></p>

</blockquote></div>

<p></p>

<p><span style="font-weight: bold">Терминология</span> Специалисты по информатике говорят о
“<span style="font-style: italic">hoisting</span> an expression.” - «поднятии выражения».
Аналогичным образом функция <span class="RktSym">row-integrity-check</span> определяет длину 
схемы <span class="RktSym">db</span>(базы данных) каждый раз, когда она вызывается. 
Результат всегда один и тот же. Следовательно, если мы заинтересованы в улучшении
производительности этой функции, мы можем использовать  определение
<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span>, чтобы раз и навсегда назвать ширину
(<span class="RktSym">width</span>) содержимого базы данных. На 
 <a href="#%28counter._db._%28figure._fig~3ahoisted%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">139</span></a> показан результат подъема <span class="RktPn">(</span><span class="RktSym">length</span><span class="stt"> </span><span class="RktSym">schema</span><span class="RktPn">)</span> из <span class="RktSym">row-integrity-check</span>. Для удобства чтения
это окончательное определение также именует поле <span class="RktSym">content</span>  <span class="RktSym">db</span>.
<span style="font-weight: bold">Конец</span></p>

<p>Программы <span style="font-weight: bold">Проекции(Projections) и Выборки(Selections)</span>
должны извлекать данные из баз данных. Одним из видов извлечения является 
<span style="font-style: italic">select</span>(выбор) содержимого(content), что объясняется в
<a href="part_two.html#%28part._itunes-data._sec~3aitunes%29" data-pltdoc="x">Реальных данных: iTunes</a>. Другой вид извлечения приводит к уменьшенной базе данных; его окрестили 
проекцией(<span style="font-style: italic">projection</span>). Более конкретно, проекция 
создает базу данных, сохраняя только определенные столбцы из данной базы данных.</p>

<p></p>

<div class="SIntrapara">Описание проекции предполагает следующее:   
<a name="(idx._db._(gentag._575._db))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._db._db%29" class="techoutside" data-pltdoc="x"><span class="techinside">DB</span></a><span class="RktCmt"> [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="#%28tech._db._label%29" class="techoutside" data-pltdoc="x"><span class="techinside">Label</span></a><span class="RktCmt">] -&gt; </span><a href="#%28tech._db._db%29" class="techoutside" data-pltdoc="x"><span class="techinside">DB</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">retains a column from </span><span class="RktSym">db</span><span class="RktCmt"> if its label is in </span><span class="RktSym">labels</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">project</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="hspace">&nbsp;</span><span class="RktSym">labels</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-db</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Учитывая сложность проекции, лучше сначала проработать пример. Допустим, мы хотим удалить
(исключить) столбец возраста(age) из базы данных слева на 
 <a href="#%28counter._db._%28figure._fig~3adb-tables%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">137</span></a>. Вот как это преобразование выглядит в терминах таблиц: 
</div><div class="SIntrapara"><blockquote class="SVInsetFlow"><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td style="border-bottom: 1px solid black;" align="center">

<p>Исходная база данных</p>

</td><td style="border-bottom: 1px solid black;" align="center">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="center">

<p>... удаление столбца “Age” </p>

</td></tr><tr><td align="center"><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td align="left">

<p>Name</p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p>Age</p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p>Present</p>

</td></tr><tr><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._integer%29" class="techoutside" data-pltdoc="x"><span class="techinside">Integer</span></a></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Alice"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">35</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">#true</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Bob"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">25</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">#false</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Carol"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">30</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">#true</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Dave"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">32</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">#false</span></p>

</td></tr></tbody></table></td><td align="center">

<p><span class="hspace">&nbsp;&nbsp;</span></p>

</td><td align="center"><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td align="left">

<p>Name</p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p>Present</p>

</td></tr><tr><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Alice"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">#true</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Bob"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">#false</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Carol"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">#true</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Dave"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">#false</span></p>

</td></tr></tbody></table></td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Естественный способ сформулировать этот пример как тест, 
повторно использует <a href="#%28counter._db._%28figure._fig~3adb-isl%29%29" data-pltdoc="x">рисунок&nbsp;<span class="FigureRef">138</span></a>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">projected-content</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">"Alice"</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">"Bob"</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#false</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">"Carol"</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">"Dave"</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">#false</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">projected-schema</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">"Name"</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">"Present"</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._boolean~3f%29%29" class="RktValLink" data-pltdoc="x">boolean?</a></span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">projected-db</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-db</span><span class="hspace">&nbsp;</span><span class="RktSym">projected-schema</span><span class="hspace">&nbsp;</span><span class="RktSym">projected-content</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt"> Stop! Read this test carefully. What</span><span class="RktCmt">'</span><span class="RktCmt">s wrong?</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">project</span><span class="hspace">&nbsp;</span><span class="RktSym">school-db</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">"Name"</span><span class="hspace">&nbsp;</span><span class="RktVal">"Present"</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">projected-db</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara"><a name="(idx._db._(gentag._576._db))"></a>
</div><div class="SIntrapara"><blockquote class="Herefigure"><blockquote class="Centerfigure"><blockquote class="FigureInside"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">project</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="hspace">&nbsp;</span><span class="RktSym">labels</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">schema</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-schema</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-content</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._db._spec%29" class="techoutside" data-pltdoc="x"><span class="techinside">Spec</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">does this spec belong to the new schema</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">keep?</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._db._row%29" class="techoutside" data-pltdoc="x"><span class="techinside">Row</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._db._row%29" class="techoutside" data-pltdoc="x"><span class="techinside">Row</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">retains those columns whose name is in </span><span class="RktSym">labels</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">row-project</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-db</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._filter%29%29" class="RktValLink" data-pltdoc="x">filter</a></span><span class="hspace">&nbsp;</span><span class="RktSym">keep?</span><span class="hspace">&nbsp;</span><span class="RktSym">schema</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktSym">row-project</span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget"><a name="(counter._db._(figure._fig~3aproject-template))" x-target-lift="Figure"></a>Рисунок&nbsp;140: </span>Шаблон для <span class="RktSym">project</span></span></p>

</blockquote></div>

<p></p>

<p></p>

<div class="SIntrapara">Если вы заполните указанный выше шаблон и запустите код в DrRacket, 
вы получите сообщение об ошибке
</div><div class="SIntrapara"><blockquote class="SCentered">

<p><span class="stt">first argument of equality cannot be a function(первый аргумент равенства не может быть функцией)</span></p>

</blockquote></div><div class="SIntrapara">еще до того, как DrRacket сможет определить, 
прошел ли тест успешно. Напомним из <a href="part_three.html#%28part._sec~3afunctions-as-values%29" data-pltdoc="x">Функции - это значения</a>, что функции - это бесконечно большие
объекты, и невозможно гарантировать, что две функции всегда производят одинаковый результат 
при применении к одним и тем же аргументам. Поэтому мы ослабляем тестовый пример: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29" class="RktStxLink" data-pltdoc="x">check-expect</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-content</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">project</span><span class="hspace">&nbsp;</span><span class="RktSym">school-db</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">"Name"</span><span class="hspace">&nbsp;</span><span class="RktVal">"Present"</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">projected-content</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div>

<p></p>

<p>Для шаблона мы снова используем существующие абстракции; см. 
 <a href="#%28counter._db._%28figure._fig~3aproject-template%29%29" data-pltdoc="x">рисунок&nbsp;<span class="FigureRef">140</span></a>. Выражение
<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span> определяет две функции: одну для 
использования с <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._filter%29%29" class="RktValLink" data-pltdoc="x">filter</a></span> 
для сужения схемы данной базы данных, а другую для использования с 
<span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span> 
для уменьшения содержимого. Кроме того, функция снова извлекает и называет схему 
и контент(содержание) из данной базы данных.</p>

<p>Прежде чем перейти к списку пожеланий, давайте сделаем шаг назад и изучим 
решение пойти с двумя повторными использованиями существующей абстракции. 
Сигнатура сообщает нам, что функция потребляет структуру и создает элемент 
<a href="#%28tech._db._db%29" class="techoutside" data-pltdoc="x"><span class="techinside">DB</span></a>, поэтому</p>

<p></p>

<div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">schema</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-schema</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-content</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-db</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktSym">schema</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
явно требуется. Также несложно увидеть, что новая схема создается из старой схемы, 
а новое содержимое - из старого содержимого. Кроме того, в предназначении 
<span class="RktSym">project</span>(проекции) содержится призыв сохранить только те метки,
которые упомянуты во втором аргументе. Следовательно, функция <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._filter%29%29" class="RktValLink" data-pltdoc="x">filter</a></span> правильно сужает данную схему(<span class="RktSym">schema</span>).
Напротив, строки сами по себе остаются, за исключением того, что каждая из них теряет 
несколько ячеек. Таким образом, <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span> - это правильный
способ обработки <span class="RktSym">content</span>(содержимого).</div>

<p></p>

<p></p>

<div class="SIntrapara">Теперь мы можем перейти к оформлению двух вспомогательных функций. 
Разработать <span class="RktSym">keep?</span> просто. Вот полное определение:  
<a name="(idx._db._(gentag._577._db))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._db._spec%29" class="techoutside" data-pltdoc="x"><span class="techinside">Spec</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">does this spec belong to the new schema</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">keep?</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._member~3f%29%29" class="RktValLink" data-pltdoc="x">member?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">labels</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Функция применяется к <a href="#%28tech._db._spec%29" class="techoutside" data-pltdoc="x"><span class="techinside">Spec</span></a>, которая объединяет <a href="#%28tech._db._label%29" class="techoutside" data-pltdoc="x"><span class="techinside">Label</span></a> и 
<a href="#%28tech._db._predicate%29" class="techoutside" data-pltdoc="x"><span class="techinside">Predicate</span></a> в списке. Если первый принадлежит 
<span class="RktSym">labels</span>(меткам), данный <a href="#%28tech._db._spec%29" class="techoutside" data-pltdoc="x"><span class="techinside">Spec</span></a> сохраняется.</div>

<p></p>

<p></p>

<div class="SIntrapara">При разработке <span class="RktSym">row-project</span>, 
цель состоит в том, чтобы сохранить те ячейки(<a href="#%28tech._db._cell%29" class="techoutside" data-pltdoc="x"><span class="techinside">Cell</span></a>) в каждой строке
(<a href="#%28tech._db._row%29" class="techoutside" data-pltdoc="x"><span class="techinside">Row</span></a>) содержимого(<span class="RktSym">content</span>), имя которой является членом 
заданных меток(<span class="RktSym">labels</span>). Давайте рассмотрим приведенный выше пример.
Четыре строки: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Alice"</span><span class="hspace">&nbsp;</span><span class="RktVal">35</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Bob"</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">25</span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Carol"</span><span class="hspace">&nbsp;</span><span class="RktVal">30</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Dave"</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">32</span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Каждая из этих строк имеет длину  <span class="RktSym">school-schema</span>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Name"</span><span class="hspace">&nbsp;</span><span class="RktVal">"Age"</span><span class="hspace">&nbsp;</span><span class="RktVal">"Present"</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">Имена в схеме определяют имена ячеек в данных 
строках. Следовательно, <span class="RktSym">row-project</span> должен сохранять первую 
и третью ячейки каждой строки, потому что это их имена, находятся в переданных метках
 (<span class="RktSym">labels</span>).</div>

<p></p>

<p></p>

<div class="SIntrapara">Поскольку <a href="#%28tech._db._row%29" class="techoutside" data-pltdoc="x"><span class="techinside">Row</span></a> определяется рекурсивно, 
этот процесс сопоставления между содержимым ячеек(<a href="#%28tech._db._cell%29" class="techoutside" data-pltdoc="x"><span class="techinside">Cell</span></a>) и их именами
вызывает рекурсивную вспомогательную функцию, которую <span class="RktSym">row-project</span>
может применять к содержимому и меткам ячеек. Уточним это как пожелание: 
 <a name="(idx._db._(gentag._578._db))"></a> <a name="(idx._db._(gentag._579._db))"></a>
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._db._row%29" class="techoutside" data-pltdoc="x"><span class="techinside">Row</span></a><span class="RktCmt"> [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="#%28tech._db._label%29" class="techoutside" data-pltdoc="x"><span class="techinside">Label</span></a><span class="RktCmt">] -&gt; </span><a href="#%28tech._db._row%29" class="techoutside" data-pltdoc="x"><span class="techinside">Row</span></a></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">retains those cells whose corresponding element </span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">in </span><span class="RktSym">names</span><span class="RktCmt"> is also in </span><span class="RktSym">labels</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">row-filter</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="hspace">&nbsp;</span><span class="RktSym">names</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Используя это пожелание, <span class="RktSym">row-project</span> является однострочным: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">row-project</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">row-filter</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">schema</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></div><div class="SIntrapara">
Выражение <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span> извлекает 
имена ячеек, и эти имена передаются фильтру строк(<span class="RktSym">row-filter</span>) 
для извлечения совпадающих ячеек.</div>

<p></p>

<p><a name="(counter._db._(exercise._ex~3arow-filter))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;405. Создайте функцию-<span class="RktSym">row-filter</span>.
Постройте примеры для <span class="RktSym">row-filter</span> из примеров для 
 <span class="RktSym">project</span>.</p>

<p><span style="font-weight: bold">Предположение</span>  Данная база данных проходит 
проверку целостности, что означает, что длина каждой строки равна длине схемы и, следовательно, 
ее списку имен.
 <a href="#%28counter._db._%28exercise._ex~3arow-filter%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p> На  <a href="#%28counter._db._%28figure._fig~3adb-project%29%29" data-pltdoc="x">рис.&nbsp;<span class="FigureRef">141</span></a> собраны все части вместе. У  функции <span class="RktSym">project</span> есть суффикс <span class="stt">.v1</span>, потому что она требует некоторых улучшений.
Следующие упражнения просят вас выполнить некоторые из них. </p>

<p></p>

<div class="SIntrapara"><a name="(idx._db._(gentag._580._db))"></a>
</div><div class="SIntrapara"><blockquote class="Figure"><a name="(counter._db._(figure._fig~3adb-project))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">project.v1</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="hspace">&nbsp;</span><span class="RktSym">labels</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">schema</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-schema</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-content</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._db._spec%29" class="techoutside" data-pltdoc="x"><span class="techinside">Spec</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">does this column belong to the new schema</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">keep?</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._member~3f%29%29" class="RktValLink" data-pltdoc="x">member?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">labels</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._db._row%29" class="techoutside" data-pltdoc="x"><span class="techinside">Row</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._db._row%29" class="techoutside" data-pltdoc="x"><span class="techinside">Row</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">retains those columns whose name is in </span><span class="RktSym">labels</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">row-project</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">row-filter</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">schema</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._db._row%29" class="techoutside" data-pltdoc="x"><span class="techinside">Row</span></a><span class="RktCmt"> [</span><a href="part_three.html#%28tech._sim-dd._list._of%29" class="techoutside" data-pltdoc="x"><span class="techinside">List-of</span></a><span class="RktCmt"> </span><a href="#%28tech._db._label%29" class="techoutside" data-pltdoc="x"><span class="techinside">Label</span></a><span class="RktCmt">] -&gt; </span><a href="#%28tech._db._row%29" class="techoutside" data-pltdoc="x"><span class="techinside">Row</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">retains those cells whose name is in </span><span class="RktSym">labels</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">row-filter</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="hspace">&nbsp;</span><span class="RktSym">names</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">names</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29" class="RktStxLink" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._member~3f%29%29" class="RktValLink" data-pltdoc="x">member?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">names</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">labels</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">row-filter</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">names</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">row-filter</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29" class="RktValLink" data-pltdoc="x">rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">names</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-db</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._filter%29%29" class="RktValLink" data-pltdoc="x">filter</a></span><span class="hspace">&nbsp;</span><span class="RktSym">keep?</span><span class="hspace">&nbsp;</span><span class="RktSym">schema</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktSym">row-project</span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;141: </span>Проекция базы данных</span></p>

</blockquote></div>

<p></p>

<p><a name="(counter._db._(exercise._ex~3arow-project-hoist))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;406. Функция <span class="RktSym">row-project</span> пересчитывает
метки для каждой строки содержимого базы данных. Отличается ли результат функции от вызова  
к вызову функции? Если нет, приподнимите выражение. 
<a href="#%28counter._db._%28exercise._ex~3arow-project-hoist%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._db._(exercise._ex~3arow-filter/fold))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;407. Перепроектируйте <span class="RktSym">row-filter</span> 
используя <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29" class="RktValLink" data-pltdoc="x">foldr</a></span>. Как только 
вы это сделаете, вы можете объединить <span class="RktSym">row-project</span> и 
<span class="RktSym">row-filter</span> в одну функцию.    
<span style="font-weight: bold">Подсказка</span> Функция <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29" class="RktValLink" data-pltdoc="x">foldr</a></span> в ISL+ может использовать два списка и обрабатывать их параллельно.
 <a href="#%28counter._db._%28exercise._ex~3arow-filter%2Ffold%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p>Последнее наблюдение заключается в том, что <span class="RktSym">row-project</span> проверяет
принадлежность метки(label) к <span class="RktSym">labels</span> для каждой отдельной ячейки. 
Для ячеек одного и того же столбца в разных строках результат будет одинаковым. 
Следовательно, также имеет смысл вывести(hoist-поднять) это вычисление из функции.</p>

<p></p>

<div class="SIntrapara">Эта форма подъема несколько сложнее, чем подъем простого выражения. 
Мы в основном хотим предварительно вычислить результат 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._member~3f%29%29" class="RktValLink" data-pltdoc="x">member?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">label</span><span class="hspace">&nbsp;</span><span class="RktSym">labels</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">для всех строк и передать результаты в функцию 
вместо списка меток. То есть мы заменяем список меток списком логических значений
(<a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a>), которые указывают, должна ли сохраняться ячейка в
соответствующей позиции. К счастью, вычисление этих логических значений (<a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a>) - всего лишь еще одно применение 
<span class="RktSym">keep?</span> к схеме: 
</div><div class="SIntrapara"><blockquote class="SCodeFlow">

<p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktSym">keep?</span><span class="hspace">&nbsp;</span><span class="RktSym">schema</span><span class="RktPn">)</span></p>

</blockquote></div><div class="SIntrapara">Вместо того, чтобы хранить некоторые 
<a href="#%28tech._db._spec%29" class="techoutside" data-pltdoc="x"><span class="techinside">Spec</span></a> из данной схемы(<span class="RktSym">schema</span>) и отбрасывать другие, это 
выражение просто собирает решения. </div>

<p></p>

<p></p>

<div class="SIntrapara"><a name="(idx._db._(gentag._581._db))"></a>
</div><div class="SIntrapara"><blockquote class="Figure"><a name="(counter._db._(figure._fig~3adb-project2))" x-target-lift="Figure"></a><blockquote class="Centerfigure"><blockquote class="FigureInside"><table class="RktBlk" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">project</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="hspace">&nbsp;</span><span class="RktSym">labels</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">schema</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-schema</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">db-content</span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._db._spec%29" class="techoutside" data-pltdoc="x"><span class="techinside">Spec</span></a><span class="RktCmt"> -&gt; </span><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">does this column belong to the new schema</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">keep?</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._member~3f%29%29" class="RktValLink" data-pltdoc="x">member?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">labels</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><a href="#%28tech._db._row%29" class="techoutside" data-pltdoc="x"><span class="techinside">Row</span></a><span class="RktCmt"> -&gt; </span><a href="#%28tech._db._row%29" class="techoutside" data-pltdoc="x"><span class="techinside">Row</span></a><span class="RktCmt"> </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">retains those columns whose name is in </span><span class="RktSym">labels</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">row-project</span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29" class="RktValLink" data-pltdoc="x">foldr</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cell</span><span class="hspace">&nbsp;</span><span class="RktSym">m</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktSym">m</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktSym">cell</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">row</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">mask</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">mask</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktSym">keep?</span><span class="hspace">&nbsp;</span><span class="RktSym">schema</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-db</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._filter%29%29" class="RktValLink" data-pltdoc="x">filter</a></span><span class="hspace">&nbsp;</span><span class="RktSym">keep?</span><span class="hspace">&nbsp;</span><span class="RktSym">schema</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktSym">row-project</span><span class="hspace">&nbsp;</span><span class="RktSym">content</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></tbody></table></blockquote></blockquote><p class="Centertext"><span class="Legend"><span class="FigureTarget">Рисунок&nbsp;142: </span>Проекция базы данных</span></p>

</blockquote></div>

<p></p>

<p><a href="#%28counter._db._%28figure._fig~3adb-project2%29%29" data-pltdoc="x">Рисунок&nbsp;<span class="FigureRef">142</span></a> показывает окончательную версию 
<span class="RktSym">project</span>(проекции) и объединяет решения для предыдущих упражнений. 
Она также использует <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29" class="RktStxLink" data-pltdoc="x">local</a></span> для извлечения и именования 
<span class="RktSym">schema</span>(схемы) и <span class="RktSym">content</span>(содержимого),
а также <span class="RktSym">keep?</span> для проверки того, стоит ли хранить метку в 
какой-либо <a href="#%28tech._db._spec%29" class="techoutside" data-pltdoc="x"><span class="techinside">Spec</span></a>. Остальные два определения представляют 
<span class="RktSym">mask</span>, которая обозначает список логических значений(<a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a>), обсужденных выше, и исправленную версию 
<span class="RktSym">row-project</span>. Последняя использует <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29" class="RktValLink" data-pltdoc="x">foldr</a></span> для параллельной обработки данной строки( <span class="RktSym">row</span>) и маски(<span class="RktSym">mask</span>). </p>

<p>Сравните это исправленное определение <span class="RktSym">project</span> с 
<span class="RktSym">project.v1</span> на  <a href="#%28counter._db._%28figure._fig~3adb-project%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">141</span></a>. 
Окончательное определение проще и быстрее, чем исходная версия. Систематическая 
разработка в сочетании с тщательными изменениями окупается; 
<a name="(idx._db._(gentag._582._db))"></a>наборы тестов гарантируют, что исправления 
не нарушат функциональность программы.</p>

<p><a name="(counter._db._(exercise._ex~3adb-select))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;408. Спроектируйте функцию <span class="RktSym">select</span>. 
Она использует базу данных, список меток и предикат для строк. Результатом является список строк,
удовлетворяющих заданному предикату, спроецированный до заданного набора меток.
<a href="#%28counter._db._%28exercise._ex~3adb-select%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._db._(exercise._ex~3adb-reorder))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;409. Разработайте <span class="RktSym">reorder</span>. 
Функция потребляет базу данных <span class="RktSym">db</span> и список 
 <span class="RktSym">lol</span> <a href="#%28tech._db._label%29" class="techoutside" data-pltdoc="x"><span class="techinside">Label</span></a>(меток). Она создает базу данных, 
подобную <span class="RktSym">db</span>, но с ее столбцами, переупорядоченными в соответствии 
с <span class="RktSym">lol</span>. 
<span style="font-weight: bold">Подсказка</span> Прочтите  - <span class="RktSym"><a href="https://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list-ref%29%29" class="RktValLink" data-pltdoc="x">list-ref(список ссылок)</a></span>.</p>

<p>Сначала предположим, что <span class="RktSym">lol</span> состоит в точности из меток 
столбцов базы данных- <span class="RktSym">db</span>. После того, как вы закончите разработку,
изучите, что нужно изменить, если <span class="RktSym">lol</span> содержит меньше меток, 
чем есть столбцов и строк, которые не являются метками столбца в <span class="RktSym">db</span>. 
<a href="#%28counter._db._%28exercise._ex~3adb-reorder%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._db._(exercise._ex~3adb-union))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;410. Разработайте функцию <span class="RktSym">db-union</span>,
которая использует две базы данных с одной и той же схемой и создает новую базу данных с 
этой схемой и совместным(joint) содержимым обеих. Функция должна исключить строки с 
одинаковым содержимым.</p>

<p>Предположим, что схемы согласовывают предикаты для каждого столбца.  
<a href="#%28counter._db._%28exercise._ex~3adb-union%29%29" class="ex-end" data-pltdoc="x"></a></p>

<p><a name="(counter._db._(exercise._ex~3adb-join))"></a><span style="font-weight: bold">Упражнение</span>&nbsp;411. Разработайте <span class="RktSym">join</span>, функцию, 
которая использует две базы данных: <span class="RktSym">db-1</span> и 
<span class="RktSym">db-2</span>. Схема <span class="RktSym">db-2</span> начинается с той 
же <a href="#%28tech._db._spec%29" class="techoutside" data-pltdoc="x"><span class="techinside">Spec</span></a>(спецификации), на которой заканчивается схема 
<span class="RktSym">db-1</span>. Функция создает базу данных из <span class="RktSym">db-1</span>,
заменяя последнюю ячейку в каждой строке на <span style="font-style: italic">translation</span>
ячейки в <span class="RktSym">db-2</span>.</p>

<p></p>

<div class="SIntrapara">Вот пример. Возьмем базы данных на 
 <a href="#%28counter._db._%28figure._fig~3adb-tables%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">137</span></a>. Обе они удовлетворяют предположению этих упражнений, 
то есть последний <a href="#%28tech._db._spec%29" class="techoutside" data-pltdoc="x"><span class="techinside">Spec</span></a> в схеме первого равен первому <a href="#%28tech._db._spec%29" class="techoutside" data-pltdoc="x"><span class="techinside">Spec</span></a> второй. 
Следовательно, их можно соединить: 
</div><div class="SIntrapara"><blockquote class="SCentered"><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td align="left">

<p>Name</p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p>Age</p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p>Description</p>

</td></tr><tr><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._integer%29" class="techoutside" data-pltdoc="x"><span class="techinside">Integer</span></a></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Alice"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">35</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">"presence"</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Bob"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">25</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">"absence"</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Carol"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">30</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">"presence"</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Dave"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">32</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">"absence"</span></p>

</td></tr></tbody></table></blockquote></div><div class="SIntrapara">Её преобразование 
отображает  <span class="RktVal">#true</span> в <span class="RktVal">"presence"</span> и
 <span class="RktVal">#false</span> в <span class="RktVal">"absence"</span>.</div>

<p></p>

<p><span style="font-weight: bold">Подсказки</span> (1) В общем, вторая база данных может
«переводить» ячейку в строку значений, а не только в одно значение. Измените пример, 
добавив дополнительные термины в строку «присутствует»(<span class="RktVal">"presence"</span>)
 и «отсутствует»(<span class="RktVal">"absence"</span>).</p>

<p></p>

<div class="SIntrapara">(2)  Она также может “translate”(переводить) ячейку в несколько строк, 
и в этом случае процесс добавляет несколько строк в новую базу данных. Вот второй пример, 
пара баз данных, немного отличающаяся от показанных на  
 <a href="#%28counter._db._%28figure._fig~3adb-tables%29%29" data-pltdoc="x">рисунке&nbsp;<span class="FigureRef">137</span></a>:
</div><div class="SIntrapara"><blockquote class="SVInsetFlow"><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td align="left">

<p>Name</p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p>Age</p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p>Present</p>

</td></tr><tr><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._integer%29" class="techoutside" data-pltdoc="x"><span class="techinside">Integer</span></a></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Alice"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">35</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">#true</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Bob"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">25</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">#false</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Carol"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">30</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">#true</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Dave"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">32</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">#false</span></p>

</td></tr></tbody></table></td><td>

<p><span class="hspace">&nbsp;</span></p>

</td><td style="border-right: 1px solid black;">

<p><span class="hspace">&nbsp;</span></p>

</td><td style="border-right: 1px solid black;">

<p><span class="hspace">&nbsp;</span></p>

</td><td><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td align="left">

<p>Present</p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p>Description</p>

</td></tr><tr><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._boolean%29" class="techoutside" data-pltdoc="x"><span class="techinside">Boolean</span></a></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">#true</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">"presence"</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">#true</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">"here"</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">#false</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">"absence"</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">#false</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">"there"</span></p>

</td></tr></tbody></table></td></tr></tbody></table></blockquote></div><div class="SIntrapara">Присоединение левой базы данных к правой дает базу данных с восемью строками: 
</div><div class="SIntrapara"><blockquote class="SCentered"><table style="border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td align="left">

<p>Name</p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p>Age</p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p>Description</p>

</td></tr><tr><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._integer%29" class="techoutside" data-pltdoc="x"><span class="techinside">Integer</span></a></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td style="border-bottom: 1px solid black;" align="left">

<p><a href="part_one.html#%28tech._string%29" class="techoutside" data-pltdoc="x"><span class="techinside">String</span></a></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Alice"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">35</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">"presence"</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Alice"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">35</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">"here"</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Bob"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">25</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">"absence"</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Bob"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">25</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">"there"</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Carol"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">30</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">"presence"</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Carol"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">30</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">"here"</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Dave"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">32</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">"absence"</span></p>

</td></tr><tr><td align="left">

<p><span class="RktVal">"Dave"</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">32</span></p>

</td><td align="left">

<p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

</td><td align="left">

<p><span class="RktVal">"there"</span></p>

</td></tr></tbody></table></blockquote></div>

<p></p>

<p>(3) Используйте итеративное уточнение для решения проблемы. Для первой итерации предположим, 
что “translation”(перевод) находит только одну строку на ячейку. Что касается второй, 
откажитесь от этого предположения.</p>

<p><span style="font-weight: bold">Примечание о предположениях</span> Это упражнение и 
весь раздел в основном полагаются на неформально сформулированные предположения о 
данных базах данных. Здесь разработка <span class="RktSym">join</span>(соединения) предполагает, 
что «схема <span class="RktSym">db-2</span> начинается с той же спецификации - <a href="#%28tech._db._spec%29" class="techoutside" data-pltdoc="x"><span class="techinside">Spec</span></a>, на которой заканчивается схема <span class="RktSym">db-1</span>». 
На самом деле функции базы данных должны быть проверены функциями в духе раздела
<a href="part_one.html#%28part._sec~3ainput-errors%29" data-pltdoc="x">Ошибки Ввода</a>. 
Однако создание <span class="RktSym">checked-join</span> для вас было бы невозможным. 
Сравнение последнего <a href="#%28tech._db._spec%29" class="techoutside" data-pltdoc="x"><span class="techinside">Spec</span></a> в схеме <span class="RktSym">db-1</span> с первым в 
<span class="RktSym">db-2</span> требует сравнения функций. Для практических решений см. 
Текст о базах данных. 
 <a href="#%28counter._db._%28exercise._ex~3adb-join%29%29" class="ex-end" data-pltdoc="x"></a></p>

<h3>24<tt>&nbsp;</tt><a name="(part._ch~3asummary4)"></a>Резюме</h3>

<p></p>

<div class="SIntrapara">Эта четвертая часть книги посвящена разработке функций, 
обрабатывающих данные, описание которых требует множества взаимосвязанных определений. 
Эти формы данных отображаются повсюду в реальном мире, от локальной файловой системы 
вашего компьютера до всемирной паутины и геометрических фигур, используемых в анимационных 
фильмах. Внимательно проработав эту часть книги, вы узнаете, что 
<a name="(idx._(gentag._583))"></a>рецепт разработки также подходит для следующих форм данных: 
</div><div class="SIntrapara"><ol><li>

<p>Когда описание данных программы требует нескольких определений данных, 
имеющих взаимную ссылку, рецепт проектирования требует одновременной разработки 
<a name="(idx._(gentag._584))"></a>шаблонов, по одному для каждого определения данных. 
Если определение данных <span class="stt">A</span> ссылается на определение данных 
<span class="stt">B</span>, то шаблон <span class="RktSym">function-for-A</span> ссылается 
на <span class="RktSym">function-for-B</span> в том же месте и таким же образом. 
В остальном рецепты разработки работают как раньше, функция для функции.</p>

</li><li>

<p>Когда функция должна обрабатывать два типа сложных данных, нужно различать три случая. 
Во-первых, функция может работать с одним из аргументов, как если бы он был атомарным. 
Во-вторых, два аргумента должны иметь одинаковую структуру, и функция проходит 
их полностью параллельно. В-третьих, функции, возможно, придется обрабатывать 
все возможные комбинации по отдельности. В этом случае вы создаете двухмерную таблицу, 
в которой по одному измерению перечисляются все виды данных из одного определения данных, 
а по другому - со вторым типом данных. Наконец, вы используете ячейки таблицы, 
чтобы сформулировать условия и ответы для различных случаев. </p>

<p>В этой части книги рассматриваются функции от двух сложных аргументов. 
Если вы когда-нибудь столкнетесь с одним из тех редких случаев, когда функция получает 
три сложных фрагмента данных, вы знаете, что вам нужно (вообразить) трехмерную таблицу.
</p>

</li></ol></div><div class="SIntrapara">Теперь вы ознакомились со всеми формами 
<a name="(idx._(gentag._585))"></a>структурных данных, с которыми вы, вероятно, 
столкнетесь в течение своей карьеры, хотя детали будут отличаться. Если вы 
когда-нибудь застрянете, вспомните <a name="(idx._(gentag._586))"></a>рецепт 
разработки; это поможет вам начать. </div>

<p></p>

<div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="i3-4.html" title="backward to &quot;Intermezzo 3: Scope and Abstraction&quot;" data-pltdoc="x">← prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;How to Design Programs, Second Edition&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="i4-5.html" title="forward to &quot;Intermezzo 4: The Nature of Numbers&quot;" data-pltdoc="x">next →</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>